<!DOCTYPE html> 
<html dir="rtl" lang="ar"> 
<head> 
    <meta charset="UTF-8"> 
    <meta name="viewport" content="width=device-width, initial-scale=1.0"> 
    <title>ğŸš€ Wizz.ink v5.0.0-PRO - Ø§Ù„Ø³ÙŠØ§Ø¯Ø© Ø§Ù„ØªÙ‚Ù†ÙŠØ©</title> 
    <script src="https://cdn.tailwindcss.com"></script> 
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" rel="stylesheet"> 
    <!-- Ù…ÙƒØªØ¨Ø§Øª Ø§Ù„Ø£Ù…Ø§Ù† Ø§Ù„Ù…ØªÙ‚Ø¯Ù…Ø© --> 
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script> 
    <script src="https://cdn.jsdelivr.net/npm/bcryptjs@2.4.3/dist/bcrypt.min.js"></script> 
    <script src="https://cdn.jsdelivr.net/npm/papaparse@5.3.2/dist/papaparse.min.js"></script> 
    <!-- PDF Generation Library --> 
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script> 
    <!-- Leaflet for Map/Heatmap --> 
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css"/> 
    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script> 
    <script src="https://unpkg.com/leaflet.heatmap/leaflet-heatmap.js"></script> 
 
    <style> 
        /* Ø¥Ø¶Ø§ÙØ© Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ù„ÙŠÙ„ÙŠ Ø§Ù„Ø³ÙŠØ§Ø¯ÙŠ Ø§ÙØªØ±Ø§Ø¶ÙŠØ§Ù‹ */ 
        :root { 
            --background-color: #1a202c; /* dark gray */ 
            --text-color: #f7fafc; /* light gray */ 
            --glass-background: rgba(255, 255, 255, 0.05); 
            --glass-border: rgba(255, 255, 255, 0.1); 
            --main-button-color: #0052FF; 
            --main-button-hover-color: #0042CC; 
        } 
 
        @media (prefers-color-scheme: light) { 
            /* ÙŠÙ…ÙƒÙ† ØªØ¹Ø±ÙŠÙ ÙˆØ¶Ø¹ ÙØ§ØªØ­ Ø¥Ø°Ø§ Ø£Ø±Ø¯ØªØŒ Ù„ÙƒÙ† Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ù„ÙŠÙ„ÙŠ Ù‡Ùˆ Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ */ 
        } 
 
        @import url('https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;700&display=swap'); 
 
        * { 
            font-family: 'Cairo', sans-serif; 
            direction: rtl; /* Ø¯Ø¹Ù… RTL Ø§ÙØªØ±Ø§Ø¶ÙŠÙ‹Ø§ */ 
        } 
 
        body { 
            background-color: var(--background-color); 
            color: var(--text-color); 
            min-height: 100vh; 
        } 
 
        .glass { 
            backdrop-filter: blur(20px); 
            background: var(--glass-background); 
            border: 1px solid var(--glass-border); 
        } 
 
        .gradient-hero { 
            background: linear-gradient(135deg, #0052FF 0%, #764ba2 50%, #f093fb 100%); 
        } 
 
        .gradient-admin { 
            background: linear-gradient(135deg, #1e3a8a 0%, #0052FF 50%, #06b6d4 100%); 
        } 
 
        .secure-badge { 
            background: linear-gradient(45deg, #10b981, #059669); 
        } 
 
        .frozen-badge { 
            background: linear-gradient(45deg, #1f2937, #374151); 
            color: #f9fafb; 
            font-weight: 700; 
            animation: pulse 2s infinite; 
        } 
 
        .warning-badge { 
            background: linear-gradient(45deg, #f59e0b, #d97706); 
        } 
 
        .fade-in { 
            animation: fadeIn 0.8s ease-in; 
        } 
 
        @keyframes fadeIn { 
            from { 
                opacity: 0; 
                transform: translateY(30px); 
            } 
            to { 
                opacity: 1; 
                transform: translateY(0); 
            } 
        } 
 
        .call-menu { 
            position: absolute; 
            top: 100%; 
            right: 0; 
            background: rgba(0, 0, 0, 0.95); 
            backdrop-filter: blur(20px); 
            border-radius: 16px; 
            min-width: 220px; 
            z-index: 100; 
        } 
 
        .call-type-btn { 
            transition: all 0.3s; 
        } 
 
        .call-type-btn:hover { 
            transform: scale(1.05); 
        } 
 
        .pulse { 
            animation: pulse 2s infinite; 
        } 
 
        @keyframes pulse { 
            0%, 100% { 
                opacity: 1; 
            } 
            50% { 
                opacity: 0.5; 
            } 
        } 
 
        .time-card { 
            background: linear-gradient(135deg, #10b981, #059669); 
        } 
 
        .late-badge { 
            background: linear-gradient(45deg, #ef4444, #dc2626); 
            animation: shake 0.5s infinite; 
        } 
 
        @keyframes shake { 
            0%, 100% { 
                transform: translateX(0); 
            } 
            25% { 
                transform: translateX(-5px); 
            } 
            75% { 
                transform: translateX(5px); 
            } 
        } 
 
        .video-feed { 
            border: 4px solid #0052FF; 
            border-radius: 1rem; 
            overflow: hidden; 
        } 
 
        .attendance-closed { 
            background: linear-gradient(45deg, #4b5563, #1f2937); 
            pointer-events: none; 
            opacity: 0.7; 
        } 
 
        .main-button { 
            background-color: var(--main-button-color); 
        } 
 
        .main-button:hover { 
            background-color: var(--main-button-hover-color); 
        } 
 
        .core-frozen { 
            border: 3px solid #1f2937 !important; 
            background: rgba(31, 41, 55, 0.9) !important; 
        } 
 
        .recording-pulse { 
            animation: recordingPulse 1.5s infinite; 
        } 
 
        @keyframes recordingPulse { 
            0% { 
                box-shadow: 0 0 0 0 rgba(255, 0, 0, 0.7); 
            } 
            70% { 
                box-shadow: 0 0 0 10px rgba(255, 0, 0, 0); 
            } 
            100% { 
                box-shadow: 0 0 0 0 rgba(255, 0, 0, 0); 
            } 
        } 
 
        #employeeMap { 
            height: 500px; 
            width: 100%; 
            border-radius: 16px; 
        } 
 
        /* Style for draggable employee icons */ 
        .draggable-employee { 
            position: absolute; 
            cursor: grab; 
            width: 40px; 
            height: 40px; 
            background-color: #0052FF; 
            border-radius: 50%; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            font-size: 0.8em; 
            font-weight: bold; 
            color: white; 
            border: 2px solid white; 
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.3); 
            transition: transform 0.1s ease-out; 
            z-index: 10; 
        } 
 
        .draggable-employee:active { 
            cursor: grabbing; 
            z-index: 11; 
        } 
 
        .layout-editor-canvas { 
            width: 100%; 
            height: 500px; 
            background-color: #f0f0f0; /* Light background for drawing */ 
            border: 1px solid #ccc; 
            position: relative; 
            overflow: hidden; /* Ensure employees stay within canvas */ 
        } 
 
        .walkie-talkie-button { 
            position: fixed; 
            bottom: 20px; 
            left: 20px; 
            background-color: #dc2626; /* Red */ 
            color: white; 
            padding: 15px 20px; 
            border-radius: 50%; 
            font-size: 1.5em; 
            cursor: pointer; 
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3); 
            z-index: 1000; 
        } 
 
        .walkie-talkie-button:active { 
            background-color: #b91c1c; 
        } 
 
        /* Ù…Ù†Ø¹ Ø§Ù„Ù†Ø³Ø® ÙˆØ§Ù„Ù„ØµÙ‚ ÙÙŠ Ø­Ù‚ÙˆÙ„ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± */ 
        input[type="password"] { 
            -webkit-user-select: none; /* Chrome, Safari, Opera */ 
            -moz-user-select: none; /* Firefox */ 
            -ms-user-select: none; /* Internet Explorer/Edge */ 
            user-select: none; /* Standard */ 
        } 
        input[type="password"]::-webkit-input-placeholder { /* Chrome/Opera/Safari */ 
            color: var(--text-color); 
            opacity: 0.7; 
        } 
        input[type="password"]::-moz-placeholder { /* Firefox 19+ */ 
            color: var(--text-color); 
            opacity: 0.7; 
        } 
        input[type="password"]:-ms-input-placeholder { /* IE 10+ */ 
            color: var(--text-color); 
            opacity: 0.7; 
        } 
        input[type="password"]:-moz-placeholder { /* Firefox 18- */ 
            color: var(--text-color); 
            opacity: 0.7; 
        } 
    </style> 
</head> 
<body class="min-h-screen"> 
 
<!-- ğŸŸ¥ Ø§Ù„Ù…Ù†Ø·Ù‚Ø© 0 â€” Ù„Ø§ÙØªØ© Ø§Ù„Ø³ÙŠØ§Ø¯Ø© (MANDATORY HEADER) --> 
<!-- 
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• 
ğŸ”¥ WIZZ.INK v5.0.0-PRO - CORE FROZEN DECLARATION ğŸ”¥ 
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• 
 
ğŸ“œ CORE FREEZE STATUS: âœ… PERMANENTLY FROZEN 
ğŸ›¡ï¸ ZERO-KNOWLEDGE ARCHITECTURE: ACTIVE 
ğŸ”’ COMPANY DATA ISOLATION: 100% LOCAL 
âš–ï¸ LEGAL NEUTRALITY: SOFTWARE-ONLY DELIVERY 
 
ğŸŸ¥ ZONE 0-2: IMMUTABLE - DO NOT TOUCH 
ğŸŸ§ ZONE 3: TRUST COORDINATION - READ-ONLY 
ğŸŸ¨ ZONE 4: EXTENSIONS - ADMIN ONLY 
ğŸŸ© ZONE 5: UI LAYER - PRESENTATION ONLY 
 
ğŸ‘¤ DEVELOPER ROLE: MAINTAIN â†’ EXTEND â†’ DO NOT CONTROL 
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• 
--> 
 
<!-- ğŸ”¥ ØµÙØ­Ø© Ø§Ù„Ù‡Ø¨ÙˆØ· Ø§Ù„Ø¢Ù…Ù†Ø© --> 
<div id="landingPage" class="gradient-hero min-h-screen text-white"> 
    <nav class="glass p-6 sticky top-0 z-50"> 
        <div class="max-w-7xl mx-auto flex justify-between items-center"> 
            <div class="flex items-center space-x-4 space-x-reverse"> 
                <i class="fas fa-shield-alt text-3xl text-green-400"></i> 
                <div> 
                    <h1 class="text-2xl font-bold">Wizz.ink</h1> 
                    <p class="text-sm opacity-80"> 
                        <span class="frozen-badge px-2 py-1 rounded-full text-xs mr-1">CORE FROZEN</span> 
                        v5.0.0-PRO - Ù†Ø¸Ø§Ù… Ø¯ÙˆØ§Ù… Ø³ÙŠØ§Ø¯ÙŠ 
                    </p> 
                </div> 
            </div> 
            <div class="space-x-4 space-x-reverse flex items-center"> 
                <span class="secure-badge text-xs px-3 py-1 rounded-full text-white font-bold">ğŸ”’ Ø¨ÙŠØ§Ù†Ø§ØªÙƒ Ù…Ù„ÙƒÙƒ</span> 
                <button onclick="wizzApp.showLoginModal()" class="text-white hover:text-blue-200 font-semibold">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</button> 
            </div> 
        </div> 
    </nav> 
 
    <div class="max-w-7xl mx-auto px-6 py-24 text-center"> 
        <div class="fade-in"> 
            <h1 class="text-5xl md:text-7xl font-bold mb-8 leading-tight"> 
                **Ø¥Ø¯Ø§Ø±Ø© Ø¯ÙˆØ§Ù… Ø³ÙŠØ§Ø¯ÙŠØ©**<br> 
                <span class="text-6xl block text-green-400">Ø¨ÙŠØ§Ù†Ø§ØªÙƒ Ù…Ø­ÙÙˆØ¸Ø© Ù…Ø­Ù„ÙŠØ§Ù‹</span> 
            </h1> 
            <p class="text-xl mb-12 max-w-3xl mx-auto opacity-90"> 
                ğŸ“± Ù‡Ø§ØªÙ | ğŸŸ¢ ÙˆØ§ØªØ³Ø§Ø¨ | â˜ï¸ Ù…ÙƒØªØ¨ | ğŸ“ GPS | ğŸ” ØªØ´ÙÙŠØ± AES-256<br> 
                <span class="text-sm opacity-75 block mt-2">Ù„Ø§ Ø®ÙˆØ§Ø¯Ù… â€¢ Ù„Ø§ Ù†Ù‚Ù„ Ø¨ÙŠØ§Ù†Ø§Øª â€¢ Ù„Ø§ ÙˆØµÙˆÙ„ Ø®Ø§Ø±Ø¬ÙŠ</span> 
            </p> 
            <button onclick="wizzApp.demoSignup()" class="main-button text-white text-2xl px-12 py-6 rounded-2xl font-bold shadow-2xl hover:shadow-3xl transform hover:-translate-y-2 transition-all duration-300"> 
                <i class="fas fa-rocket mr-3"></i>Ø§Ø¨Ø¯Ø£ Ø§Ù„ØªØ¬Ø±Ø¨Ø© Ø§Ù„Ø³ÙŠØ§Ø¯ÙŠØ© 
            </button> 
        </div> 
    </div> 
    <!-- Customer Trust Box button --> 
    <button id="customerTrustBoxBtn" class="fixed bottom-8 right-8 bg-purple-600 hover:bg-purple-700 text-white p-4 rounded-full shadow-lg text-lg z-50"> 
        <i class="fas fa-comment-alt mr-2"></i>Ø±Ø£ÙŠ Ø§Ù„Ø²Ø¨ÙˆÙ† 
    </button> 
</div> 
 
<!-- ğŸ›ï¸ Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© --> 
<div id="mainDashboard" class="gradient-admin min-h-screen p-4 hidden"> 
    <div class="glass rounded-2xl p-6 mb-8 shadow-2xl core-frozen"> 
        <div class="flex justify-between items-center"> 
            <div class="flex items-center space-x-4 space-x-reverse"> 
                <i class="fas fa-shield-alt text-4xl text-green-400"></i> 
                <div> 
                    <h1 class="text-3xl font-bold text-white" id="orgBranding">Ù…Ø¯Ø±Ø³Ø© Ø§Ù„Ø£Ù…Ù„</h1> 
                    <p class="text-white/80 text-sm">Ù†Ø¸Ø§Ù… Ø§Ù„Ø¯ÙˆØ§Ù… Ø§Ù„Ø³ÙŠØ§Ø¯ÙŠ - CORE FROZEN</p> 
                </div> 
            </div> 
            <div class="flex items-center space-x-2 space-x-reverse"> 
                <span class="frozen-badge text-xs px-3 py-1 rounded-full text-sm" id="userRole">Ù…Ø¯ÙŠØ±</span> 
                <span class="secure-badge text-xs px-2 py-1 rounded-full font-bold">v5.0.0-PRO</span> 
                <button onclick="wizzApp.toggleAdminPanel()" class="glass px-4 py-2 rounded-2xl text-white mr-2">âš™ï¸</button> 
                <button onclick="wizzApp.logout()" class="glass px-4 py-2 rounded-2xl text-white">Ø®Ø±ÙˆØ¬</button> 
            </div> 
        </div> 
    </div> 
 
    <!-- ğŸ”¥ Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© --> 
    <div class="grid grid-cols-1 lg:grid-cols-4 gap-6 mb-8"> 
        <div class="glass rounded-2xl p-6 time-card text-white"> 
            <div class="flex justify-between items-center mb-4"> 
                <i class="fas fa-clock text-2xl"></i> 
                <span class="text-lg font-bold">ÙˆÙ‚Øª Ø§Ù„Ø³ÙŠØ±ÙØ± Ø§Ù„Ø±Ø³Ù…ÙŠ</span> 
            </div> 
            <div class="text-3xl font-bold" id="currentWorkTime">00:00:00</div> 
            <p class="text-sm opacity-90 mt-2">ğŸ”’ Ù…ÙØ²Ø§Ù…Ù† Ù…Ø¹ NTP Server <span id="serverTimeSource" 
                                                                         class="text-green-200">worldtimeapi.org</span></p> 
        </div> 
        <div class="glass rounded-2xl p-6"> 
            <h3 class="font-bold text-white mb-4">ğŸ“Š Ø­Ø§Ù„Ø© Ø§Ù„Ù†Ø¸Ø§Ù…</h3> 
            <div class="space-y-3"> 
                <div class="flex justify-between text-white">Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ† Ø§Ù„Ù†Ø´Ø·ÙŠÙ† <span id="activeCount" 
                                                                                   class="font-bold text-green-400">0</span> 
                </div> 
                <div class="flex justify-between text-white">Ø§Ù„Ù…ØªØ£Ø®Ø±ÙˆÙ† Ø§Ù„ÙŠÙˆÙ… <span id="lateCount" 
                                                                                 class="font-bold text-orange-400">0</span> 
                </div> 
                <div class="flex justify-between text-white text-sm">ğŸ“± | ğŸŸ¢ | â˜ï¸ <span id="callTypesToday" 
                                                                                      class="font-bold">0 | 0 | 0</span> 
                </div> 
            </div> 
        </div> 
        <div class="glass rounded-2xl p-6"> 
            <h3 class="font-bold text-white mb-4">ğŸ“¸ Ø¢Ø®Ø± Ø§Ù„ØªØ­Ù‚Ù‚Ø§Øª Ø§Ù„Ø¨ØµØ±ÙŠØ©</h3> 
            <div id="visualVerificationLogDisplay" class="space-y-2 max-h-24 overflow-y-auto"> 
                <p class="text-white/70 text-sm">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø³Ø¬Ù„Ø§Øª ØªØ­Ù‚Ù‚ Ø¨ØµØ±ÙŠ Ø­Ø§Ù„ÙŠØ§Ù‹.</p> 
            </div> 
        </div> 
        <div class="glass rounded-2xl p-6 bg-red-500/10 border border-red-400/50"> 
            <h3 class="font-bold text-white mb-4">ğŸš¨ Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ø§Ù„Ù…Ø¯ÙŠØ±</h3> 
            <div id="managerNotificationsDisplay" class="space-y-2 max-h-24 overflow-y-auto"> 
                <p class="text-white/70 text-sm">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ø­Ø§Ù„ÙŠØ§Ù‹.</p> 
            </div> 
            <button id="clearNotifications" onclick="wizzApp.clearNotifications()" 
                    class="text-xs text-red-300 hover:text-red-100 mt-2">Ù…Ø³Ø­ Ø§Ù„ÙƒÙ„ 
            </button> 
        </div> 
    </div> 
 
    <!-- ğŸ›ï¸ Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ø´ØºÙ„ Ø§Ù„Ù…ÙØ­Ø³Ù‘Ù†Ø© Ù…Ø¹ Ø§Ù„Ø¨Ø­Ø« Ø§Ù„ÙÙˆØ±ÙŠ --> 
    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-8"> 
        <div class="lg:col-span-2 glass rounded-2xl p-6 shadow-2xl"> 
            <div class="flex justify-between items-center mb-6 sticky top-0 z-10 bg-gradient-admin pt-4"> 
                <!-- Sticky search bar --> 
                <h2 class="text-2xl font-bold text-white">ğŸ“‹ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†</h2> 
                <input type="text" id="searchInput" placeholder="ğŸ” Ø§Ø¨Ø­Ø« Ø¨Ø§Ù„Ø§Ø³Ù… Ø£Ùˆ Ø§Ù„Ø±Ù‚Ù…..." 
                       class="glass px-4 py-3 rounded-2xl w-64 text-white placeholder-white/70 focus:outline-none focus:ring-2 focus:ring-[#0052FF] transition-all"> 
                <!-- Updated ring color --> 
            </div> 
            <div id="employeeList" class="space-y-4 max-h-96 overflow-y-auto"></div> 
            <!-- âœ… ØªØµØ¯ÙŠØ± Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„ÙŠÙˆÙ…ÙŠ (Ø£Ù…Ø± 4) --> 
            <button id="exportCsvBtn" class="mt-4 main-button text-white py-2 px-4 rounded-2xl font-bold"> 
                <i class="fas fa-file-csv mr-2"></i>ØªØµØ¯ÙŠØ± ØªÙ‚Ø±ÙŠØ± CSV 
            </button> 
            <button id="exportExcelBtn" class="mt-4 ml-2 bg-blue-500 hover:bg-blue-600 text-white py-2 px-4 rounded-2xl font-bold"> 
                <i class="fas fa-file-excel mr-2"></i>ØªØµØ¯ÙŠØ± ØªÙ‚Ø±ÙŠØ± Excel 
            </button> 
        </div> 
 
        <div class="space-y-4"> 
            <div class="glass rounded-2xl p-6"> 
                <h3 class="font-bold text-white mb-4 flex items-center"> 
                    <i class="fas fa-exclamation-triangle text-orange-400 mr-2"></i> 
                    Ø§Ù„Ù…ØªØ£Ø®Ø±ÙˆÙ† Ø§Ù„ÙŠÙˆÙ… (<span id="liveLateCount">0</span>) 
                </h3> 
                <div id="lateEmployeesList" class="space-y-2 max-h-48 overflow-y-auto"> 
                    <p class="text-white/70 text-center py-8">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…ØªØ£Ø®Ø±ÙˆÙ† Ø­Ø§Ù„ÙŠØ§Ù‹</p> 
                </div> 
                <button id="notifyLateBtn" 
                        class="w-full bg-orange-500 hover:bg-orange-600 text-white py-2 px-4 rounded-2xl font-bold mt-4 transition-all"> 
                    <i class="fab fa-whatsapp mr-2"></i>Ø¥Ø´Ø¹Ø§Ø± Ø¬Ù…Ø§Ø¹ÙŠ Ù„Ù„Ù…ØªØ£Ø®Ø±ÙŠÙ† 
                </button> 
            </div> 
        </div> 
    </div> 
 
    <!-- ğŸ¤ Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ù…ÙƒØ§Ù„Ù…Ø§Øª --> 
    <div id="callPanel" class="glass rounded-2xl p-8 shadow-2xl hidden"> 
        <div class="text-center mb-8"> 
            <div class="w-24 h-24 bg-gradient-to-r from-red-500 to-pink-500 rounded-full mx-auto flex items-center justify-center mb-4 pulse"> 
                <i class="fas fa-phone text-3xl text-white" id="callIcon"></i> 
            </div> 
            <h2 id="callTitle" class="text-3xl font-bold text-white mb-2">Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø§ØªØµØ§Ù„...</h2> 
            <p id="callNumber" class="text-xl text-white/80">0</p> 
            <p id="callType" class="text-lg mt-2 opacity-90"></p> 
        </div> 
        <div class="flex justify-center space-x-4 space-x-reverse"> 
            <button onclick="wizzApp.endCall()" 
                    class="bg-red-500 hover:bg-red-600 text-white px-8 py-4 rounded-2xl text-xl font-bold shadow-2xl"> 
                <i class="fas fa-phone-slash mr-2"></i>Ø¥Ù†Ù‡Ø§Ø¡ 
            </button> 
        </div> 
    </div> 
</div> 
 
<!-- âš™ï¸ Ù„ÙˆØ­Ø© Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¯ÙˆØ§Ù… (Ù…Ø®ÙÙŠØ©) --> 
<div id="adminPanel" class="fixed inset-0 bg-black/90 backdrop-blur-sm hidden z-50 p-8 overflow-y-auto"> 
    <div class="glass max-w-4xl mx-auto rounded-2xl p-8"> 
        <div class="flex justify-between items-center mb-8"> 
            <h2 class="text-3xl font-bold text-white">âš™ï¸ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù†Ø¸Ø§Ù…</h2> 
            <button onclick="wizzApp.toggleAdminPanel()" class="text-3xl text-white">&times;</button> 
        </div> 
 
        <!-- Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ø§Ù„Ùƒ Ø§Ù„Ø³ÙŠØ§Ø¯ÙŠ - Ø¥Ø¶Ø§ÙØ© REVOKE --> 
        <div class="glass p-6 rounded-2xl mb-8 border-4 border-yellow-500/50 bg-gradient-to-r from-yellow-500/20 to-orange-500/20"> 
            <h3 class="font-bold text-yellow-300 text-2xl mb-4 flex items-center"> 
                <i class="fas fa-crown mr-3 text-3xl"></i>Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ø§Ù„Ùƒ Ø§Ù„Ø³ÙŠØ§Ø¯ÙŠ ğŸ‘‘ 
            </h3> 
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4"> 
                <button id="revokeAllPermissions" 
                        class="bg-red-600 hover:bg-red-700 text-white py-4 px-6 rounded-2xl font-bold shadow-xl"> 
                    <i class="fas fa-ban mr-2"></i>REVOKE Ø§Ù„ÙƒÙ„ 
                </button> 
                <button id="unlockAllEmployees" 
                        class="bg-green-600 hover:bg-green-700 text-white py-4 px-6 rounded-2xl font-bold shadow-xl"> 
                    <i class="fas fa-unlock mr-2"></i>ÙØªØ­ Ø§Ù„ÙƒÙ„ 
                </button> 
                <button id="generateSovereigntyReport" 
                        class="bg-purple-600 hover:bg-purple-700 text-white py-4 px-6 rounded-2xl font-bold shadow-xl"> 
                    <i class="fas fa-file-invoice mr-2"></i>ØªÙ‚Ø±ÙŠØ± Ø³ÙŠØ§Ø¯ÙŠ 
                </button> 
            </div> 
        </div> 
 
        <!-- ğŸ”¥ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø¯ÙˆØ§Ù… Ø§Ù„Ø¹Ø§Ù…Ø© --> 
        <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-6 mb-8"> 
            <div class="glass p-6 rounded-2xl"> 
                <h3 class="font-bold text-white mb-4">â° Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø¹Ø§Ù…Ø©</h3> 
                <div class="space-y-4"> 
                    <div> 
                        <label class="block text-white/90 mb-2">ÙˆÙ‚Øª Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø±Ø³Ù…ÙŠ</label> 
                        <input type="time" id="officialEntryTime" value="08:00" 
                               class="w-full glass p-3 rounded-2xl text-white"> 
                    </div> 
                    <div> 
                        <label class="block text-white/90 mb-2">ÙØªØ±Ø© Ø§Ù„Ø³Ù…Ø§Ø­ (Ø¯Ù‚Ø§Ø¦Ù‚)</label> 
                        <select id="gracePeriodMinutes" class="w-full glass p-3 rounded-2xl text-white"> 
                            <option value="5">5 Ø¯Ù‚Ø§Ø¦Ù‚</option> 
                            <option value="10" selected>10 Ø¯Ù‚Ø§Ø¦Ù‚</option> 
                            <option value="15">15 Ø¯Ù‚Ø§Ø¦Ù‚</option> 
                            <option value="20">20 Ø¯Ù‚Ø§Ø¦Ù‚</option> 
                            <option value="30">30 Ø¯Ù‚Ø§Ø¦Ù‚</option> 
                        </select> 
                    </div> 
                    <div> 
                        <label class="block text-white/90 mb-2">ÙˆÙ‚Øª Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ø¹Ù…Ù„ (Ù„Ù„ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ø°ÙƒÙŠ)</label> 
                        <input type="time" id="workEndTime" value="17:00" 
                               class="w-full glass p-3 rounded-2xl text-white"> 
                    </div> 
                    <label class="flex items-center space-x-2 space-x-reverse"> 
                        <input type="checkbox" id="autoAlerts" checked class="w-5 h-5 text-green-600"> 
                        <span class="text-white">ØªÙØ¹ÙŠÙ„ Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ Ù„Ù„Ù…ØªØ£Ø®Ø±ÙŠÙ†</span> 
                    </label> 
                    <label class="flex items-center space-x-2 space-x-reverse"> 
                        <input type="checkbox" id="visualVerificationToggle" checked class="w-5 h-5 text-purple-600"> 
                        <span class="text-white">ØªÙØ¹ÙŠÙ„ Ø§Ù„ØªØ­Ù‚Ù‚ Ø§Ù„Ø¨ØµØ±ÙŠ Ø¹Ù†Ø¯ Ø§Ù„Ø¯Ø®ÙˆÙ„</span> 
                    </label> 
                    <button id="saveWorkSettings" class="w-full main-button text-white py-3 rounded-2xl font-bold"> 
                        <i class="fas fa-save mr-2"></i>Ø­ÙØ¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª 
                    </button> 
                </div> 
            </div> 
 
            <!-- ğŸ¢ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø£Ù‚Ø³Ø§Ù… --> 
            <div class="glass p-6 rounded-2xl"> 
                <h3 class="font-bold text-white mb-4">ğŸ¢ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø£Ù‚Ø³Ø§Ù…</h3> 
                <div class="space-y-3"> 
                    <div class="flex items-center space-x-2 space-x-reverse p-3 bg-white/10 rounded-2xl"> 
                        <span class="text-white font-medium">Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©</span> 
                        <input type="time" value="08:00" class="glass p-2 rounded-2xl text-white w-24 ml-auto" 
                               data-department="Ø¥Ø¯Ø§Ø±Ø©"> 
                    </div> 
                    <div class="flex items-center space-x-2 space-x-reverse p-3 bg-white/10 rounded-2xl"> 
                        <span class="text-white font-medium">Ø§Ù„Ø¹Ù…Ø§Ù„</span> 
                        <input type="time" value="07:00" class="glass p-2 rounded-2xl text-white w-24 ml-auto" 
                               data-department="Ø¹Ù…Ø§Ù„"> 
                    </div> 
                    <div class="flex items-center space-x-2 space-x-reverse p-3 bg-white/10 rounded-2xl"> 
                        <span class="text-white font-medium">Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª</span> 
                        <input type="time" value="09:00" class="glass p-2 rounded-2xl text-white w-24 ml-auto" 
                               data-department="Ù…Ø¨ÙŠØ¹Ø§Øª"> 
                    </div> 
                    <div class="flex items-center space-x-2 space-x-reverse p-3 bg-white/10 rounded-2xl"> 
                        <span class="text-white font-medium">ØªØ¹Ù„ÙŠÙ…</span> 
                        <input type="time" value="08:00" class="glass p-2 rounded-2xl text-white w-24 ml-auto" 
                               data-department="ØªØ¹Ù„ÙŠÙ…"> 
                    </div> 
                    </select> 
                    <button id="saveDepartmentSettings" class="w-full main-button text-white py-3 rounded-2xl font-bold"> 
                        <i class="fas fa-save mr-2"></i>Ø­ÙØ¸ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø£Ù‚Ø³Ø§Ù… 
                    </button> 
                </div> 
            </div> 
 
            <!-- ğŸ“± Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ --> 
            <div class="glass p-6 rounded-2xl lg:col-span-2"> 
                <h3 class="font-bold text-white mb-4">ğŸ“± Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª</h3> 
                <div class="space-y-4"> 
                    <textarea id="lateMessageTemplate" rows="3" class="w-full glass p-4 rounded-2xl text-white resize-none" 
                              placeholder="Ø§ÙƒØªØ¨ Ø±Ø³Ø§Ù„Ø© Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡...">Ù…Ø±Ø­Ø¨Ø§ {Ø§Ø³Ù…_Ø§Ù„Ù…ÙˆØ¸Ù}ØŒ Ù„Ù‚Ø¯ ØªØ£Ø®Ø±Øª {Ø¹Ø¯Ø¯_Ø§Ù„Ø¯Ù‚Ø§Ø¦Ù‚} Ø¯Ù‚ÙŠÙ‚Ø© Ø¹Ù† Ù…ÙˆØ¹Ø¯ Ø§Ù„Ø¯ÙˆØ§Ù…. ÙŠØ±Ø¬Ù‰ Ø§Ù„ØªÙˆØ§ØµÙ„ Ù…Ø¹ Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© ÙÙˆØ±Ø§Ù‹. Ø´ÙƒØ±Ø§Ù‹ - Wizz.ink</textarea> 
                    <div class="flex space-x-3 space-x-reverse"> 
                        <button id="testNotification" class="flex-1 main-button text-white py-3 px-6 rounded-2xl font-bold"> 
                            <i class="fas fa-mobile-alt mr-2"></i>Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø±Ø³Ø§Ù„Ø© 
                        </button> 
                        <button id="sendTestSMS" class="flex-1 bg-green-500 hover:bg-green-600 text-white py-3 px-6 rounded-2xl font-bold"> 
                            <i class="fab fa-whatsapp mr-2"></i>Ø¥Ø±Ø³Ø§Ù„ ØªØ¬Ø±ÙŠØ¨ÙŠ 
                        </button> 
                    </div> 
                </div> 
            </div> 
        </div> 
 
        <!-- ğŸ”¥ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ØªØ­Ù‚Ù‚ Ø§Ù„Ø¨ØµØ±ÙŠ ÙˆØ§Ù„Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø¬ØºØ±Ø§ÙÙŠ --> 
        <div class="glass p-6 rounded-2xl mb-8"> 
            <h3 class="font-bold text-white mb-4">ğŸ“¸ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ØªØ­Ù‚Ù‚ Ø§Ù„Ø¨ØµØ±ÙŠ ÙˆØ§Ù„Ù…ÙˆÙ‚Ø¹</h3> 
            <div class="space-y-4"> 
                <div> 
                    <label class="block text-white/90 mb-2">Ø®Ø· Ø¹Ø±Ø¶ Ù…Ù‚Ø± Ø§Ù„Ø´Ø±ÙƒØ© (Latitude)</label> 
                    <input type="number" step="0.000001" id="companyLat" value="34.01" 
                           class="w-full glass p-3 rounded-2xl text-white"> 
                </div> 
                <div> 
                    <label class="block text-white/90 mb-2">Ø®Ø· Ø·ÙˆÙ„ Ù…Ù‚Ø± Ø§Ù„Ø´Ø±ÙƒØ© (Longitude)</label> 
                    <input type="number" step="0.000001" id="companyLng" value="-6.84" 
                           class="w-full glass p-3 rounded-2xl text-white"> 
                </div> 
                <div> 
                    <label class="block text-white/90 mb-2">Ù†ØµÙ Ù‚Ø·Ø± Ø§Ù„Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ù…Ø³Ù…ÙˆØ­Ø© (Ø£Ù…ØªØ§Ø±)</label> 
                    <input type="number" id="companyRadius" value="100" 
                           class="w-full glass p-3 rounded-2xl text-white"> 
                </div> 
                <div> 
                    <label class="block text-white/90 mb-2">Ø±Ù‚Ù… Ù‡Ø§ØªÙ Ø§Ù„Ù…Ø¯ÙŠØ± Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª Ø§Ù„ÙˆØ§ØªØ³Ø§Ø¨ (Ù…Ø«Ø§Ù„: +2126XXXXXXXX)</label> 
                    <input type="tel" id="managerWhatsAppNumber" class="w-full glass p-3 rounded-2xl text-white" 
                           placeholder="+2126XXXXXXXX"> 
                </div> 
                <button id="saveVisualSettings" class="w-full main-button text-white py-3 rounded-2xl font-bold"> 
                    <i class="fas fa-save mr-2"></i>Ø­ÙØ¸ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ØªØ­Ù‚Ù‚ Ø§Ù„Ø¨ØµØ±ÙŠ 
                </button> 
            </div> 
        </div> 
 
        <!-- ğŸ’° Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ø­ÙØ¸Ø© Ø§Ù„Ø°ÙƒÙŠØ© (Smart Wallet) - ÙÙŠ Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ø¯ÙŠØ± --> 
        <div class="glass p-6 rounded-2xl mb-8"> 
            <h3 class="font-bold text-white mb-6">ğŸ’° Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ø­ÙØ¸Ø© Ø§Ù„Ø°ÙƒÙŠØ© (Ù†Ù‚Ø§Ø· Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†)</h3> 
            <div id="employeePointsDisplay" class="space-y-3 max-h-48 overflow-y-auto"> 
                <p class="text-white/70 text-center">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ù†Ù‚Ø§Ø· Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†...</p> 
            </div> 
        </div> 
 
        <!-- ğŸ”¥ Ù…Ø­Ø±Ùƒ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª (Broadcast Engine) - ÙÙŠ Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ø¯ÙŠØ± --> 
        <div class="glass p-6 rounded-2xl mb-8"> 
            <h3 class="font-bold text-white mb-6">ğŸ“¢ Ø¥Ø±Ø³Ø§Ù„ Ø¥Ø´Ø¹Ø§Ø± Ø¹Ø§Ù… (Modal Broadcast)</h3> 
            <textarea id="broadcastMessage" rows="3" class="w-full glass p-4 rounded-2xl text-white resize-none" 
                      placeholder="Ø§ÙƒØªØ¨ Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ø§Ù„ØªÙŠ Ø³ØªØ¸Ù‡Ø± Ù„Ù„Ù…ÙˆØ¸ÙÙŠÙ† ÙƒÙ€ Modal Ø¹Ù†Ø¯ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„..."></textarea> 
            <button id="sendBroadcastBtn" class="w-full main-button text-white py-3 rounded-2xl font-bold mt-4"> 
                <i class="fas fa-bullhorn mr-2"></i>Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø± Ù„Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ† 
            </button> 
        </div> 
 
        <!-- ğŸ—ºï¸ Ø§Ù„Ø®Ø±ÙŠØ·Ø© Ø§Ù„Ø­Ø±Ø§Ø±ÙŠØ© (Heat Map) - ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…Ø¯ÙŠØ± --> 
        <div class="glass p-6 rounded-2xl mb-8"> 
            <h3 class="font-bold text-white mb-6">ğŸ—ºï¸ Ø§Ù„Ø®Ø±ÙŠØ·Ø© Ø§Ù„Ø­Ø±Ø§Ø±ÙŠØ© Ù„Ù…ÙˆØ§Ù‚Ø¹ Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†</h3> 
            <div id="employeeMap" class="bg-gray-800"></div> 
            <p class="text-white/70 text-sm mt-2">ØªØ¹Ø±Ø¶ Ø§Ù„Ø®Ø±ÙŠØ·Ø© Ø¢Ø®Ø± Ù…ÙˆØ§Ù‚Ø¹ Ø§Ù„Ø­Ø¶ÙˆØ± Ù„Ù„Ù…ÙˆØ¸ÙÙŠÙ†. ÙŠØªØ·Ù„Ø¨ ØªØ­Ø¯ÙŠØ« Ø§Ù„ØµÙØ­Ø© Ù„ØªØ­Ø¯ÙŠØ« 
                Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª.</p> 
        </div> 
 
        <!-- Store Layout v1.0 - Drag & Drop Interface --> 
        <div class="glass p-6 rounded-2xl mb-8"> 
            <h3 class="font-bold text-white mb-6">ğŸ¢ Ù‡Ù†Ø¯Ø³Ø© Ø§Ù„Ù…ÙŠØ¯Ø§Ù† (Store Layout v1.0)</h3> 
            <div class="bg-white p-4 rounded-lg layout-editor-canvas" id="storeLayoutCanvas"> 
                <!-- Draggable employee icons will be rendered here --> 
            </div> 
            <div class="mt-4 flex flex-wrap gap-2"> 
                <select id="employeeToPlaceSelect" class="glass p-2 rounded-md text-white"> 
                    <option value="">Ø§Ø®ØªØ± Ù…ÙˆØ¸Ù Ù„ÙˆØ¶Ø¹Ù‡</option> 
                    <!-- Options filled by JS --> 
                </select> 
                <button id="addEmployeeToLayoutBtn" class="bg-green-500 hover:bg-green-600 text-white px-3 py-2 rounded-md font-bold"> 
                    <i class="fas fa-plus mr-1"></i>Ø¥Ø¶Ø§ÙØ© Ù„Ù„Ù…Ø®Ø·Ø· 
                </button> 
                <button id="saveLayoutBtn" class="main-button text-white px-3 py-2 rounded-md font-bold"> 
                    <i class="fas fa-save mr-1"></i>Ø­ÙØ¸ Ø§Ù„Ù…Ø®Ø·Ø· 
                </button> 
                <button id="clearLayoutBtn" class="bg-red-500 hover:bg-red-600 text-white px-3 py-2 rounded-md font-bold"> 
                    <i class="fas fa-trash-alt mr-1"></i>Ù…Ø³Ø­ Ø§Ù„Ù…Ø®Ø·Ø· 
                </button> 
                <!-- New: Walkie-Talkie Button (Admin) --> 
                <button id="startWalkieTalkieBtn" class="bg-yellow-500 hover:bg-yellow-600 text-white px-3 py-2 rounded-md font-bold"> 
                    <i class="fas fa-walkie-talkie mr-1"></i>Ø§Ø¬ØªÙ…Ø§Ø¹ ÙÙˆØ±ÙŠ (Ù„Ø§Ø³Ù„ÙƒÙŠ) 
                </button> 
                <!-- New: Visual Command Button (Admin) --> 
                <button id="sendVisualCommandBtn" class="bg-blue-500 hover:bg-blue-600 text-white px-3 py-2 rounded-md font-bold"> 
                    <i class="fas fa-camera mr-1"></i>Ø£Ù…Ø± Ø¨ØµØ±ÙŠ (ØµÙˆØ±Ø©) 
                </button> 
            </div> 
            <p class="text-white/70 text-sm mt-2">Ø§Ø³Ø­Ø¨ Ø£ÙŠÙ‚ÙˆÙ†Ø§Øª Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ† Ù„ØªØºÙŠÙŠØ± Ø£Ù…Ø§ÙƒÙ†Ù‡Ù…. Ø§Ù†Ù‚Ø± Ø¹Ù„Ù‰ Ø£ÙŠÙ‚ÙˆÙ†Ø© Ù„Ù„Ø§ØªØµØ§Ù„ Ø§Ù„ÙÙˆØ±ÙŠ.</p> 
        </div> 
 
        <!-- Smart Calculator and Inventory --> 
        <div class="glass p-6 rounded-2xl mb-8"> 
            <h3 class="font-bold text-white mb-6">ğŸ”¢ Ø§Ù„Ø­Ø§Ø³Ø¨Ø© Ø§Ù„Ø³ÙŠØ§Ø¯ÙŠØ© ÙˆØ§Ù„Ø¬Ø±Ø¯</h3> 
            <div class="grid grid-cols-2 gap-4"> 
                <div> 
                    <input type="text" id="calculatorInput" 
                           class="w-full glass p-3 rounded-2xl text-white text-right text-2xl" 
                           placeholder="Ø£Ø¯Ø®Ù„ Ø¹Ù…Ù„ÙŠØ© Ø­Ø³Ø§Ø¨ÙŠØ© Ø£Ùˆ Ø¹Ù…Ù„ÙŠØ© Ø¬Ø±Ø¯..." readonly> 
                    <div class="grid grid-cols-4 gap-2 mt-4"> 
                        <button class="calc-btn glass p-3 rounded-md text-white text-lg" 
                                onclick="wizzApp.calculatorInput('7')">7 
                        </button> 
                        <button class="calc-btn glass p-3 rounded-md text-white text-lg" 
                                onclick="wizzApp.calculatorInput('8')">8 
                        </button> 
                        <button class="calc-btn glass p-3 rounded-md text-white text-lg" 
                                onclick="wizzApp.calculatorInput('9')">9 
                        </button> 
                        <button class="calc-btn glass p-3 rounded-md text-white text-lg bg-blue-600" 
                                onclick="wizzApp.calculatorInput('/')">Ã· 
                        </button> 
 
                        <button class="calc-btn glass p-3 rounded-md text-white text-lg" 
                                onclick="wizzApp.calculatorInput('4')">4 
                        </button> 
                        <button class="calc-btn glass p-3 rounded-md text-white text-lg" 
                                onclick="wizzApp.calculatorInput('5')">5 
                        </button> 
                        <button class="calc-btn glass p-3 rounded-md text-white text-lg" 
                                onclick="wizzApp.calculatorInput('6')">6 
                        </button> 
                        <button class="calc-btn glass p-3 rounded-md text-white text-lg bg-blue-600" 
                                onclick="wizzApp.calculatorInput('*')">Ã— 
                        </button> 
 
                        <button class="calc-btn glass p-3 rounded-md text-white text-lg" 
                                onclick="wizzApp.calculatorInput('1')">1 
                        </button> 
                        <button class="calc-btn glass p-3 rounded-md text-white text-lg" 
                                onclick="wizzApp.calculatorInput('2')">2 
                        </button> 
                        <button class="calc-btn glass p-3 rounded-md text-white text-lg" 
                                onclick="wizzApp.calculatorInput('3')">3 
                        </button> 
                        <button class="calc-btn glass p-3 rounded-md text-white text-lg bg-blue-600" 
                                onclick="wizzApp.calculatorInput('-')">- 
                        </button> 
 
                        <button class="calc-btn glass p-3 rounded-md text-white text-lg" 
                                onclick="wizzApp.calculatorInput('0')">0 
                        </button> 
                        <button class="calc-btn glass p-3 rounded-md text-white text-lg" 
                                onclick="wizzApp.calculatorInput('.')">. 
                        </button> 
                        <button class="calc-btn glass p-3 rounded-md text-white text-lg bg-red-600" 
                                onclick="wizzApp.clearCalculator()">C 
                        </button> 
                        <button class="calc-btn glass p-3 rounded-md text-white text-lg bg-blue-600" 
                                onclick="wizzApp.calculatorInput('+')">+ 
                        </button> 
 
                        <button class="calc-btn glass p-3 rounded-md text-white text-lg col-span-4 bg-green-600" 
                                onclick="wizzApp.performInventoryAction()">ØªÙ†ÙÙŠØ° 
                        </button> 
                    </div> 
                    <p id="calculatorResult" class="text-white text-xl text-right mt-4">Ø§Ù„Ù†ØªÙŠØ¬Ø©: 0</p> 
                    <p class="text-white/70 text-sm mt-2">Ù…Ø«Ø§Ù„: Ø¨ÙŠØ¹ 5 Ù…Ù† Ø§Ù„Ù…Ù†ØªØ¬ X. (Ø³Ø¬Ù„ Ø§Ù„Ù…Ù†ØªØ¬ ÙÙŠ Ø§Ù„Ù…Ø®Ø²ÙˆÙ† Ø£ÙˆÙ„Ø§Ù‹)</p> 
                </div> 
                <div> 
                    <h4 class="font-bold text-white mb-2">Ø§Ù„Ù…Ø®Ø²ÙˆÙ† Ø§Ù„Ø­Ø§Ù„ÙŠ</h4> 
                    <div id="inventoryDisplay" class="space-y-2 max-h-64 overflow-y-auto"> 
                        <!-- Inventory items will be rendered here --> 
                    </div> 
                    <div class="mt-4 flex gap-2"> 
                        <input type="text" id="newInventoryItem" class="glass p-2 rounded-md text-white flex-grow" 
                               placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬"> 
                        <input type="number" id="newInventoryQuantity" class="glass p-2 rounded-md text-white w-20" 
                               value="0"> 
                        <button id="addInventoryItemBtn" class="bg-green-500 hover:bg-green-600 text-white px-3 py-2 rounded-md font-bold"> 
                            <i class="fas fa-plus mr-1"></i>Ø¥Ø¶Ø§ÙØ© 
                        </button> 
                    </div> 
                </div> 
            </div> 
        </div> 
 
        <!-- ğŸ‘¥ Ø·Ù„Ø¨Ø§Øª Ø§Ù„ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ù…Ø¹Ù„Ù‚Ø© Ù„Ù„Ù…Ø¯ÙŠØ± --> 
        <div class="glass p-6 rounded-2xl mb-8"> 
            <h3 class="font-bold text-white mb-6">ğŸ‘¥ Ø·Ù„Ø¨Ø§Øª Ø§Ù„ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ù…Ø¹Ù„Ù‚Ø©</h3> 
            <div id="pendingRequestsContainer" class="space-y-3 max-h-48 overflow-y-auto"> 
                <p class="text-white/70 text-center">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª ØªØ³Ø¬ÙŠÙ„ Ù…Ø¹Ù„Ù‚Ø©.</p> 
            </div> 
        </div> 
 
        <!-- ğŸ“ˆ ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ù…ØªØ£Ø®Ø±ÙŠÙ† --> 
        <div class="glass p-6 rounded-2xl mb-8"> 
            <h3 class="font-bold text-white mb-6">ğŸ“ˆ ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ù…ØªØ£Ø®Ø±ÙŠÙ† (Ø§Ù„ÙŠÙˆÙ…)</h3> 
            <div class="overflow-x-auto"> 
                <table class="w-full text-white"> 
                    <thead> 
                    <tr class="border-b border-white/20"> 
                        <th class="text-right pr-4 py-3">Ø§Ù„Ù…ÙˆØ¸Ù</th> 
                        <th class="text-right pr-4 py-3">Ø§Ù„ØªØ£Ø®ÙŠØ±</th> 
                        <th class="text-right pr-4 py-3">Ø§Ù„ÙˆÙ‚Øª</th> 
                        <th class="text-center py-3">Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡</th> 
                    </tr> 
                    </thead> 
                    <tbody id="lateReportTable"> 
                    <!-- Ø³ÙŠØªÙ… Ù…Ù„Ø¤Ù‡Ø§ Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠØ§Ù‹ --> 
                    </tbody> 
                </table> 
            </div> 
        </div> 
 
        <!-- ğŸ“Š Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„ØªØ£Ø®ÙŠØ± Ø§Ù„Ø´Ù‡Ø±ÙŠØ© --> 
        <div class="glass p-6 rounded-2xl mb-8"> 
            <h3 class="font-bold text-white mb-4">ğŸ“Š Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„ØªØ£Ø®ÙŠØ± Ø§Ù„Ø´Ù‡Ø±ÙŠØ© 
                <button id="monthlyLateReportBtn" class="ml-2 bg-purple-500 text-xs px-3 py-1 rounded-full">ğŸ“ˆ ØªÙ‚Ø±ÙŠØ± 
                </button> 
            </h3> 
            <div id="monthlyLateStats" class="space-y-2 max-h-48 overflow-y-auto"></div> 
        </div> 
 
        <!-- ğŸ“ Ù†Ø¸Ø§Ù… Ø§Ù„Ø§Ø¹ØªØ±Ø§Ø¶ Ø§Ù„Ø±Ù‚Ù…ÙŠ - ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…Ø¯ÙŠØ± --> 
        <div class="glass p-6 rounded-2xl mb-8"> 
            <h3 class="font-bold text-white mb-6">ğŸ“ Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø§Ø¹ØªØ±Ø§Ø¶ Ø§Ù„Ø±Ù‚Ù…ÙŠ</h3> 
            <div id="objectionRequestsDisplay" class="space-y-3 max-h-48 overflow-y-auto"> 
                <p class="text-white/70 text-center">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª Ø§Ø¹ØªØ±Ø§Ø¶ Ø­Ø§Ù„ÙŠØ§Ù‹.</p> 
            </div> 
        </div> 
 
        <!-- Customer Feedback Display for Manager --> 
        <div class="glass p-6 rounded-2xl mb-8"> 
            <h3 class="font-bold text-white mb-6">ğŸ’¬ ØµÙ†Ø¯ÙˆÙ‚ Ø¢Ø±Ø§Ø¡ Ø§Ù„Ø²Ø¨Ø§Ø¦Ù†</h3> 
            <div id="customerFeedbackDisplay" class="space-y-3 max-h-48 overflow-y-auto"> 
                <p class="text-white/70 text-center">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¢Ø±Ø§Ø¡ Ù„Ù„Ø²Ø¨Ø§Ø¦Ù† Ø­Ø§Ù„ÙŠØ§Ù‹.</p> 
            </div> 
            <button id="clearCustomerFeedbackBtn" class="text-xs text-red-300 hover:text-red-100 mt-2">Ù…Ø³Ø­ Ø§Ù„ÙƒÙ„ 
            </button> 
        </div> 
 
        <!-- The 5 Virtual Offices Admin Management --> 
        <div class="glass p-6 rounded-2xl mb-8"> 
            <h3 class="font-bold text-white mb-6">ğŸ›ï¸ Ø§Ù„Ù…ÙƒØ§ØªØ¨ Ø§Ù„Ø³ÙŠØ§Ø¯ÙŠØ© Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ©</h3> 
            <div id="virtualOfficesDisplay" class="space-y-3 max-h-48 overflow-y-auto"> 
                <!-- Virtual offices will be listed here --> 
            </div> 
            <div class="mt-4 flex flex-wrap gap-2"> 
                <input type="text" id="newOfficeName" class="glass p-2 rounded-md text-white flex-grow" 
                       placeholder="Ø§Ø³Ù… Ø§Ù„Ù…ÙƒØªØ¨ Ø§Ù„Ø¬Ø¯ÙŠØ¯"> 
                <input type="password" id="newOfficeKey" class="glass p-2 rounded-md text-white w-32" 
                       placeholder="Ù…ÙØªØ§Ø­ Ø¯Ø®ÙˆÙ„"> 
                <select id="officeRolesSelect" class="glass p-2 rounded-md text-white"> 
                    <option value="Ù…Ø³Ø§Ø¹Ø¯">Ù…Ø³Ø§Ø¹Ø¯ (Ø­Ø¶ÙˆØ± ÙÙ‚Ø·)</option> 
                    <option value="Ø¶Ø§Ø¨Ø·_Ø¥Ø¯Ø§Ø±ÙŠ">Ø¶Ø§Ø¨Ø· Ø¥Ø¯Ø§Ø±ÙŠ (Ø¹Ù‚ÙˆØ¨Ø§Øª)</option> 
                    <option value="Ø³ÙƒØ±ØªÙŠØ±">Ø³ÙƒØ±ØªÙŠØ± (ØºÙŠØ§Ø¨ ÙÙ‚Ø·)</option> 
                    <option value="Ø£Ù…Ù†">Ø£Ù…Ù† (GPS)</option> 
                    <option value="Ù…Ø§Ù„ÙŠ">Ù…Ø§Ù„ÙŠ (Ø±ÙˆØ§ØªØ¨+Ø¬Ø±Ø¯)</option> 
                </select> 
                <button id="addVirtualOfficeBtn" class="bg-green-500 hover:bg-green-600 text-white px-3 py-2 rounded-md font-bold"> 
                    <i class="fas fa-plus mr-1"></i>Ø¥Ø¶Ø§ÙØ© Ù…ÙƒØªØ¨ 
                </button> 
            </div> 
            <h4 class="font-bold text-white mt-6 mb-4">Ø³Ø¬Ù„ Ø§Ù„Ø³ÙŠØ§Ø¯Ø© (Admin Log)</h4> 
            <div id="sovereigntyLogDisplay" class="space-y-2 max-h-48 overflow-y-auto"> 
                <p class="text-white/70 text-sm">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø­Ø±ÙƒØ§Øª Ù…Ø³Ø¬Ù„Ø© Ø­Ø§Ù„ÙŠØ§Ù‹.</p> 
            </div> 
        </div> 
 
        <!-- Traffic Light Violations for Employees --> 
        <div class="glass p-6 rounded-2xl mb-8"> 
            <h3 class="font-bold text-white mb-6">ğŸš¦ Ù…Ø®Ø§Ù„ÙØ§Øª Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ† (Ù†Ø¸Ø§Ù… Ø§Ù„Ø¥Ø´Ø§Ø±Ø§Øª)</h3> 
            <div id="trafficLightViolationsDisplay" class="space-y-3 max-h-48 overflow-y-auto"> 
                <p class="text-white/70 text-center">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø®Ø§Ù„ÙØ§Øª Ù…Ø³Ø¬Ù„Ø©.</p> 
            </div> 
        </div> 
 
 
        <!-- ğŸ”¥ Ù…Ø³Ø­ ØµÙˆØ± Ø§Ù„Ø­Ø¶ÙˆØ± Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø© ÙŠØ¯ÙˆÙŠØ§Ù‹ (Ø²Ø± Ø§Ù„ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ø°ÙƒÙŠ Ø§Ù„ÙŠØ¯ÙˆÙŠ) --> 
        <div class="glass p-6 rounded-2xl mb-8"> 
            <h3 class="font-bold text-white mb-4">ğŸ§¹ ØµÙŠØ§Ù†Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</h3> 
            <button id="manualCleanupBtn" 
                    class="w-full bg-gray-700 hover:bg-gray-800 text-white py-3 rounded-2xl font-bold"> 
                <i class="fas fa-broom mr-2"></i>Ù…Ø³Ø­ ØµÙˆØ± Ø§Ù„Ø­Ø¶ÙˆØ± Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø© ÙŠØ¯ÙˆÙŠØ§Ù‹ (Ø£ÙƒØ«Ø± Ù…Ù† 24 Ø³Ø§Ø¹Ø©) 
            </button> 
            <p class="text-white/70 text-sm mt-2">ÙŠØªÙ… Ù‡Ø°Ø§ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ ÙŠÙˆÙ…ÙŠØ§Ù‹ØŒ Ù‡Ø°Ø§ Ø§Ù„Ø²Ø± Ù„Ù„ØªÙ†Ø¸ÙŠÙ Ø§Ù„ÙŠØ¯ÙˆÙŠ Ø§Ù„ÙÙˆØ±ÙŠ.</p> 
        </div> 
 
        <!-- ğŸ”¥ Ø´Ø§Ø´Ø© Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙˆØ§Ù„ØªØ®Ø²ÙŠÙ† --> 
        <div id="dataManagementSection" class="glass p-8 rounded-2xl mb-8"> 
            <div class="flex justify-between items-center mb-8"> 
                <h2 class="text-3xl font-bold text-white">ğŸ’¾ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙˆØ§Ù„ØªØ®Ø²ÙŠÙ†</h2> 
                <div class="text-sm bg-yellow-500/20 border border-yellow-400/50 px-4 py-2 rounded-2xl"> 
                    <span id="currentStorageModeDisplay"></span> 
                </div> 
            </div> 
 
            <!-- ğŸ“‹ Ø´Ø§Ø´Ø© Ø§Ù„ØªØ±Ø­ÙŠØ¨ Ø§Ù„Ø£ÙˆÙ„ÙŠ Ù„Ø§Ø®ØªÙŠØ§Ø± ÙˆØ¶Ø¹ Ø§Ù„ØªØ®Ø²ÙŠÙ† --> 
            <div id="storageSetupScreen" 
                 class="text-center mb-12 p-8 bg-gradient-to-r from-blue-500/20 to-purple-500/20 rounded-2xl border-2 border-white/20"> 
                <div class="mb-6"> 
                    <i class="fas fa-shield-alt text-6xl text-yellow-400 mb-4"></i> 
                    <h3 class="text-2xl font-bold text-white mb-2">Ø£Ù†Øª ØªÙ…Ù„Ùƒ Ø¨ÙŠØ§Ù†Ø§ØªÙƒ Ø¨Ø§Ù„ÙƒØ§Ù…Ù„</h3> 
                    <p class="text-xl text-white/90">Ø§Ø®ØªØ± Ø§Ù„Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„ØªÙŠ ØªØ±ÙŠØ¯ Ø¨Ù‡Ø§ Ø­Ù…Ø§ÙŠØ© Ø¨ÙŠØ§Ù†Ø§Øª Ø´Ø±ÙƒØªÙƒ</p> 
                </div> 
 
                <div class="grid md:grid-cols-3 gap-6 mb-8"> 
                    <!-- Ø®ÙŠØ§Ø± 1: Ø§Ù„ØªØ®Ø²ÙŠÙ† Ø§Ù„Ù…Ø­Ù„ÙŠ --> 
                    <div class="glass p-6 rounded-2xl hover:shadow-2xl transition-all cursor-pointer group" 
                         onclick="wizzApp.selectStorageMode('local')"> 
                        <div class="w-16 h-16 bg-blue-500 rounded-2xl mx-auto flex items-center justify-center mb-4 group-hover:scale-110 transition-transform"> 
                            <i class="fas fa-hdd text-2xl text-white"></i> 
                        </div> 
                        <h4 class="font-bold text-xl text-white mb-2">Ø§Ù„ØªØ®Ø²ÙŠÙ† Ø§Ù„Ù…Ø­Ù„ÙŠ</h4> 
                        <p class="text-white/80 text-sm mb-4">IndexedDB ÙÙŠ Ø§Ù„Ù…ØªØµÙØ­</p> 
                        <div class="bg-blue-500/20 border border-blue-400/50 px-3 py-1 rounded-2xl text-xs font-bold text-blue-200"> 
                            ğŸ”’ Ø¢Ù…Ù† ÙˆØ³Ø±ÙŠØ¹ 
                        </div> 
                    </div> 
 
                    <!-- Ø®ÙŠØ§Ø± 2: Ø§Ù„Ø±Ø¨Ø· Ø§Ù„Ø³Ø­Ø§Ø¨ÙŠ Ø§Ù„Ø®Ø§Øµ --> 
                    <div class="glass p-6 rounded-2xl hover:shadow-2xl transition-all cursor-pointer group" 
                         onclick="wizzApp.selectStorageMode('api')"> 
                        <div class="w-16 h-16 bg-purple-500 rounded-2xl mx-auto flex items-center justify-center mb-4 group-hover:scale-110 transition-transform"> 
                            <i class="fas fa-cloud text-2xl text-white"></i> 
                        </div> 
                        <h4 class="font-bold text-xl text-white mb-2">Ø§Ù„Ø±Ø¨Ø· Ø§Ù„Ø³Ø­Ø§Ø¨ÙŠ Ø§Ù„Ø®Ø§Øµ</h4> 
                        <p class="text-white/80 text-sm mb-4">Firebase/Supabase API Ø§Ù„Ø®Ø§Øµ Ø¨Ùƒ</p> 
                        <div class="bg-purple-500/20 border border-purple-400/50 px-3 py-1 rounded-2xl text-xs font-bold text-purple-200"> 
                            â˜ï¸ Ø®Ø§Ø¯Ù…Ùƒ Ø§Ù„Ø®Ø§Øµ 
                        </div> 
                    </div> 
 
                    <!-- Ø®ÙŠØ§Ø± 3: Ø§Ù„Ù†Ù‚Ù„ Ø§Ù„ÙŠØ¯ÙˆÙŠ --> 
                    <div class="glass p-6 rounded-2xl hover:shadow-2xl transition-all cursor-pointer group" 
                         onclick="wizzApp.selectStorageMode('manual')"> 
                        <div class="w-16 h-16 bg-orange-500 rounded-2xl mx-auto flex items-center justify-center mb-4 group-hover:scale-110 transition-transform"> 
                            <i class="fas fa-exchange-alt text-2xl text-white"></i> 
                        </div> 
                        <h4 class="font-bold text-xl text-white mb-2">Ø§Ù„Ù†Ù‚Ù„ Ø§Ù„ÙŠØ¯ÙˆÙŠ</h4> 
                        <p class="text-white/80 text-sm mb-4">Ù…Ù„ÙØ§Øª JSON Ù…Ø­Ù…ÙˆÙ„Ø©</p> 
                        <div class="bg-orange-500/20 border border-orange-400/50 px-3 py-1 rounded-2xl text-xs font-bold text-orange-200"> 
                            ğŸ“± ÙÙ„Ø§Ø´ Ù…ÙŠÙ…ÙˆØ±ÙŠ 
                        </div> 
                    </div> 
                </div> 
            </div> 
 
            <!-- âš™ï¸ Ø®ÙŠØ§Ø±Ø§Øª Ø§Ù„ØªØ®Ø²ÙŠÙ† Ø§Ù„Ù…ØªÙ‚Ø¯Ù…Ø© --> 
            <div id="advancedStorageOptions" class="space-y-6 hidden"> 
                <!-- Ø§Ù„Ù†Ù‚Ù„ Ø§Ù„ÙŠØ¯ÙˆÙŠ --> 
                <div class="glass p-6 rounded-2xl"> 
                    <h3 class="font-bold text-white mb-6 flex items-center"> 
                        <i class="fas fa-download text-orange-400 mr-3"></i>Ø§Ù„Ø®Ø²Ù†Ø© Ø§Ù„Ù…ØªÙ†Ù‚Ù„Ø© (JSON) 
                    </h3> 
                    <div class="grid md:grid-cols-2 gap-4"> 
                        <button id="exportData" 
                                class="main-button text-white py-4 px-6 rounded-2xl font-bold shadow-xl hover:shadow-2xl transition-all"> 
                            <i class="fas fa-file-download mr-2"></i>ØªØ­Ù…ÙŠÙ„ Ù†Ø³Ø®Ø© Ø§Ø­ØªÙŠØ§Ø·ÙŠØ© 
                        </button> 
                        <label class="bg-gradient-to-r from-orange-500 to-red-600 hover:from-orange-600 hover:to-red-700 text-white py-4 px-6 rounded-2xl font-bold shadow-xl hover:shadow-2xl transition-all cursor-pointer flex items-center justify-center"> 
                            <i class="fas fa-file-upload mr-2"></i>Ø±ÙØ¹ Ù†Ø³Ø®Ø© Ø§Ø­ØªÙŠØ§Ø·ÙŠØ© 
                            <input type="file" id="importFileInput" accept=".json" class="hidden"> 
                        </label> 
                    </div> 
                    <p class="text-white/70 text-sm mt-3">ğŸ’¾ Ø§Ø­ÙØ¸ Ø§Ù„Ù…Ù„Ù ÙÙŠ Ù…ÙƒØ§Ù† Ø¢Ù…Ù† Ø£Ùˆ ÙÙ„Ø§Ø´ Ù…ÙŠÙ…ÙˆØ±ÙŠ. Ù‚Ø¯ ÙŠÙØ·Ù„Ø¨ "ÙƒÙ„Ù…Ø© Ù…Ø±ÙˆØ±" 
                        Ùˆ "Ù…Ù„Ø­" Ù„Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª.</p> 
                </div> 
 
                <!-- Ø§Ù„ØªØ¯Ù…ÙŠØ± Ø§Ù„Ø°Ø§ØªÙŠ --> 
                <div class="glass p-6 rounded-2xl bg-red-500/10 border-2 border-red-400/30"> 
                    <h3 class="font-bold text-white mb-6 flex items-center"> 
                        <i class="fas fa-bomb text-red-400 mr-3 text-2xl"></i>Ø£ÙˆØ§Ù…Ø± Ø§Ù„ØªØ¯Ù…ÙŠØ± Ø§Ù„Ø°Ø§ØªÙŠ 
                    </h3> 
                    <button id="clearAllWizzData" 
                            class="w-full bg-gradient-to-r from-red-600 to-red-800 hover:from-red-700 hover:to-red-900 text-white py-4 px-8 rounded-2xl font-bold shadow-2xl hover:shadow-3xl transition-all flex items-center justify-center"> 
                        <i class="fas fa-skull-crossbones mr-3"></i>Ù…Ø³Ø­ Ø´Ø§Ù…Ù„ Ù„Ø¨ÙŠØ§Ù†Ø§Øª Wizz 
                    </button> 
                    <p class="text-red-300 text-sm mt-3 font-medium">âš ï¸ Ù‡Ø°Ø§ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ØªØ±Ø§Ø¬Ø¹ Ø¹Ù†Ù‡</p> 
                </div> 
 
                <!-- Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø© Ø§Ù„Ù‚Ø§Ù†ÙˆÙ†ÙŠØ© --> 
                <div class="glass p-6 rounded-2xl border-2 border-yellow-400/30 bg-yellow-500/5"> 
                    <h4 class="font-bold text-yellow-300 mb-4 flex items-center"> 
                        <i class="fas fa-gavel mr-2"></i>Ù…Ù„Ø§Ø­Ø¸Ø© Ù‚Ø§Ù†ÙˆÙ†ÙŠØ© Ù…Ù‡Ù…Ø© 
                    </h4> 
                    <p class="text-white/90 text-sm leading-relaxed"> 
                        Ù†Ø¸Ø§Ù… Wizz ÙŠÙˆÙØ± **Ø§Ù„Ø£Ø¯ÙˆØ§Øª Ø§Ù„Ø¨Ø±Ù…Ø¬ÙŠØ© ÙÙ‚Ø·**. Ø¨ØµÙØªÙƒ Ù…Ø¯ÙŠØ±Ø§Ù‹ØŒ Ø£Ù†Øª **Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„ Ø§Ù„ÙˆØ­ÙŠØ¯** Ø¹Ù†:<br> 
                        âœ… Ø§Ø®ØªÙŠØ§Ø± ÙˆØ³ÙŠÙ„Ø© Ø§Ù„ØªØ®Ø²ÙŠÙ†<br> 
                        âœ… Ø­Ù…Ø§ÙŠØ© ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ù…Ø±ÙˆØ±<br> 
                        âœ… Ø§Ù„Ù†Ø³Ø® Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠ Ù„Ø¨ÙŠØ§Ù†Ø§ØªÙƒ<br> 
                        <strong class="text-yellow-300">ğŸš« Ù…Ø·ÙˆØ±Ùˆ Wizz Ù„Ø§ ÙŠÙ…Ù„ÙƒÙˆÙ† Ø£ÙŠ ÙˆØµÙˆÙ„ Ù„Ø¨ÙŠØ§Ù†Ø§ØªÙƒ Ø¨Ø£ÙŠ Ø´ÙƒÙ„ Ù…Ù† Ø§Ù„Ø£Ø´ÙƒØ§Ù„</strong> 
                    </p> 
                </div> 
            </div> 
        </div> 
    </div> 
</div> 
 
<!-- ğŸ” Ø´Ø§Ø´Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ù„Ù„Ù…ÙˆØ¸Ù --> 
<div id="authModal" class="fixed inset-0 bg-black/80 backdrop-blur-sm hidden z-50 flex items-center justify-center p-8"> 
    <div class="glass max-w-2xl w-full rounded-2xl p-8"> 
        <div class="text-right mb-8"> 
            <button onclick="wizzApp.hideModal()" class="text-3xl text-white">&times;</button> 
        </div> 
 
        <!-- Legal Agreement Screen --> 
        <div id="legalAgreementScreen" class="hidden text-white text-center"> 
            <h2 class="text-3xl font-bold mb-6">Ø§ØªÙØ§Ù‚ÙŠØ© Ø´Ø±ÙˆØ· Ø§Ù„Ø¹Ù…Ù„ (Ø§Ù„Ø¥ØµØ¯Ø§Ø± 1.0)</h2> 
            <p class="mb-4 text-justify"> 
                Ø£Ù‚Ø± Ø£Ù†Ø§ØŒ Ø§Ù„Ù…ÙˆØ¸ÙØŒ Ø¨Ø£Ù†Ù†ÙŠ Ù‚Ø¯ Ù‚Ø±Ø£Øª ÙˆÙÙ‡Ù…Øª Ø¬Ù…ÙŠØ¹ Ø´Ø±ÙˆØ· ÙˆØ£Ø­ÙƒØ§Ù… Ø§Ù„Ø¹Ù…Ù„ Ø§Ù„Ù…Ø¹Ø±ÙˆØ¶Ø© Ù…Ù† Ù‚Ø¨Ù„ Wizz.ink. 
                Ø£ØªØ¹Ù‡Ø¯ Ø¨Ø§Ù„Ø§Ù…ØªØ«Ø§Ù„ Ø§Ù„ØªØ§Ù… Ù„Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø³ÙŠØ§Ø³Ø§Øª ÙˆØ§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø§Ù„Ù…Ø¹Ù…ÙˆÙ„ Ø¨Ù‡Ø§ ÙÙŠ Ø§Ù„Ù…Ø¤Ø³Ø³Ø©ØŒ ÙˆØ£ÙˆØ§ÙÙ‚ Ø¹Ù„Ù‰ Ø£Ù† Ù†Ø¸Ø§Ù… Wizz.ink Ù‡Ùˆ Ø§Ù„Ù…Ø±Ø¬Ø¹ Ø§Ù„Ù‚Ø§Ù†ÙˆÙ†ÙŠ 
                ÙˆØ§Ù„ÙˆØ­ÙŠØ¯ Ù„Ø£ÙŠ Ø®ØµÙ… Ù…Ø§Ù„ÙŠ Ø£Ùˆ Ø¥Ø¬Ø±Ø§Ø¡ ØªØ£Ø¯ÙŠØ¨ÙŠ Ù‚Ø¯ ÙŠØªÙ… Ø§ØªØ®Ø§Ø°Ù‡ Ø¶Ø¯ÙŠ Ù†ØªÙŠØ¬Ø© Ù„Ù…Ø®Ø§Ù„ÙØ© Ù‡Ø°Ù‡ Ø§Ù„Ø´Ø±ÙˆØ·. 
                Ø£Ø¹Ù„Ù… Ø£Ù† Ø£ÙŠ Ù…Ø­Ø§ÙˆÙ„Ø© Ø§Ø®ØªØ±Ø§Ù‚ Ø£Ùˆ ØªÙ„Ø§Ø¹Ø¨ Ø¨Ø§Ù„Ù†Ø¸Ø§Ù… Ø³ØªØ¹Ø±Ø¶Ù†ÙŠ Ù„Ù„Ø¹Ù‚ÙˆØ¨Ø§Øª Ø§Ù„Ù…Ù†ØµÙˆØµ Ø¹Ù„ÙŠÙ‡Ø§ ÙÙŠ Ø§Ù„Ø¨Ù†ÙˆØ¯ Ø§Ù„Ø®Ø§ØµØ© Ø¨Ø­Ù…Ø§ÙŠØ© Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø¤Ø³Ø³Ø©. 
                Ø£ØªØ¹Ù‡Ø¯ Ø¨Ø£Ù†Ù†ÙŠ Ù„Ù† Ø£Ù‚ÙˆÙ… Ø¨Ù…Ø­Ø§ÙˆÙ„Ø© ØªØ¬Ø§ÙˆØ² Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª Ø§Ù„Ù…Ù…Ù†ÙˆØ­Ø© Ù„ÙŠ Ø£Ùˆ Ø§Ù„ÙˆØµÙˆÙ„ Ø¥Ù„Ù‰ Ø¨ÙŠØ§Ù†Ø§Øª ØºÙŠØ± Ù…ØµØ±Ø­ Ù„ÙŠ Ø¨Ø§Ù„Ø§Ø·Ù„Ø§Ø¹ Ø¹Ù„ÙŠÙ‡Ø§. 
            </p> 
            <p class="text-red-400 font-bold mb-6">Ù…Ù„Ø§Ø­Ø¸Ø©: Ù„Ù† ØªØªÙ…ÙƒÙ† Ù…Ù† Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ù‚Ø¨Ù„ Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø© Ø¹Ù„Ù‰ Ù‡Ø°Ù‡ Ø§Ù„Ø´Ø±ÙˆØ·.</p> 
            <button id="acceptLegalAgreementBtn" class="main-button text-white py-3 px-8 rounded-2xl font-bold"> 
                Ø£ÙˆØ§ÙÙ‚ ÙˆØ£Ù‚Ø± Ø¨Ø§Ù„ØªÙˆÙ‚ÙŠØ¹ Ø§Ù„Ø±Ù‚Ù…ÙŠ 
            </button> 
        </div> 
 
 
        <!-- Ø´Ø§Ø´Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø¹Ø§Ø¯ÙŠØ© --> 
        <div id="loginForm"> 
            <h2 class="text-3xl font-bold text-white mb-6 text-center">ğŸ” ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø¢Ù…Ù†</h2> 
            <div class="mb-4"> 
                <label for="loginPhone" class="block text-white/90 mb-2">Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ</label> 
                <input type="tel" id="loginPhone" class="w-full glass p-3 rounded-2xl text-white" 
                       placeholder="Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ Ø§Ù„Ù…Ø³Ø¬Ù„" required> 
            </div> 
            <div class="mb-6"> 
                <label for="loginPassword" class="block text-white/90 mb-2">ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</label> 
                <input type="password" id="loginPassword" class="w-full glass p-3 rounded-2xl text-white" 
                       placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±" required> 
            </div> 
            <!-- Virtual Office Key Input --> 
            <div class="mb-6" id="virtualOfficeKeyContainer"> 
                <label for="virtualOfficeKey" class="block text-white/90 mb-2">Ù…ÙØªØ§Ø­ Ø§Ù„Ù…ÙƒØªØ¨ Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label> 
                <input type="password" id="virtualOfficeKey" class="w-full glass p-3 rounded-2xl text-white" 
                       placeholder="Ø£Ø¯Ø®Ù„ Ù…ÙØªØ§Ø­ Ø§Ù„Ù…ÙƒØªØ¨ Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ"> 
            </div> 
            <div class="text-center mb-6 p-4 time-card rounded-2xl"> 
                <div class="text-2xl font-bold mb-1" id="loginCurrentTime">00:00:00</div> 
                <div class="text-sm opacity-90">ÙˆÙ‚Øª Ø§Ù„Ø³ÙŠØ±ÙØ± Ø§Ù„Ø±Ø³Ù…ÙŠ</div> 
            </div> 
            <button id="employeeLoginBtn" class="w-full main-button text-white py-4 rounded-2xl font-bold mb-4"> 
                <i class="fas fa-camera mr-2"></i>ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨Ø§Ù„ØªØ­Ù‚Ù‚ Ø§Ù„Ø¨ØµØ±ÙŠ 
            </button> 
            <button id="voiceSignatureBtn" 
                    class="w-full bg-blue-600 hover:bg-blue-700 text-white py-4 rounded-2xl font-bold mb-4 flex items-center justify-center"> 
                <i class="fas fa-microphone-alt mr-2"></i>ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨Ø§Ù„ØªÙˆÙ‚ÙŠØ¹ Ø§Ù„ØµÙˆØªÙŠ 
            </button> 
            <p id="loginMessage" class="text-red-400 text-center mt-3"></p> 
            <!-- SOS Button for Employee --> 
            <button id="sosButton" class="w-full bg-red-700 hover:bg-red-800 text-white py-3 rounded-2xl font-bold mt-4"> 
                <i class="fas fa-exclamation-triangle mr-2"></i>Ø²Ø± Ø§Ù„Ø·ÙˆØ§Ø±Ø¦ SOS 
            </button> 
            <button type="button" onclick="wizzApp.showSignupModal()" 
                    class="w-full bg-transparent border border-white/20 text-white py-3 rounded-2xl font-bold mt-3 hover:bg-white/10"> 
                <i class="fas fa-user-plus mr-2"></i>ØªØ³Ø¬ÙŠÙ„ Ù…ÙˆØ¸Ù Ø¬Ø¯ÙŠØ¯ 
            </button> 
        </div> 
 
        <!-- Ø´Ø§Ø´Ø© Ø§Ù„ØªØ­Ù‚Ù‚ Ø§Ù„Ø¨ØµØ±ÙŠ Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© --> 
        <div id="visualVerificationScreen" class="hidden"> 
            <h2 class="text-3xl font-bold text-white mb-6 text-center">ğŸ“¸ Ø§Ù„ØªØ­Ù‚Ù‚ Ø§Ù„Ø¨ØµØ±ÙŠ Ø§Ù„Ø¢Ù…Ù†</h2> 
            <p class="mb-6 text-gray-300 text-center">Ø§Ù†Ø¸Ø± Ù…Ø¨Ø§Ø´Ø±Ø© Ù„Ù„ÙƒØ§Ù…ÙŠØ±Ø§ - Ø³ÙŠØªÙ… Ø§Ù„ØªÙ‚Ø§Ø· Ø§Ù„ØµÙˆØ±Ø© ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹</p> 
 
            <div class="relative mb-6 mx-auto w-full max-w-md"> 
                <video id="liveVideo" autoplay playsinline class="video-feed w-full h-64 object-cover"></video> 
                <div class="absolute inset-0 flex items-center justify-center bg-black bg-opacity-50 text-white text-xl font-bold" 
                     id="loadingText"> 
                    <i class="fas fa-spinner fa-spin mr-2"></i>Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§... 
                </div> 
                <canvas id="hiddenCanvas" class="hidden"></canvas> 
                <img id="capturedImage" class="hidden w-full h-64 object-cover mt-4 rounded-2xl border-4 border-emerald-500" 
                     alt="Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„Ù…Ù„ØªÙ‚Ø·Ø©"> 
            </div> 
 
            <div class="secure-badge text-xs px-3 py-1 rounded-full text-center mb-4 mx-auto w-fit"> 
                ğŸ”’ Ø§Ù„ØµÙˆØ±Ø© Ù…Ø´ÙØ±Ø© ÙˆÙ…Ø­ÙÙˆØ¸Ø© Ù…Ø­Ù„ÙŠØ§Ù‹ ÙÙ‚Ø· 
            </div> 
 
            <p id="statusMessage" class="mt-4 text-lg font-medium text-center"></p> 
            <button id="backToLoginBtn" 
                    class="w-full bg-gray-600 hover:bg-gray-700 text-white py-3 rounded-2xl font-bold mt-4"> 
                <i class="fas fa-arrow-right-from-bracket mr-2"></i>Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ 
            </button> 
        </div> 
        <!-- Ø´Ø§Ø´Ø© Ø§Ù„ØªÙˆÙ‚ÙŠØ¹ Ø§Ù„ØµÙˆØªÙŠ --> 
        <div id="voiceSignatureScreen" class="hidden"> 
            <h2 class="text-3xl font-bold text-white mb-6 text-center">ğŸ¤ Ø§Ù„ØªÙˆÙ‚ÙŠØ¹ Ø§Ù„ØµÙˆØªÙŠ</h2> 
            <p class="mb-6 text-gray-300 text-center" id="voiceSignatureInstructions">Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ Ø²Ø± Ø§Ù„ØªØ³Ø¬ÙŠÙ„ ÙˆÙ‚Ù„ "Ø£Ù†Ø§ 
                Ø­Ø§Ø¶Ø±". Ø³ÙŠØªÙ… Ø§Ù„ØªØ³Ø¬ÙŠÙ„ Ù„Ù…Ø¯Ø© 3 Ø«ÙˆØ§Ù†Ù.</p> 
            <div class="flex justify-center mb-6"> 
                <button id="startVoiceRecordingBtn" 
                        class="bg-red-500 hover:bg-red-600 text-white px-8 py-4 rounded-full text-xl font-bold shadow-lg"> 
                    <i class="fas fa-microphone mr-2"></i>Ø¨Ø¯Ø¡ Ø§Ù„ØªØ³Ø¬ÙŠÙ„ 
                </button> 
                <audio id="recordedAudioPlayback" controls class="hidden w-full mt-4"></audio> 
            </div> 
            <p id="voiceStatusMessage" class="mt-4 text-lg font-medium text-center"></p> 
            <button id="confirmVoiceSignatureBtn" 
                    class="w-full main-button text-white py-3 rounded-2xl font-bold mt-4 hidden"> 
                <i class="fas fa-check-circle mr-2"></i>ØªØ£ÙƒÙŠØ¯ Ø§Ù„ØªÙˆÙ‚ÙŠØ¹ Ø§Ù„ØµÙˆØªÙŠ 
            </button> 
            <button id="cancelVoiceSignatureBtn" 
                    class="w-full bg-gray-600 hover:bg-gray-700 text-white py-3 rounded-2xl font-bold mt-2"> 
                <i class="fas fa-times-circle mr-2"></i>Ø¥Ù„ØºØ§Ø¡ ÙˆØ§Ù„Ø¹ÙˆØ¯Ø© 
            </button> 
        </div> 
        <!-- Ø´Ø§Ø´Ø© Ø§Ù„Ù…ÙˆØ¸Ù Ø¨Ø¹Ø¯ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ --> 
        <div id="employeeDashboard" class="hidden text-white"> 
            <h2 class="text-3xl font-bold text-white mb-6 text-center" id="employeeDashboardName">Ù…Ø±Ø­Ø¨Ø§Ù‹ [Ø§Ø³Ù… Ø§Ù„Ù…ÙˆØ¸Ù]</h2> 
            <!-- Walkie-Talkie Button (Employee) --> 
            <button id="employeeWalkieTalkieBtn" class="walkie-talkie-button"> 
                <i class="fas fa-headset"></i> 
            </button> 
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8"> 
                <div class="glass p-6 rounded-2xl"> 
                    <h3 class="font-bold text-white mb-4">Ø³Ø§Ø¹Ø§Øª Ø§Ù„Ø¹Ù…Ù„ Ø§Ù„Ø¥Ø¶Ø§ÙÙŠØ© (Ø§Ù„ÙŠÙˆÙ…)</h3> 
                    <p class="text-4xl font-bold text-green-400" id="overtimeDisplay">00:00:00</p> 
                    <p class="text-sm opacity-90 mt-2">Ø¨Ø¹Ø¯ 8 Ø³Ø§Ø¹Ø§Øª Ø¹Ù…Ù„ Ø£Ø³Ø§Ø³ÙŠØ©</p> 
                </div> 
                <div class="glass p-6 rounded-2xl"> 
                    <h3 class="font-bold text-white mb-4">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ù†Ù‚Ø§Ø· Ø§Ù„ÙˆÙ„Ø§Ø¡</h3> 
                    <p class="text-4xl font-bold text-yellow-300" id="employeePointsDisplayEmployeePanel">0</p> 
                    <p class="text-sm opacity-90 mt-2">Ù†Ù‚Ø§Ø· Ø§Ù„Ø­Ø¶ÙˆØ± ÙÙŠ Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…Ø­Ø¯Ø¯</p> 
                </div> 
            </div> 
            <div class="space-y-4"> 
                <button id="clockOutBtn" 
                        class="w-full bg-purple-600 hover:bg-purple-700 text-white py-4 rounded-2xl font-bold mb-4"> 
                    <i class="fas fa-sign-out-alt mr-2"></i>ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬ 
                </button> 
                <button id="generateMonthlyReportBtn" class="w-full main-button text-white py-4 rounded-2xl font-bold mb-4"> 
                    <i class="fas fa-file-pdf mr-2"></i>Ø§Ø³ØªØ®Ø±Ø§Ø¬ ØªÙ‚Ø±ÙŠØ± Ø´Ù‡Ø±ÙŠ (PDF) 
                </button> 
                <button id="submitObjectionBtn" 
                        class="w-full bg-orange-500 hover:bg-orange-600 text-white py-4 rounded-2xl font-bold"> 
                    <i class="fas fa-exclamation-circle mr-2"></i>ØªÙ‚Ø¯ÙŠÙ… Ø·Ù„Ø¨ ØªØµØ­ÙŠØ­ 
                </button> 
            </div> 
        </div> 
    </div> 
</div> 
 
<!-- ğŸ” Ø´Ø§Ø´Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ù…ÙˆØ¸Ù Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© (Sign Up) --> 
<div id="signupModal" class="fixed inset-0 bg-black/80 backdrop-blur-sm hidden z-50 flex items-center justify-center p-8"> 
    <div class="glass max-w-md w-full rounded-2xl p-8"> 
        <div class="text-right mb-8"> 
            <button onclick="wizzApp.hideSignupModal()" class="text-3xl text-white">&times;</button> 
        </div> 
        <h2 class="text-3xl font-bold text-white mb-6 text-center">ØªØ³Ø¬ÙŠÙ„ Ù…ÙˆØ¸Ù Ø¬Ø¯ÙŠØ¯</h2> 
        <form id="signupForm"> 
            <div class="mb-4"> 
                <label for="fullName" class="block text-white/90 mb-2">Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„</label> 
                <input type="text" id="fullName" class="w-full glass p-3 rounded-2xl text-white" 
                       placeholder="Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„ Ù„Ù„Ù…ÙˆØ¸Ù" required> 
                <p id="fullNameError" class="text-red-400 text-sm mt-1"></p> 
            </div> 
            <div class="mb-4"> 
                <label for="phoneNumber" class="block text-white/90 mb-2">Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ (Ù„Ù„ÙˆØ§ØªØ³Ø§Ø¨)</label> 
                <input type="tel" id="phoneNumber" class="w-full glass p-3 rounded-2xl text-white" 
                       placeholder="Ù…Ø«Ø§Ù„: 06XXXXXXXX" required pattern="^(06|07)\d{8}$"> 
                <p id="phoneNumberError" class="text-red-400 text-sm mt-1"></p> 
            </div> 
            <div class="mb-4"> 
                <label for="department" class="block text-white/90 mb-2">Ø§Ù„Ù‚Ø³Ù…</label> 
                <select id="department" class="w-full glass p-3 rounded-2xl text-white" required> 
                    <option value="">Ø§Ø®ØªØ± Ø§Ù„Ù‚Ø³Ù…</option> 
                    <option value="Ø¥Ø¯Ø§Ø±Ø©">Ø¥Ø¯Ø§Ø±Ø©</option> 
                    <option value="Ø¹Ù…Ø§Ù„">Ø¹Ù…Ø§Ù„</option> 
                    <option value="Ù…Ø¨ÙŠØ¹Ø§Øª">Ù…Ø¨ÙŠØ¹Ø§Øª</option> 
                    <option value="ØªØ¹Ù„ÙŠÙ…">ØªØ¹Ù„ÙŠÙ…</option> 
                    <!-- ÙŠÙ…ÙƒÙ† Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø²ÙŠØ¯ Ù…Ù† Ø§Ù„Ø£Ù‚Ø³Ø§Ù… Ù‡Ù†Ø§ --> 
                </select> 
                <p id="departmentError" class="text-red-400 text-sm mt-1"></p> 
            </div> 
            <div class="mb-6"> 
                <label for="password" class="block text-white/90 mb-2">ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</label> 
                <input type="password" id="password" class="w-full glass p-3 rounded-2xl text-white" 
                       placeholder="ÙƒÙ„Ù…Ø© Ù…Ø±ÙˆØ± Ø¢Ù…Ù†Ø©" 
                       required pattern="^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[!@#$%^&*()_+={}\[\]:;"'<>,.?/~`])[A-Za-z\d!@#$%^&*()_+={}\[\]:;"'<>,.?/~`]{8,}$"> 
                <p id="passwordError" class="text-red-400 text-sm mt-1"></p> 
            </div> 
            <button type="submit" class="w-full main-button text-white py-4 rounded-2xl font-bold"> 
                <i class="fas fa-user-plus mr-2"></i>Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨ 
            </button> 
            <button type="button" onclick="wizzApp.showLoginModal()" 
                    class="w-full text-white/70 mt-3 hover:text-white">Ù„Ø¯ÙŠ Ø­Ø³Ø§Ø¨ Ø¨Ø§Ù„ÙØ¹Ù„ØŸ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ 
            </button> 
        </form> 
    </div> 
</div> 
 
 
<!-- Ù‚Ø§Ø¦Ù…Ø© Ø£Ù†ÙˆØ§Ø¹ Ø§Ù„Ø§ØªØµØ§Ù„ --> 
<div id="callTypeMenu" class="call-menu hidden shadow-2xl border border-white/20 rounded-2xl"> 
    <div class="p-4 border-b border-white/20"> 
        <h4 class="font-bold text-white mb-3" id="menuEmployeeName">Ù…Ø­Ù…Ø¯ Ø£Ø­Ù…Ø¯</h4> 
        <p class="text-sm text-white/70 mb-4" id="menuEmployeeExt">0</p> 
    </div> 
    <div class="p-4 space-y-2"> 
        <button id="callGsmBtn" 
                class="call-type-btn w-full flex items-center space-x-3 space-x-reverse p-3 rounded-2xl bg-green-500/20 hover:bg-green-500 text-white"> 
            <i class="fas fa-phone text-xl"></i><span>ğŸ“± Ù…ÙƒØ§Ù„Ù…Ø© Ù‡Ø§ØªÙÙŠØ©</span> 
        </button> 
        <button id="callWhatsappBtn" 
                class="call-type-btn w-full flex items-center space-x-3 space-x-reverse p-3 rounded-2xl bg-green-400/20 hover:bg-green-400 text-white"> 
            <i class="fab fa-whatsapp text-xl"></i><span>ğŸŸ¢ ÙˆØ§ØªØ³Ø§Ø¨</span> 
        </button> 
        <button id="callSipBtn" 
                class="call-type-btn w-full flex items-center space-x-3 space-x-reverse p-3 rounded-2xl bg-blue-500/20 hover:bg-blue-500 text-white"> 
            <i class="fas fa-building text-xl"></i><span>â˜ï¸ ØªÙ„ÙÙˆÙ† Ø§Ù„Ù…ÙƒØªØ¨</span> 
        </button> 
    </div> 
</div> 
 
<!-- Modal Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ø§Ù„Ø¨Ø« --> 
<div id="broadcastModal" class="fixed inset-0 bg-black/80 backdrop-blur-sm hidden z-50 flex items-center justify-center p-8"> 
    <div class="glass max-w-lg w-full rounded-2xl p-8 text-center"> 
        <h2 class="text-3xl font-bold text-white mb-6">ğŸ“¢ Ø¥Ø´Ø¹Ø§Ø± Ø¹Ø§Ù… Ù…Ù† Ø§Ù„Ù…Ø¯ÙŠØ±</h2> 
        <p id="broadcastModalMessage" class="text-xl text-white/90 mb-8">Ù†Øµ Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ù‡Ù†Ø§.</p> 
        <button onclick="wizzApp.hideBroadcastModal()" class="main-button text-white py-3 px-8 rounded-2xl font-bold"> 
            Ø­Ø³Ù†Ø§Ù‹ØŒ ÙÙ‡Ù…Øª 
        </button> 
    </div> 
</div> 
 
<!-- Modal Ù„ØªÙ‚Ø¯ÙŠÙ… Ø·Ù„Ø¨ ØªØµØ­ÙŠØ­ --> 
<div id="objectionModal" class="fixed inset-0 bg-black/80 backdrop-blur-sm hidden z-50 flex items-center justify-center p-8"> 
    <div class="glass max-w-lg w-full rounded-2xl p-8"> 
        <div class="flex justify-between items-center mb-6"> 
            <h2 class="text-3xl font-bold text-white">ğŸ“ ØªÙ‚Ø¯ÙŠÙ… Ø·Ù„Ø¨ ØªØµØ­ÙŠØ­</h2> 
            <button onclick="wizzApp.hideObjectionModal()" class="text-3xl text-white">&times;</button> 
        </div> 
        <div class="mb-4"> 
            <label for="objectionDate" class="block text-white/90 mb-2">Ø§Ù„ØªØ§Ø±ÙŠØ®</label> 
            <input type="date" id="objectionDate" class="w-full glass p-3 rounded-2xl text-white" required> 
        </div> 
        <div class="mb-4"> 
            <label for="objectionTime" class="block text-white/90 mb-2">Ø§Ù„ÙˆÙ‚Øª</label> 
            <input type="time" id="objectionTime" class="w-full glass p-3 rounded-2xl text-white" required> 
        </div> 
        <div class="mb-4"> 
            <label for="objectionReason" class="block text-white/90 mb-2">Ø³Ø¨Ø¨ Ø§Ù„Ø§Ø¹ØªØ±Ø§Ø¶</label> 
            <textarea id="objectionReason" rows="4" class="w-full glass p-3 rounded-2xl text-white resize-none" 
                      placeholder="Ø§Ø´Ø±Ø­ Ø³Ø¨Ø¨ Ø§Ù„Ø§Ø¹ØªØ±Ø§Ø¶ Ø¨ÙˆØ¶ÙˆØ­..." required></textarea> 
        </div> 
        <button id="submitObjectionRequestBtn" class="w-full main-button text-white py-3 rounded-2xl font-bold"> 
            Ø¥Ø±Ø³Ø§Ù„ Ø·Ù„Ø¨ Ø§Ù„ØªØµØ­ÙŠØ­ 
        </button> 
        <p id="objectionMessage" class="text-red-400 text-center mt-3"></p> 
    </div> 
</div> 
 
<!-- Customer Trust Box Modal --> 
<div id="customerFeedbackModal" class="fixed inset-0 bg-black/80 backdrop-blur-sm hidden z-50 flex items-center justify-center p-8"> 
    <div class="glass max-w-lg w-full rounded-2xl p-8"> 
        <div class="flex justify-between items-center mb-6"> 
            <h2 class="text-3xl font-bold text-white">ğŸ’¬ Ø±Ø£ÙŠÙƒ ÙŠÙ‡Ù…Ù†Ø§!</h2> 
            <button onclick="wizzApp.hideCustomerFeedbackModal()" class="text-3xl text-white">&times;</button> 
        </div> 
        <div class="mb-4"> 
            <label for="customerFeedbackPhone" class="block text-white/90 mb-2">Ø±Ù‚Ù… Ù‡Ø§ØªÙÙƒ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label> 
            <input type="tel" id="customerFeedbackPhone" class="w-full glass p-3 rounded-2xl text-white" 
                   placeholder="Ù…Ø«Ø§Ù„: 06XXXXXXXX"> 
        </div> 
        <div class="mb-4"> 
            <label for="customerFeedbackText" class="block text-white/90 mb-2">Ø§ÙƒØªØ¨ Ø´ÙƒÙˆØ§Ùƒ Ø£Ùˆ Ø§Ù‚ØªØ±Ø§Ø­Ùƒ</label> 
            <textarea id="customerFeedbackText" rows="5" class="w-full glass p-3 rounded-2xl text-white resize-none" 
                      placeholder="Ø§ÙƒØªØ¨ Ù‡Ù†Ø§..." required></textarea> 
        </div> 
        <button id="submitCustomerFeedbackBtn" class="w-full main-button text-white py-3 rounded-2xl font-bold"> 
            Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø±Ø£ÙŠ 
        </button> 
        <p id="customerFeedbackMessage" class="text-green-400 text-center mt-3"></p> 
    </div> 
</div> 
 
<!-- Mandatory Break Modal --> 
<div id="mandatoryBreakModal" class="fixed inset-0 bg-black/80 backdrop-blur-sm hidden z-50 flex items-center justify-center p-8"> 
    <div class="glass max-w-lg w-full rounded-2xl p-8 text-center"> 
        <h2 class="text-4xl font-bold text-white mb-6 animate-pulse">Ø­Ø§Ù† ÙˆÙ‚Øª Ø±Ø§Ø­ØªÙƒ! â˜•</h2> 
        <p class="text-xl text-white/90 mb-8">Ù„Ù‚Ø¯ Ø¹Ù…Ù„Øª Ù„Ø£ÙƒØ«Ø± Ù…Ù† 6 Ø³Ø§Ø¹Ø§Øª Ù…ØªÙˆØ§ØµÙ„Ø©. Ø®Ø° Ù‚Ø³Ø·Ø§Ù‹ Ù…Ù† Ø§Ù„Ø±Ø§Ø­Ø© Ù„ØªØ¬Ø¯ÙŠØ¯ Ù†Ø´Ø§Ø·Ùƒ.</p> 
        <button onclick="wizzApp.hideMandatoryBreakModal()" class="main-button text-white py-3 px-8 rounded-2xl font-bold"> 
            Ø­Ø³Ù†Ø§Ù‹ØŒ Ø³Ø¢Ø®Ø° Ø§Ø³ØªØ±Ø§Ø­Ø© 
        </button> 
    </div> 
</div> 
<!-- Ø³Ø§Ø¹Ø© ÙƒØ±Ø§Ù…Ø© Ø§Ù„Ù…ÙˆØ¸Ù --> 
<div id="dignityBreakModal" class="fixed inset-0 bg-black/80 backdrop-blur-sm hidden z-50 flex items-center justify-center p-8"> 
    <div class="glass max-w-lg w-full rounded-2xl p-8 text-center"> 
        <h2 class="text-4xl font-bold text-white mb-6 animate-pulse">âœ¨ Ø³Ø§Ø¹Ø© ÙƒØ±Ø§Ù…Ø© Ø§Ù„Ù…ÙˆØ¸Ù! âœ¨</h2> 
        <p class="text-xl text-white/90 mb-8">Ù„Ù‚Ø¯ Ø¹Ù…Ù„Øª Ù„Ø£ÙƒØ«Ø± Ù…Ù† 6 Ø³Ø§Ø¹Ø§Øª Ù…ØªÙˆØ§ØµÙ„Ø©. Ø®Ø° Ø§Ø³ØªØ±Ø§Ø­Ø© Ø¥Ù„Ø²Ø§Ù…ÙŠØ© Ù„ØªØ¬Ø¯ÙŠØ¯ Ù†Ø´Ø§Ø·Ùƒ.</p> 
        <button onclick="wizzApp.hideDignityBreakModal()" class="main-button text-white py-3 px-8 rounded-2xl font-bold"> 
            Ø­Ø³Ù†Ø§Ù‹ØŒ Ø³Ø¢Ø®Ø° Ø§Ø³ØªØ±Ø§Ø­Ø© 
        </button> 
    </div> 
</div> 
<!-- Modal Ù„Ù„Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ø³Ø±ÙŠØ© Ù…Ù† Ø§Ù„Ù…ÙˆØ¸Ù Ù„Ù„Ù…Ø¯ÙŠØ± --> 
<div id="secretMessageModal" class="fixed inset-0 bg-black/80 backdrop-blur-sm hidden z-50 flex items-center justify-center p-8"> 
    <div class="glass max-w-lg w-full rounded-2xl p-8"> 
        <div class="flex justify-between items-center mb-6"> 
            <h2 class="text-3xl font-bold text-white">ğŸ“© Ø±Ø³Ø§Ù„Ø© Ø³Ø±ÙŠØ© Ù„Ù„Ù…Ø¯ÙŠØ±</h2> 
            <button onclick="wizzApp.hideSecretMessageModal()" class="text-3xl text-white">&times;</button> 
        </div> 
        <textarea id="secretMessageText" rows="5" class="w-full glass p-3 rounded-2xl text-white resize-none" 
                  placeholder="Ø§ÙƒØªØ¨ Ø±Ø³Ø§Ù„ØªÙƒ Ø§Ù„Ø³Ø±ÙŠØ© Ù‡Ù†Ø§..."></textarea> 
        <button id="sendSecretMessageBtn" class="w-full main-button text-white py-3 rounded-2xl font-bold mt-4"> 
            Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ø³Ø±ÙŠØ© 
        </button> 
        <p id="secretMessageStatus" class="text-green-400 text-center mt-3"></p> 
    </div> 
</div> 
 
<!-- Walkie-Talkie Modal (Employee) --> 
<div id="walkieTalkieModal" class="fixed inset-0 bg-black/80 backdrop-blur-sm hidden z-50 flex items-center justify-center p-8"> 
    <div class="glass max-w-lg w-full rounded-2xl p-8 text-center"> 
        <h2 class="text-3xl font-bold text-white mb-6">ğŸ“» Ø§Ù„Ù„Ø§Ø³Ù„ÙƒÙŠ Ø§Ù„Ø¬Ù…Ø§Ø¹ÙŠ</h2> 
        <p id="walkieTalkieStatus" class="text-xl text-white/90 mb-4">Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø§Ø³ØªÙ…Ø§Ø¹...</p> 
        <div id="walkieTalkieTranscription" 
             class="bg-gray-700 p-4 rounded-lg mb-6 text-white text-right max-h-40 overflow-y-auto"> 
            <p>...</p> 
        </div> 
        <button id="walkieTalkieAcknowledgeBtn" class="main-button text-white py-3 px-8 rounded-2xl font-bold hidden"> 
            Ù„Ù‚Ø¯ Ø£Ù†ØµØªÙ‘Ù ÙˆØ£Ø¯Ø±ÙƒØªÙ Ø§Ù„Ø£Ù…Ø± 
        </button> 
    </div> 
</div> 
 
<!-- Visual Command Modal (Employee) --> 
<div id="visualCommandModal" class="fixed inset-0 bg-black/80 backdrop-blur-sm hidden z-50 flex items-center justify-center p-8"> 
    <div class="glass max-w-lg w-full rounded-2xl p-8 text-center"> 
        <h2 class="text-3xl font-bold text-white mb-6">ğŸ‘ï¸ Ø£Ù…Ø± Ø¨ØµØ±ÙŠ Ø¬Ø¯ÙŠØ¯</h2> 
        <img id="visualCommandImage" src="" alt="Ø£Ù…Ø± Ø¨ØµØ±ÙŠ" class="max-w-full h-auto rounded-lg mb-6"> 
        <p id="visualCommandSender" class="text-white/70 text-sm mb-4">Ù…Ù†: Ø§Ù„Ù…Ø¯ÙŠØ±</p> 
        <button onclick="wizzApp.hideVisualCommandModal()" class="main-button text-white py-3 px-8 rounded-2xl font-bold"> 
            Ø­Ø³Ù†Ø§Ù‹ØŒ ÙÙ‡Ù…Øª 
        </button> 
    </div> 
</div> 
 
<!-- Admin Walkie-Talkie Modal --> 
<div id="adminWalkieTalkieModal" class="fixed inset-0 bg-black/80 backdrop-blur-sm hidden z-50 flex items-center justify-center p-8"> 
    <div class="glass max-w-lg w-full rounded-2xl p-8 text-center"> 
        <h2 class="text-3xl font-bold text-white mb-6">ğŸ“» Ø¨Ø« Ù„Ø§Ø³Ù„ÙƒÙŠ Ø¬Ù…Ø§Ø¹ÙŠ</h2> 
        <p id="adminWalkieTalkieStatus" class="text-xl text-white/90 mb-4">Ø§Ø¶ØºØ· Ù„Ù„ØªØ­Ø¯Ø«</p> 
        <div class="flex justify-center mb-6"> 
            <button id="adminStartRecordingBtn" 
                    class="bg-red-500 hover:bg-red-600 text-white px-8 py-4 rounded-full text-xl font-bold shadow-lg"> 
                <i class="fas fa-microphone mr-2"></i>Ø¨Ø¯Ø¡ Ø§Ù„Ø¨Ø« 
            </button> 
        </div> 
        <p id="adminWalkieTalkieTranscription" 
           class="bg-gray-700 p-4 rounded-lg mb-6 text-white text-right max-h-40 overflow-y-auto"> 
            Ø§Ù„Ù†Øµ Ø§Ù„Ù…Ø­ÙˆÙ„ ÙŠØ¸Ù‡Ø± Ù‡Ù†Ø§... 
        </p> 
        <button onclick="wizzApp.hideAdminWalkieTalkieModal()" 
                class="main-button text-white py-3 px-8 rounded-2xl font-bold"> 
            Ø¥ØºÙ„Ø§Ù‚ 
        </button> 
    </div> 
</div> 
 
<!-- Visual Command Sender Modal (Admin) --> 
<div id="adminVisualCommandModal" class="fixed inset-0 bg-black/80 backdrop-blur-sm hidden z-50 flex items-center justify-center p-8"> 
    <div class="glass max-w-lg w-full rounded-2xl p-8"> 
        <div class="flex justify-between items-center mb-6"> 
            <h2 class="text-3xl font-bold text-white">ğŸ‘ï¸ Ø¥Ø±Ø³Ø§Ù„ Ø£Ù…Ø± Ø¨ØµØ±ÙŠ</h2> 
            <button onclick="wizzApp.hideAdminVisualCommandModal()" class="text-3xl text-white">&times;</button> 
        </div> 
        <div class="mb-4"> 
            <label for="visualCommandRecipient" class="block text-white/90 mb-2">Ø§Ù„Ù…ÙˆØ¸Ù Ø§Ù„Ù…Ø³ØªÙ‡Ø¯Ù</label> 
            <select id="visualCommandRecipient" class="w-full glass p-3 rounded-2xl text-white"> 
                <!-- Employee options will be loaded here --> 
            </select> 
        </div> 
        <div class="mb-4"> 
            <label for="visualCommandImageInput" class="block text-white/90 mb-2">Ø§Ù„ØªÙ‚Ø· ØµÙˆØ±Ø© Ø£Ùˆ Ø§Ø®ØªØ± Ù…Ù„Ù</label> 
            <input type="file" id="visualCommandImageInput" accept="image/*" 
                   class="w-full glass p-3 rounded-2xl text-white"> 
        </div> 
        <button id="captureVisualCommandBtn" class="main-button text-white py-3 rounded-2xl font-bold mt-4"> 
            <i class="fas fa-camera mr-2"></i>Ø§Ù„ØªÙ‚Ø§Ø· ØµÙˆØ±Ø© 
        </button> 
        <img id="capturedVisualCommandPreview" src="" alt="Ù…Ø¹Ø§ÙŠÙ†Ø©" class="hidden max-w-full h-auto rounded-lg mt-4"> 
        <button id="sendVisualCommandFinalBtn" 
                class="w-full main-button text-white py-3 rounded-2xl font-bold mt-4 hidden"> 
            <i class="fas fa-paper-plane mr-2"></i>Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø£Ù…Ø± Ø§Ù„Ø¨ØµØ±ÙŠ 
        </button> 
        <p id="adminVisualCommandMessage" class="text-red-400 text-center mt-3"></p> 
    </div> 
</div> 
 
 
<script> 
    /* =============================== 
       ğŸŸ¥ ZONE 1: IMMUTABLE CORE â€“ DO NOT TOUCH 
       Ø§Ù„Ù†ÙˆØ§Ø© ØºÙŠØ± Ø§Ù„Ù‚Ø§Ø¨Ù„Ø© Ù„Ù„Ù…Ø³ - ØªØ¬Ù…ÙŠØ¯ Ø£Ø¨Ø¯ÙŠ 
       ============================== */ 
    (function () { 
        'use strict'; 
 
        // ğŸ”¥ ØªØ¹Ø±ÙŠÙØ§Øª Ø§Ù„Ù‡ÙˆÙŠØ© ÙˆØ§Ù„Ø«ÙˆØ§Ø¨Øª Ø§Ù„Ø£Ù…Ù†ÙŠØ© 
        window.WIZZ_SYSTEM = Object.freeze({ 
            SYSTEM_ID: "WIZZ_INK_V5.0.0-PRO", // Updated version 
            VERSION: "5.0.0-PRO",      // Updated version and status 
            ARCHITECTURE: "SINGLE_FILE_ZONE_BASED", 
            CORE_PRINCIPLES: Object.freeze({ 
                ZERO_KNOWLEDGE: true, 
                COMPANY_ISOLATION: true, 
                ENCRYPTION_MANDATORY: true, 
                NO_GLOBAL_ACCESS: true, 
                IMMUTABLE_ZONES: [0, 1, 2] 
            }), 
            GUARDIANS: Object.freeze([ 
                "LEGAL_NEUTRALITY", 
                "ZERO_KNOWLEDGE_ROUTING", 
                "VAULT_ISOLATION", 
                "ADMIN_AUTH_REQUIRED" 
            ]), 
            MAX_EMPLOYEES: 1000, 
            MAX_ARCHIVE_DAYS: 365 
        }); 
 
        console.log('ğŸŸ¥ âœ… WIZZ IMMUTABLE CORE LOADED & FROZEN'); 
    })(); 
 
    /* =============================== 
       ğŸŸ¥ ZONE 2: COMPANY VAULT LOGIC â€“ SECURITY ZONE 
       Ù…Ù†Ø·Ù‚ Ø§Ù„ØµÙ†Ø§Ø¯ÙŠÙ‚ Ø§Ù„Ø£Ù…Ù†ÙŠØ© - Ù…Ø±Ø§Ø¬Ø¹Ø© ÙÙ‚Ø· 
       ============================== */ 
    (function () { 
        'use strict'; 
 
        // ğŸ”¥ Ù†Ø¸Ø§Ù… Ø§Ù„ØµÙ†Ø§Ø¯ÙŠÙ‚ Ø§Ù„Ù…Ø¹Ø²ÙˆÙ„Ø© Ù„ÙƒÙ„ Ø´Ø±ÙƒØ© 
        class WizzCompanyVault { 
            constructor(orgId) { 
                if (!WIZZ_SYSTEM.CORE_PRINCIPLES.COMPANY_ISOLATION) { 
                    throw new Error('Company isolation disabled in core'); 
                } 
                this.orgId = orgId; 
                // ÙŠØªÙ… ØªÙˆÙ„ÙŠØ¯ Ù…ÙØªØ§Ø­ Ø§Ù„Ø®Ø²Ù†Ø© Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… PBKDF2 Ù„Ø²ÙŠØ§Ø¯Ø© Ø§Ù„Ø£Ù…Ø§Ù† 
                this.vaultKey = this._generateOrgKey(orgId); 
                this.isSealed = true; // ÙŠØªÙ… Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„ØµÙ†Ø¯ÙˆÙ‚ Ø¨Ø¹Ø¯ Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡ 
            } 
 
            _generateOrgKey(orgId) { 
                // ØªØ´ÙÙŠØ± Ù…ÙØªØ§Ø­ Ø§Ù„Ù…Ù†Ø´Ø£Ø© Ø¨Ù€ PBKDF2 
                const salt = CryptoJS.lib.WordArray.random(16); 
                // Ø§Ø³ØªØ®Ø¯Ø§Ù… WIZZ_SYSTEM.SYSTEM_ID Ù…Ù† Zone 1 Ù„Ø¶Ù…Ø§Ù† Ø±Ø¨Ø· Ø§Ù„Ù…ÙØªØ§Ø­ Ø¨Ù‡ÙˆÙŠØ© Ø§Ù„Ù†Ø¸Ø§Ù… 
                return CryptoJS.PBKDF2(orgId + WIZZ_SYSTEM.SYSTEM_ID, salt, { 
                    keySize: 256 / 32, 
                    iterations: 100000 
                }); 
            } 
 
            async signAttendanceRecord(record) { 
                // ØªÙˆÙ‚ÙŠØ¹ Ø§Ù„Ø³Ø¬Ù„ Ø¨Ù…ÙØªØ§Ø­ Ø§Ù„Ù…Ù†Ø´Ø£Ø© 
                const signature = await this._createSignature(record); 
                return { 
                    ...record, 
                    orgSignature: signature, 
                    sealedBy: this.orgId, 
                    sealedAt: new Date().toISOString() 
                }; 
            } 
 
            _createSignature(data) { 
                return CryptoJS.HmacSHA256( 
                    JSON.stringify(data), 
                    this.vaultKey 
                ).toString(); 
            } 
        } 
 
        // ØªØ³Ø¬ÙŠÙ„ Vault Ù„Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù… ÙÙŠ Ø§Ù„Ø·Ø¨Ù‚Ø§Øª Ø§Ù„Ø¹Ù„ÙŠØ§ 
        window.WizzVault = WizzCompanyVault; 
 
        console.log('ğŸŸ¥ âœ… WIZZ VAULT SYSTEM LOADED - SEALED'); 
    })(); 
 
    /* =============================== 
       ğŸŸ§ ZONE 3: TRUST COORDINATION LAYER 
       Ø·Ø¨Ù‚Ø© Ø§Ù„ØªÙ†Ø³ÙŠÙ‚ - Ø§Ù„ØªØ­ÙˆÙŠÙ„ Ø¨Ø¯ÙˆÙ† ØªÙ†ÙÙŠØ° 
       Ù…Ø³Ù…ÙˆØ­: ØªÙˆØ³ÙŠØ¹ØŒ ØªØ­Ø³ÙŠÙ†ØŒ Ø¥Ø¶Ø§ÙØ© operators 
       Ù…Ù…Ù†ÙˆØ¹: ØªÙ†ÙÙŠØ°ØŒ ØªØ®Ø²ÙŠÙ†ØŒ Ø±Ø¤ÙŠØ© Ø¨ÙŠØ§Ù†Ø§Øª 
       ============================== */ 
    (function () { 
        'use strict'; 
 
        class WizzTrustLayer { 
            constructor() { 
                this.certifiedOperators = Object.freeze([ 
                    {id: 'whatsapp_op', name: 'WhatsApp Gateway', priority: 1}, 
                    {id: 'sms_op', name: 'SMS Fallback', priority: 2}, 
                    {id: 'email_op', name: 'Email Service', priority: 3} 
                ]); 
                this.routingRules = Object.freeze({ 
                    LATE_NOTIFICATION: 'whatsapp_op', 
                    GPS_ALERT: 'sms_op', 
                    DAILY_SUMMARY: 'email_op', 
                    BROADCAST_MESSAGE: 'modal_op', // Routing for internal modal broadcasts 
                    SOS_ALERT: 'whatsapp_op', // Routing for SOS alerts 
                    OBJECTION_REQUEST: 'whatsapp_op', // Routing for objection requests 
                    CUSTOMER_FEEDBACK: 'email_op', // Routing for customer feedback 
                    WALKIE_TALKIE_BROADCAST: 'internal_audio_stt', // New: Internal audio/STT handling 
                    VISUAL_COMMAND: 'internal_visual' // New: Internal visual command handling 
                }); 
            } 
 
            validateRequest(request) { 
                // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„ØªÙˆÙ‚ÙŠØ¹ Ø¨Ø¯ÙˆÙ† ÙÙƒ Ø§Ù„ØªØ´ÙÙŠØ± 
                if (!request.orgSignature || !request.sealedBy) { 
                    throw new Error('Invalid request signature or missing organization ID.'); 
                } 
                // Ù‡Ù†Ø§ ÙŠÙ…ÙƒÙ† Ø¥Ø¶Ø§ÙØ© Ù…Ù†Ø·Ù‚ ØªØ­Ù‚Ù‚ Ø£Ø¹Ù…Ù‚ Ù„Ù„ØªÙˆÙ‚ÙŠØ¹ (Ù…Ø«Ù„Ø§Ù‹ØŒ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØµÙ„Ø§Ø­ÙŠØ© Ø§Ù„ØªÙˆÙ‚ÙŠØ¹ Ù†ÙØ³Ù‡) 
                // Ø­Ø§Ù„ÙŠØ§Ù‹ØŒ Ù†ÙƒØªÙÙŠ Ø¨Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ø§Ù„ØªÙˆÙ‚ÙŠØ¹ ÙˆØ§Ù„Ù…Ø¹Ø±Ù. 
                return { 
                    valid: true, 
                    orgId: request.sealedBy, 
                    timestamp: request.sealedAt 
                }; 
            } 
 
            routeNotification(notificationType, signedRequest) { 
                // ØªÙˆØ¬ÙŠÙ‡ Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ metadata ÙÙ‚Ø· 
                const validation = this.validateRequest(signedRequest); // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø£Ù† Ø§Ù„Ø·Ù„Ø¨ Ù…ÙˆØ«ÙˆÙ‚ Ø¨Ù‡ 
                if (!validation.valid) { 
                    throw new Error("Request validation failed in Trust Layer."); 
                } 
 
                // Ù‡Ù†Ø§ Ù„Ø§ ÙŠØªÙ… ÙÙƒ ØªØ´ÙÙŠØ± 'encrypted_payload' 
                // ÙŠØªÙ… Ø§Ù„ØªÙˆØ¬ÙŠÙ‡ Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ 'notificationType' Ùˆ 'signedRequest.routing_metadata' Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ù…ÙˆØ¬ÙˆØ¯Ø© 
                const operatorId = signedRequest.routing_metadata?.target_operator_type || this.routingRules[notificationType] || 'whatsapp_op'; 
                const operator = this.certifiedOperators.find(op => op.id === operatorId); 
 
                if (!operator && !['modal_op', 'internal_audio_stt', 'internal_visual'].includes(operatorId)) { // Allow internal operators 
                    throw new Error(`No certified operator found for type: ${notificationType} or specified operator ID: ${operatorId}`); 
                } 
 
                console.log(`ğŸŸ§ ROUTING ${notificationType} for ${validation.orgId} â†’ ${operator ? operator.name : operatorId}`); 
                // ÙÙŠ Ø¨ÙŠØ¦Ø© Ø­Ù‚ÙŠÙ‚ÙŠØ©ØŒ Ù‡Ù†Ø§ ÙŠØªÙ… Ø¥Ø±Ø³Ø§Ù„ 'signedRequest' Ø¥Ù„Ù‰ API Ø§Ù„Ù…Ø´ØºÙ„ Ø§Ù„Ø®Ø§Ø±Ø¬ÙŠ 
                // For this example, we just simulate the routing result. 
                return { 
                    status: 'routed', 
                    operator: operator ? operator.id : operatorId, // Return operatorId for internal operators 
                    requestId: signedRequest.id, 
                    timestamp: new Date().toISOString(), 
                    // Ù„Ø§ Ù†Ø±Ø¬Ø¹ encrypted_payload Ù‡Ù†Ø§ Ù„Ø£Ù† Trust Layer Ù„Ø§ ÙŠÙ‡ØªÙ… Ø¨Ù…Ø­ØªÙˆØ§Ù‡ 
                }; 
            } 
 
            registerOperator(operatorConfig) { 
                // ØªÙˆØ³ÙŠØ¹ Ø¢Ù…Ù† Ù„Ù„Ù…Ø´ØºÙ„ÙŠÙ† Ø§Ù„Ø¬Ø¯Ø¯ (Ù‡Ø°Ù‡ Ø§Ù„Ø¯Ø§Ù„Ø© ØªØ³ØªØ¯Ø¹Ù‰ Ù…Ù† Zone 4) 
                if (!operatorConfig.id || !operatorConfig.endpoint) { 
                    throw new Error('Invalid operator config: missing ID or endpoint'); 
                } 
                // ÙÙŠ Ø¨ÙŠØ¦Ø© Ø­Ù‚ÙŠÙ‚ÙŠØ©ØŒ Ù‡Ù†Ø§ ÙŠØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ù…Ø´ØºÙ„ÙŠÙ† Ø¨Ø¹Ø¯ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù†Ù‡Ù… ÙˆØªØ­Ø¯ÙŠØ« Ù‚Ø§Ø¦Ù…Ø© certifiedOperators 
                // for this example, we just log 
                console.log(`ğŸŸ§ NEW OPERATOR REGISTERED: ${operatorConfig.name} - This is a simulation.`); 
            } 
        } 
 
        window.WizzTrust = new WizzTrustLayer(); 
        console.log('ğŸŸ§ âœ… TRUST COORDINATION LAYER ACTIVE'); 
    })(); 
 
    /* ======================================== 
       ğŸ”¥ PAYPAL GATE v5.0.0 + SUPER ADMIN (Ø£ÙˆÙ„ Ù…Ø§ ÙŠØªÙ… ØªÙ†ÙÙŠØ°Ù‡) 
       ======================================== */ 
    class WizzPayPalGate { 
        constructor() { 
            this.paymentUrl = "https://www.paypal.com/ncp/payment/XG6T9YWRV8A5L"; 
            this.trialDays = 5; 
            this.superAdminCredentials = { 
                username: "Wizz.ink", 
                password: "Adilo1984adol" 
            }; 
        } 
 
        // ÙŠØªÙ… Ø§Ø³ØªØ¯Ø¹Ø§Ø¡ Ù‡Ø°Ù‡ Ø¹Ù†Ø¯ Ù…Ø­Ø§ÙˆÙ„Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ 
        checkLoginForSuperAdminBypass(loginPhone, loginPassword) { 
            if (loginPhone === this.superAdminCredentials.username && loginPassword === this.superAdminCredentials.password) { 
                localStorage.setItem('wizz_super_admin', 'true'); 
                localStorage.setItem('wizz_paid', 'true'); 
                localStorage.setItem('wizz_device_id', this.generateDeviceFingerprint()); 
                console.log('ğŸ‘‘ SUPER ADMIN LOGIN - BYPASS ACTIVATED'); 
                return true; 
            } 
            return false; 
        } 
 
        init() { 
            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø­Ø§Ù„Ø© Ø§Ù„Ø¯ÙØ¹ ÙÙˆØ± ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø© 
            if (!this.checkSuperAdminStatus() && !this.checkPaymentStatus()) { 
                this.enforcePaymentLock(); 
            } 
        } 
 
        checkSuperAdminStatus() { 
            return localStorage.getItem('wizz_super_admin') === 'true'; 
        } 
 
        checkPaymentStatus() { 
            // Ù„Ø§ ÙŠØ³Ù…Ø­ Ø¨Ø¥Ù†Ø´Ø§Ø¡ Ø£ÙŠ Ø­Ø³Ø§Ø¨ Ø¬Ø¯ÙŠØ¯ Ø¥Ù„Ø§ Ø¨Ø¹Ø¯ ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø¯ÙØ¹ (ØªÙ… ØªØ¶Ù…ÙŠÙ†Ù‡ ÙÙŠ Ù„ÙˆØ­Ø© Ø§Ù„Ù‚ÙÙ„) 
            // Ø±Ø¨Ø· Ù†Ø¬Ø§Ø­ Ø§Ù„Ø¯ÙØ¹ Ø¨Ø¨ØµÙ…Ø© Ø§Ù„Ø¬Ù‡Ø§Ø² (Device ID) Ù„Ù…Ù†Ø¹ ØªÙƒØ±Ø§Ø± Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª. 
            const trialStart = localStorage.getItem('wizz_trial_start'); 
            if (!trialStart) { 
                localStorage.setItem('wizz_trial_start', Date.now().toString()); 
                return true; // Ø£ÙˆÙ„ Ù…Ø±Ø©ØŒ Ø§Ø¨Ø¯Ø£ Ø§Ù„ØªØ¬Ø±Ø¨Ø© 
            } 
            const daysElapsed = Math.floor((Date.now() - parseInt(trialStart)) / (1000 * 60 * 60 * 24)); 
             
            // Ø¥Ø°Ø§ ØªØ¬Ø§ÙˆØ²Øª Ø§Ù„Ø£ÙŠØ§Ù… Ø§Ù„ØªØ¬Ø±ÙŠØ¨ÙŠØ© ÙˆÙ„Ù… ÙŠØªÙ… Ø§Ù„Ø¯ÙØ¹ 
            if (daysElapsed >= this.trialDays && localStorage.getItem('wizz_paid') !== 'true') { 
                return false; // ÙŠØ¬Ø¨ Ù‚ÙÙ„ Ø§Ù„Ù†Ø¸Ø§Ù… 
            } 
            return true; // Ø§Ù„ÙØªØ±Ø© Ø§Ù„ØªØ¬Ø±ÙŠØ¨ÙŠØ© Ù„Ù… ØªÙ†ØªÙ‡Ù Ø£Ùˆ ØªÙ… Ø§Ù„Ø¯ÙØ¹ 
        } 
 
        generateDeviceFingerprint() { 
             const userAgent = navigator.userAgent; 
             const screenInfo = `${screen.width}x${screen.height}x${screen.colorDepth}`; 
             const browserLanguage = navigator.language; 
             const hardwareConcurrency = navigator.hardwareConcurrency || 1; 
             const memory = navigator.deviceMemory || 0; 
             const timezone = Intl.DateTimeFormat().resolvedOptions().timeZone; 
             const combinedString = userAgent + screenInfo + browserLanguage + hardwareConcurrency + memory + timezone; 
             return CryptoJS.SHA256(combinedString).toString(); // Ø§Ø³ØªØ®Ø¯Ø§Ù… CryptoJS SHA256 
        } 
 
        enforcePaymentLock() { 
            document.body.innerHTML = ` 
            <div class="min-h-screen bg-gradient-to-br from-red-600 via-orange-500 to-yellow-500 flex flex-col items-center justify-center p-8 text-white"> 
                <div class="glass max-w-lg w-full p-12 rounded-3xl text-center border-4 border-white/30 shadow-2xl"> 
                    <div class="w-32 h-32 bg-white/20 rounded-full mx-auto mb-8 flex items-center justify-center animate-pulse"> 
                        <i class="fas fa-lock text-5xl"></i> 
                    </div> 
                    <h1 class="text-4xl font-bold mb-6">ğŸ”’ Ø§Ù„Ù†Ø¸Ø§Ù… Ù…ÙÙ‚ÙÙ‘Ù„ Ù…Ø¤Ù‚ØªØ§Ù‹</h1> 
                    <p class="text-xl mb-8 opacity-90">Ø§Ù†ØªÙ‡Øª Ø§Ù„ÙØªØ±Ø© Ø§Ù„ØªØ¬Ø±ÙŠØ¨ÙŠØ© (5 Ø£ÙŠØ§Ù… ÙÙ‚Ø·)<br><strong>Ù„Ø§ Ø£ÙƒÙˆØ§Ø¯ ØªØ¬Ø±ÙŠØ¨ÙŠØ© - Ø¯ÙØ¹ Ø¥Ù„Ø²Ø§Ù…ÙŠ</strong></p> 
                     
                    <a href="${this.paymentUrl}" target="_blank" class="inline-block main-button text-xl px-12 py-6 rounded-3xl font-bold shadow-2xl hover:shadow-3xl transform hover:-translate-y-2 transition-all mb-6 w-full"> 
                        ğŸ’³ Ø¥ØªÙ…Ø§Ù… Ø§Ù„Ø¯ÙØ¹ Ø§Ù„Ø¢Ù† (PayPal) 
                    </a> 
                     
                    <div class="bg-blue-600/30 border-2 border-blue-400/50 p-6 rounded-2xl mb-6"> 
                        <p class="font-bold text-lg mb-2">ğŸ‘‘ Ø§Ù„Ù…ÙØªØ§Ø­ Ø§Ù„Ø°Ù‡Ø¨ÙŠ (Super Admin)</p> 
                        <p class="text-sm opacity-90"><strong>Ø§Ø³Ù…:</strong> ${this.superAdminCredentials.username}</p> 
                        <p class="text-sm opacity-90"><strong>ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±:</strong> ${this.superAdminCredentials.password}</p> 
                        <p class="text-xs mt-2 text-blue-200">ÙŠØªØ¬Ø§ÙˆØ² Ø§Ù„Ø¯ÙØ¹ + Ø§Ù„ÙˆØ«Ø§Ø¦Ù‚ Ø§Ù„Ù‚Ø§Ù†ÙˆÙ†ÙŠØ© + Ø§Ù„Ù‚ÙÙ„</p> 
                    </div> 
                     
                    <p class="text-sm opacity-75">Ø¨Ø¹Ø¯ Ø§Ù„Ø¯ÙØ¹ØŒ Ø£Ø¹Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø© Ù„Ø±Ø¤ÙŠØ© Wizz.ink v5.0.0-PRO ÙƒØ§Ù…Ù„Ø©</p> 
                </div> 
            </div>`; 
            // Ø¥Ø²Ø§Ù„Ø© Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø³ÙƒØ±Ø¨ØªØ§Øª Ø§Ù„Ø£Ø®Ø±Ù‰ Ù„Ù…Ù†Ø¹ Ø§Ù„ØªÙØ§Ø¹Ù„ Ù…Ø¹ Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…Ù‚ÙÙ„Ø© 
            document.querySelectorAll('script:not(#paypal-script)').forEach(s => s.remove()); 
        } 
    } 
    // ØªÙ‡ÙŠØ¦Ø© PayPal Gate ÙÙˆØ± ØªØ­Ù…ÙŠÙ„ DOM 
    window.paypalGate = new WizzPayPalGate(); 
    window.paypalGate.init(); 
 
    /* =============================== 
       ğŸŸ¨ ZONE 4: EXTENSION ZONE - WIZZ APP ENHANCEMENTS 
       Ù…Ù†Ø·Ù‚Ø© Ø§Ù„ØªÙˆØ³Ø¹Ø© Ø§Ù„Ø¢Ù…Ù†Ø© - Ø¥Ø¶Ø§ÙØ§Øª Wizz ÙÙ‚Ø· 
       ============================== */ 
    window.WIZZ_EXTENSIONS = { 
        attendance: [], 
        notifications: [], 
        reports: [] 
    }; 
 
    // Ø§Ù„ÙƒØ§Ø¦Ù† Ø§Ù„Ù…Ø±ÙƒØ²ÙŠ Ù„Ø¥Ø¯Ø§Ø±Ø© Ø­Ø§Ù„Ø© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ ÙˆØ§Ù„Ø¨ÙŠØ§Ù†Ø§Øª 
    class WizzApp { 
        constructor() { 
            this.appData = { 
                employees: [], 
                pendingUsers: [], 
                virtualOffices: [], // ØªÙ… ØªØ­Ø¯ÙŠØ« Ù‡Ø°Ù‡ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ù„ØªØ¶Ù… ØµÙ„Ø§Ø­ÙŠØ§Øª Ø§Ù„Ø£Ø¯ÙˆØ§Ø± Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© 
                sovereigntyLog: [], 
                trafficLightViolations: {}, // New: Stores yellow/orange card violations per employee 
                workSettings: { 
                    officialEntryTime: '08:00', 
                    gracePeriodMinutes: 10, 
                    autoAlerts: true, 
                    visualVerification: true, 
                    attendanceWindowDuration: 30, // Ù…Ø¯Ø© Ù†Ø§ÙØ°Ø© Ø§Ù„Ø­Ø¶ÙˆØ± Ø¨Ø§Ù„Ø¯Ù‚Ø§Ø¦Ù‚ 
                    workEndTime: '17:00', // ÙˆÙ‚Øª Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ø¹Ù…Ù„ Ù„Ù„ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ø°ÙƒÙŠ (Ø¬Ø¯ÙŠØ¯) 
                    companyGPS: {lat: 34.01, lng: -6.84, radius: 100}, 
                    managerWhatsAppNumber: '+212660074196', 
                    departments: {'Ø¥Ø¯Ø§Ø±Ø©': '08:00', 'Ø¹Ù…Ø§Ù„': '07:00', 'ØªØ¹Ù„ÙŠÙ…': '08:00', 'Ù…Ø¨ÙŠØ¹Ø§Øª': '09:00'}, 
                    pdfPassword: 'YOUR_COMPANY_CRN_HERE' // ÙƒÙ„Ù…Ø© Ù…Ø±ÙˆØ± ØªÙ‚Ø§Ø±ÙŠØ± PDF 
                }, 
                legalAgreementAccepted: false, // New: Legal Agreement Flag 
                lateArrivalsLog: [], 
                visualAttendanceLog: [], 
                managerNotifications: [], 
                broadcastMessages: [], 
                objectionRequests: [], 
                customerFeedback: [], 
                storeLayout: [], 
                inventory: [ 
                    {id: 'inv_1', name: 'Ù…Ù†ØªØ¬ X', quantity: 100}, 
                    {id: 'inv_2', name: 'Ø®Ø¯Ù…Ø© Y', quantity: 50}, 
                ], 
                attendanceArchive: [], 
                secretMessages: [], // ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ø³Ø±ÙŠØ© 
                systemInfo: { 
                    version: WIZZ_SYSTEM.VERSION, 
                    setupCompleted: false, 
                    createdAt: new Date().toISOString(), 
                    encryptionSalt: null, 
                    orgId: 'DEFAULT_ORG_TEMP' 
                } 
            }; 
 
            this.mediaStream = null; 
            this.currentEmployee = null; 
            this.currentVirtualOffice = null; 
            this.encryptionKey = null; 
            this.serverTime = null; 
            this.lastKnownGPS = null; 
            this.lastGPSUpdateTime = 0; 
            this.lastGPSPosition = null; 
            this.cameraTimeoutId = null; 
            this.voiceRecordingTimeoutId = null; 
            this.mediaRecorder = null; 
            this.audioChunks = []; 
            this.sessionTimeoutId = null; 
            this.mandatoryBreakTimeoutId = null; 
            this.MANDATORY_BREAK_AFTER_HOURS = 6; 
            this.indexedDB = null; 
            this.companyVault = null; 
            this.employeeMap = null; 
            this.draggedEmployee = null; 
            this.calcInput = ''; 
            this.speechRecognition = null; 
            this.walkieTalkieRecording = false; 
            this.adminWalkieTalkieStream = null; 
            this.adminWalkieTalkieRecorder = null; 
            this.adminVisualCommandImage = null; 
            this.adminVisualCommandTargetEmployeeId = null; // To store target for visual command 
            this.failedLoginAttempts = 0; // Ù„Ø¨Ø±ÙˆØªÙˆÙƒÙˆÙ„ ØªØ¯Ù…ÙŠØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª 
            this.MAX_FAILED_LOGIN_ATTEMPTS = 5; // ØªØ¯Ù…ÙŠØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ø¹Ø¯ 5 Ù…Ø­Ø§ÙˆÙ„Ø§Øª Ø®Ø§Ø·Ø¦Ø© 
        } 
 
        // =============================================== 
        // ğŸ”¥ ÙˆØ¸Ø§Ø¦Ù IndexedDB 
        // =============================================== 
 
        async initIndexedDB() { 
            return new Promise((resolve, reject) => { 
                const request = indexedDB.open('WizzAppDB', 1); 
 
                request.onupgradeneeded = (event) => { 
                    const db = event.target.result; 
                    if (!db.objectStoreNames.contains('visualAttendanceRecords')) { 
                        const objectStore = db.createObjectStore('visualAttendanceRecords', {keyPath: 'id', autoIncrement: true}); 
                        objectStore.createIndex('timestamp', 'timestamp', {unique: false}); 
                        objectStore.createIndex('employeeId', 'employeeId', {unique: false}); 
                    } 
                    if (!db.objectStoreNames.contains('coreAppData')) { 
                        db.createObjectStore('coreAppData', {keyPath: 'key'}); 
                    } 
                    if (!db.objectStoreNames.contains('attendanceArchive')) { 
                        const archiveStore = db.createObjectStore('attendanceArchive', {keyPath: 'id', autoIncrement: true}); 
                        archiveStore.createIndex('employeeId', 'employeeId', {unique: false}); 
                        archiveStore.createIndex('timestamp', 'timestamp', {unique: false}); 
                        archiveStore.createIndex('date', 'date', {unique: false}); 
                        archiveStore.createIndex('type', 'type', {unique: false}); 
                    } 
                }; 
 
                request.onsuccess = async (event) => { 
                    this.indexedDB = event.target.result; 
                    if (navigator.storage && navigator.storage.persist) { 
                        const granted = await navigator.storage.persist(); 
                    } 
                    resolve(); 
                }; 
 
                request.onerror = (event) => { 
                    console.error('âŒ IndexedDB initialization failed:', event.target.error); 
                    reject(event.target.error); 
                }; 
            }); 
        } 
 
        async saveIndexedDBRecord(storeName, data) { 
            return new Promise((resolve, reject) => { 
                if (!this.indexedDB) { 
                    return reject(new Error('IndexedDB not initialized.')); 
                } 
                const transaction = this.indexedDB.transaction([storeName], 'readwrite'); 
                const store = transaction.objectStore(storeName); 
                const request = store.add(data); 
 
                request.onsuccess = () => { 
                    resolve(request.result); 
                }; 
 
                request.onerror = (event) => { 
                    console.error(`âŒ Failed to add data to ${storeName}:`, event.target.error); 
                    reject(event.target.error); 
                }; 
            }); 
        } 
 
        async getIndexedDBRecord(storeName, key) { 
            return new Promise((resolve, reject) => { 
                if (!this.indexedDB) { 
                    return reject(new Error('IndexedDB not initialized.')); 
                } 
                const transaction = this.indexedDB.transaction([storeName], 'readonly'); 
                const store = transaction.objectStore(storeName); 
                const request = store.get(key); 
 
                request.onsuccess = () => { 
                    resolve(request.result); 
                }; 
 
                request.onerror = (event) => { 
                    console.error(`âŒ Failed to get data from ${storeName}:`, event.target.error); 
                    reject(event.target.error); 
                }; 
            }); 
        } 
 
        async getAllIndexedDBRecords(storeName) { 
            return new Promise((resolve, reject) => { 
                if (!this.indexedDB) { 
                    return reject(new Error('IndexedDB not initialized.')); 
                } 
                const transaction = this.indexedDB.transaction([storeName], 'readonly'); 
                const store = transaction.objectStore(storeName); 
                const request = store.getAll(); 
 
                request.onsuccess = () => { 
                    resolve(request.result); 
                }; 
 
                request.onerror = (event) => { 
                    console.error(`âŒ Failed to get all data from ${storeName}:`, event.target.error); 
                    reject(event.target.error); 
                }; 
            }); 
        } 
 
        async deleteIndexedDBRecord(storeName, key) { 
            return new Promise((resolve, reject) => { 
                if (!this.indexedDB) { 
                    return reject(new Error('IndexedDB not initialized.')); 
                } 
                const transaction = this.indexedDB.transaction([storeName], 'readwrite'); 
                const store = transaction.objectStore(storeName); 
                const request = store.delete(key); 
 
                request.onsuccess = () => { 
                    resolve(); 
                }; 
 
                request.onerror = (event) => { 
                    console.error(`âŒ Failed to delete data from ${storeName}:`, event.target.error); 
                    reject(event.target.error); 
                }; 
            }); 
        } 
 
        async saveCoreAppData() { 
            return new Promise(async (resolve, reject) => { 
                if (!this.indexedDB) return reject(new Error('IndexedDB not initialized.')); 
 
                try { 
                    const encryptedCoreData = await this.encryptData({ 
                        employees: this.appData.employees, 
                        pendingUsers: this.appData.pendingUsers, 
                        virtualOffices: this.appData.virtualOffices, 
                        sovereigntyLog: this.appData.sovereigntyLog, 
                        trafficLightViolations: this.appData.trafficLightViolations, 
                        workSettings: this.appData.workSettings, 
                        legalAgreementAccepted: this.appData.legalAgreementAccepted, 
                        lateArrivalsLog: this.appData.lateArrivalsLog, 
                        managerNotifications: this.appData.managerNotifications, 
                        broadcastMessages: this.appData.broadcastMessages, 
                        objectionRequests: this.appData.objectionRequests, 
                        customerFeedback: this.appData.customerFeedback, 
                        storeLayout: this.appData.storeLayout, 
                        inventory: this.appData.inventory, 
                        visualAttendanceLog: this.appData.visualAttendanceLog, 
                        attendanceArchive: this.appData.attendanceArchive, 
                        storageConfig: this.appData.storageConfig, 
                        secretMessages: this.appData.secretMessages, 
                        systemInfo: this.appData.systemInfo, 
                    }); 
 
                    const transaction = this.indexedDB.transaction(['coreAppData'], 'readwrite'); 
                    const store = transaction.objectStore('coreAppData'); 
                    const request = store.put({key: 'mainAppData', value: encryptedCoreData}); 
 
                    request.onsuccess = () => { 
                        resolve(); 
                    }; 
 
                    request.onerror = (event) => { 
                        console.error('âŒ Failed to save core app data to IndexedDB:', event.target.error); 
                        reject(event.target.error); 
                    }; 
                } catch (error) { 
                    console.error('âŒ Encryption failed for core app data:', error); 
                    reject(error); 
                } 
            }); 
        } 
 
        async loadCoreAppData() { 
            return new Promise(async (resolve, reject) => { 
                if (!this.indexedDB) return reject(new Error('IndexedDB not initialized.')); 
 
                try { 
                    const transaction = this.indexedDB.transaction(['coreAppData'], 'readonly'); 
                    const store = transaction.objectStore('coreAppData'); 
                    const request = store.get('mainAppData'); 
 
                    request.onsuccess = async () => { 
                        if (request.result && request.result.value) { 
                            const decryptedCoreData = await this.decryptData(request.result.value); 
                            this.appData.employees = decryptedCoreData.employees; 
                            this.appData.pendingUsers = decryptedCoreData.pendingUsers; 
                            this.appData.virtualOffices = decryptedCoreData.virtualOffices || []; 
                            this.appData.sovereigntyLog = decryptedCoreData.sovereigntyLog || []; 
                            this.appData.trafficLightViolations = decryptedCoreData.trafficLightViolations || {}; 
                            this.appData.workSettings = decryptedCoreData.workSettings; 
                            this.appData.legalAgreementAccepted = decryptedCoreData.legalAgreementAccepted || false; 
                            this.appData.lateArrivalsLog = decryptedCoreData.lateArrivalsLog; 
                            this.appData.managerNotifications = decryptedCoreData.managerNotifications; 
                            this.appData.broadcastMessages = decryptedCoreData.broadcastMessages || []; 
                            this.appData.objectionRequests = decryptedCoreData.objectionRequests || []; 
                            this.appData.customerFeedback = decryptedCoreData.customerFeedback || []; 
                            this.appData.storeLayout = decryptedCoreData.storeLayout || []; 
                            this.appData.inventory = decryptedCoreData.inventory || []; 
                            this.appData.visualAttendanceLog = decryptedCoreData.visualAttendanceLog; 
                            this.appData.attendanceArchive = decryptedCoreData.attendanceArchive; 
                            this.appData.storageConfig = decryptedCoreData.storageConfig; 
                            this.appData.secretMessages = decryptedCoreData.secretMessages || []; 
                            this.appData.systemInfo = decryptedCoreData.systemInfo; 
                            resolve(); 
                        } else { 
                            resolve(); 
                        } 
                    }; 
 
                    request.onerror = (event) => { 
                        console.error('âŒ Failed to load core app data from IndexedDB:', event.target.error); 
                        reject(event.target.error); 
                    }; 
                } catch (error) { 
                    console.error('âŒ Decryption failed for core app data:', error); 
                    reject(error); 
                } 
            }); 
        } 
 
 
        // =============================================== 
        // ğŸ”¥ ÙˆØ¸Ø§Ø¦Ù Ø§Ù„ØªØ´ÙÙŠØ± ÙˆØ§Ù„Ø£Ù…Ø§Ù† Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© 
        // =============================================== 
 
        async generateSecureEncryptionKey(masterKey = null, salt = null) { 
            let keySource = masterKey; 
            let currentSalt = salt; 
 
            if (!keySource) { 
                keySource = await this.generateDeviceFingerprint(); 
            } 
 
            if (!currentSalt) { 
                currentSalt = window.crypto.getRandomValues(new Uint8Array(16)); 
            } else if (typeof currentSalt === 'string') { 
                currentSalt = new Uint8Array(currentSalt.match(/.{1,2}/g).map(byte => parseInt(byte, 16))); 
            } 
 
            const iterations = 100000; 
            const hash = 'SHA-256'; 
            const algorithm = {name: "PBKDF2", salt: currentSalt, iterations: iterations, hash: hash}; 
 
            const keyMaterial = await window.crypto.subtle.importKey( 
                "raw", 
                new TextEncoder().encode(keySource), 
                {name: "PBKDF2"}, 
                false, 
                ["deriveKey"] 
            ); 
 
            this.encryptionKey = await window.crypto.subtle.deriveKey( 
                algorithm, 
                keyMaterial, 
                {name: "AES-GCM", length: 256}, 
                true, 
                ["encrypt", "decrypt"] 
            ); 
            if (!masterKey) { 
                this.appData.systemInfo.encryptionSalt = Array.from(currentSalt).map(b => b.toString(16).padStart(2, '0')).join(''); 
            } else { 
                this.appData.systemInfo.encryptionSalt = Array.from(currentSalt).map(b => b.toString(16).padStart(2, '0')).join(''); 
            } 
 
            return this.encryptionKey; 
        } 
 
        async encryptData(data) { 
            if (!this.encryptionKey) throw new Error("Encryption key not initialized."); 
            const encoded = new TextEncoder().encode(JSON.stringify(data)); 
            const iv = window.crypto.getRandomValues(new Uint8Array(12)); 
            const ciphertext = await window.crypto.subtle.encrypt( 
                {name: "AES-GCM", iv: iv}, 
                this.encryptionKey, 
                encoded 
            ); 
            return Array.from(iv).map(b => b.toString(16).padStart(2, '0')).join('') + btoa(String.fromCharCode(...new Uint8Array(ciphertext))); 
        } 
 
        async decryptData(encryptedText, decryptionKey = null) { 
            const keyToUse = decryptionKey || this.encryptionKey; 
            if (!keyToUse) throw new Error("Decryption key not initialized."); 
            try { 
                const ivHex = encryptedText.slice(0, 24); 
                const ciphertextBase64 = encryptedText.slice(24); 
 
                const iv = new Uint8Array(ivHex.match(/.{1,2}/g).map(byte => parseInt(byte, 16))); 
                const ciphertext = Uint8Array.from(atob(ciphertextBase64), c => c.charCodeAt(0)).buffer; 
 
                const decrypted = await window.crypto.subtle.decrypt( 
                    {name: "AES-GCM", iv: iv}, 
                    keyToUse, 
                    ciphertext 
                ); 
                return JSON.parse(new TextDecoder().decode(decrypted)); 
            } catch (e) { 
                console.error("Decryption failed:", e); 
                throw new Error("Failed to decrypt data. Key or data corrupted."); 
            } 
        } 
 
        async generateDeviceFingerprint() { 
            const userAgent = navigator.userAgent; 
            const screenInfo = `${screen.width}x${screen.height}x${screen.colorDepth}`; 
            const browserLanguage = navigator.language; 
            const hardwareConcurrency = navigator.hardwareConcurrency || 1; 
            const memory = navigator.deviceMemory || 0; 
            const timezone = Intl.DateTimeFormat().resolvedOptions().timeZone; 
 
            const combinedString = userAgent + screenInfo + browserLanguage + hardwareConcurrency + memory + timezone; 
            const hashBuffer = await window.crypto.subtle.digest('SHA-256', new TextEncoder().encode(combinedString)); 
            return Array.from(new Uint8Array(hashBuffer)).map(b => b.toString(16).padStart(2, '0')).join(''); 
        } 
 
        async encryptPhoneNumber(phoneNumber) { 
            return await this.encryptData(phoneNumber); 
        } 
 
        async decryptPhoneNumber(encryptedPhoneNumber) { 
            try { 
                if (typeof encryptedPhoneNumber === 'string' && encryptedPhoneNumber.startsWith('wizz_gsm_') && encryptedPhoneNumber.length < 100) { 
                    return encryptedPhoneNumber.replace('wizz_gsm_', ''); 
                } 
                return await this.decryptData(encryptedPhoneNumber); 
            } catch (e) { 
                console.warn("Failed to decrypt phone number, might be old format or corrupted. Returning as is.", e); 
                return encryptedPhoneNumber; 
            } 
        } 
 
        // =============================================== 
        // ğŸ”¥ ÙˆØ¸Ø§Ø¦Ù Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙˆØ§Ù„ØªØ®Ø²ÙŠÙ† 
        // =============================================== 
 
        async saveData(autoSave = false) { 
            try { 
                this.appData.storageConfig = this.appData.storageConfig || {}; // Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† ØªÙ‡ÙŠØ¦Ø© storageConfig 
                this.appData.storageConfig.lastBackup = new Date().toISOString(); 
                await this.saveCoreAppData(); 
                this.updateStorageStatus(); 
                return true; 
            } catch (error) { 
                console.error('âŒ Secure Save failed:', error); 
                alert('âŒ ÙØ´Ù„ Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ø´ÙƒÙ„ Ø¢Ù…Ù†. ÙŠØ±Ø¬Ù‰ Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„Ù…Ø´Ø±Ù.'); 
                return false; 
            } 
        } 
 
        async loadData() { 
            try { 
                await this.loadCoreAppData(); 
 
                let masterKeySource = null; 
 
                if (this.appData.systemInfo.encryptionSalt) { 
                    masterKeySource = prompt("Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Master Key Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø¹Ù†Ø¯ Ø§Ù„ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ø£ÙˆÙ„Ù‰ Ø£Ùˆ Ø¨ØµÙ…Ø© Ø§Ù„Ø¬Ù‡Ø§Ø² Ø§Ù„Ø³Ø§Ø¨Ù‚Ø© Ù„ÙÙƒ ØªØ´ÙÙŠØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª:") || await this.generateDeviceFingerprint(); 
                    await this.generateSecureEncryptionKey(masterKeySource, this.appData.systemInfo.encryptionSalt); 
                } else { 
                    await this.generateSecureEncryptionKey(); 
                    if (confirm("Ù‡Ø°Ù‡ Ø£ÙˆÙ„ Ù…Ø±Ø© ØªÙ‚ÙˆÙ… ÙÙŠÙ‡Ø§ Ø¨ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ù†Ø¸Ø§Ù… Ø£Ùˆ Ø£Ù† Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªØ´ÙÙŠØ± Ù…ÙÙ‚ÙˆØ¯Ø©. Ù‡Ù„ ØªØ±ØºØ¨ ÙÙŠ ØªØ¹ÙŠÙŠÙ† Master Key Ø§Ù„Ø¢Ù†ØŸ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ) Ø³ÙŠÙØ·Ù„Ø¨ Ù…Ù†Ùƒ Ù‡Ø°Ø§ Ø§Ù„Ù…ÙØªØ§Ø­ ÙÙŠ Ø§Ù„Ù…Ø³ØªÙ‚Ø¨Ù„ Ø¥Ø°Ø§ ØºÙŠØ±Øª Ø¬Ù‡Ø§Ø²Ùƒ Ø£Ùˆ Ù…ØªØµÙØ­Ùƒ.")) { 
                        const customMasterKey = prompt("Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Master Key Ø®Ø§Øµ Ø¨Ùƒ (Ø§Ø­ÙØ¸Ù‡ ÙÙŠ Ù…ÙƒØ§Ù† Ø¢Ù…Ù† Ø¬Ø¯Ù‹Ø§):"); 
                        if (customMasterKey) { 
                            await this.generateSecureEncryptionKey(customMasterKey, null); 
                            alert("âœ… ØªÙ… ØªØ¹ÙŠÙŠÙ† Master Key Ø¨Ù†Ø¬Ø§Ø­. ØªØ°ÙƒØ± Ø­ÙØ¸Ù‡ Ø¬ÙŠØ¯Ù‹Ø§."); 
                        } 
                    } 
                } 
 
                if (this.appData.employees && Array.isArray(this.appData.employees)) { 
                    this.appData.employees = await Promise.all(this.appData.employees.map(async emp => { 
                        if (emp.password && !emp.password_hash) { // Migrate old password format 
                            emp.password_hash = bcrypt.hashSync(emp.password, 12); 
                            delete emp.password; 
                        } 
                        if (emp.phone_encrypted && typeof emp.phone_encrypted === 'string' && emp.phone_encrypted.startsWith('wizz_gsm_') && emp.phone_encrypted.length < 100) { // Migrate old phone format 
                            const oldPhoneNumber = emp.phone_encrypted.replace('wizz_gsm_', ''); 
                            emp.phone_encrypted = await this.encryptPhoneNumber(oldPhoneNumber); 
                        } else if (!emp.phone_encrypted) { // Ensure all phones are encrypted 
                            emp.phone_encrypted = await this.encryptPhoneNumber("N/A"); 
                        } 
                        if (emp.points === undefined) { // Initialize points for existing employees 
                            emp.points = 0; 
                        } 
                        if (!emp.lastCheckIn) { // Initialize lastCheckIn for overtime tracking 
                            emp.lastCheckIn = null; 
                        } 
                        if (!emp.breakReminderSet) { // Initialize break reminder status 
                            emp.breakReminderSet = false; 
                        } 
                        if (!emp.accessRevoked) { // New: Initialize access revoked status 
                            emp.accessRevoked = false; 
                        } 
                        if (!emp.hourlyRate) { // ØªÙ‡ÙŠØ¦Ø© Ù…Ø¹Ø¯Ù„ Ø§Ù„Ø³Ø§Ø¹Ø© Ù„Ù„Ø±ÙˆØ§ØªØ¨ 
                            emp.hourlyRate = 50; // Ø§ÙØªØ±Ø§Ø¶ÙŠ 
                        } 
                        return emp; 
                    })); 
                } 
 
                // Super Admin bypass: Ø¥Ø°Ø§ ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ ÙƒÙ€ Super Admin Ù„Ø§ ØªÙ‚Ù… Ø¨Ø¥Ù†Ø´Ø§Ø¡ Ø¨ÙŠØ§Ù†Ø§Øª Ø§ÙØªØ±Ø§Ø¶ÙŠØ© 
                if (!(localStorage.getItem('wizz_super_admin') === 'true')) { 
                    if (!this.appData.employees || this.appData.employees.length === 0) { 
                        this.appData.employees = [ 
                            { 
                                id: 'emp_1', 
                                full_name: 'Ù…Ø­Ù…Ø¯ Ø£Ø­Ù…Ø¯ Ø§Ù„Ø´Ø±ÙŠÙ', 
                                short_ext: '501', 
                                status: 'Active', 
                                role: 'Ù…Ø¯ÙŠØ±', 
                                department: 'Ø¥Ø¯Ø§Ø±Ø©', 
                                phone_encrypted: await this.encryptPhoneNumber('0660123456'), 
                                password_hash: bcrypt.hashSync('admin2025!', 12), 
                                created_at: new Date().toISOString(), 
                                points: 0, 
                                lastCheckIn: null, 
                                breakReminderSet: false, 
                                accessRevoked: false, 
                                hourlyRate: 100 
                            }, 
                            { 
                                id: 'emp_2', 
                                full_name: 'ÙØ§Ø·Ù…Ø© Ø¨Ù†Øª Ø§Ù„Ø­Ø³Ù†', 
                                short_ext: '502', 
                                status: 'Active', 
                                role: 'Ù…Ø¹Ù„Ù…', 
                                department: 'ØªØ¹Ù„ÙŠÙ…', 
                                phone_encrypted: await this.encryptPhoneNumber('0661234567'), 
                                password_hash: bcrypt.hashSync('teacher2025!', 12), 
                                created_at: new Date().toISOString(), 
                                points: 0, 
                                lastCheckIn: null, 
                                breakReminderSet: false, 
                                accessRevoked: false, 
                                hourlyRate: 70 
                            } 
                        ]; 
                        this.appData.systemInfo.setupCompleted = true; 
                        await this.saveData(true); 
                    } 
                } 
 
 
                // ØªÙ‡ÙŠØ¦Ø© CompanyVault Ø¨Ø¹Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙˆØ§Ù„ØªØ£ÙƒØ¯ Ù…Ù† ÙˆØ¬ÙˆØ¯ orgId 
                if (!this.appData.systemInfo.orgId || this.appData.systemInfo.orgId === 'DEFAULT_ORG_TEMP') { 
                    this.appData.systemInfo.orgId = 'ORG_' + (new Date().getTime()); // Generate a unique orgId if not set or is temporary 
                    await this.saveData(true); 
                } 
                this.companyVault = new WizzVault(this.appData.systemInfo.orgId); 
 
 
                this.updateUIFromAppData(); 
                return true; 
            } catch (error) { 
                console.error('âŒ Secure Load failed:', error); 
                alert('âŒ ÙØ´Ù„ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¢Ù…Ù†Ø©. Ù‚Ø¯ ØªÙƒÙˆÙ† Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ØªØ§Ù„ÙØ© Ø£Ùˆ Ù…ÙØªØ§Ø­ Ø§Ù„ØªØ´ÙÙŠØ± (Master Key/Ø¨ØµÙ…Ø© Ø§Ù„Ø¬Ù‡Ø§Ø²) ØºÙŠØ± ØµØ­ÙŠØ­. Ø³ÙŠØªÙ… Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ù†Ø¸Ø§Ù….'); 
                this.clearAllWizzData(true); 
                return false; 
            } 
        } 
 
        // =============================================== 
        // ğŸ”¥ ÙˆØ¸Ø§Ø¦Ù Ø§Ù„ÙˆÙ‚Øª ÙˆØ§Ù„Ù…ÙˆÙ‚Ø¹ 
        // =============================================== 
 
        async getServerTime() { 
            const TIME_OFFSET_THRESHOLD = 5 * 60 * 1000; 
            const FALLBACK_APIS = [ 
                'https://worldtimeapi.org/api/timezone/Africa/Casablanca', // Morocco timezone 
                'https://www.google.com', 
                'https://www.cloudflare.com' 
            ]; 
 
            let fetchedTime = null; 
            let source = 'Local Fallback'; 
            let isUncertain = false; 
 
            for (const api of FALLBACK_APIS) { 
                try { 
                    const response = await fetch(api); 
                    if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`); 
                    if (api.includes('worldtimeapi.org')) { 
                        const data = await response.json(); 
                        fetchedTime = new Date(data.utc_datetime); 
                        source = 'NTP Synced âœ“'; 
                        break; 
                    } else { 
                        // If it's a generic site, just use its Date header for a rough time check 
                        const dateHeader = response.headers.get('Date'); 
                        if (dateHeader) { 
                            fetchedTime = new Date(dateHeader); 
                            source = 'HTTP Header Fallback'; 
                            isUncertain = true; // Mark as uncertain if not from a dedicated time API 
                            break; 
                        } 
                    } 
                } catch (error) { 
                    console.warn(`âŒ Failed to connect to ${api}:`, error); 
                } 
            } 
 
            if (fetchedTime) { 
                const localTime = new Date(); 
                const timeDifference = Math.abs(localTime.getTime() - fetchedTime.getTime()); 
 
                if (timeDifference > TIME_OFFSET_THRESHOLD) { 
                    console.warn(`âš ï¸ ÙØ§Ø±Ù‚ Ø²Ù…Ù†ÙŠ ÙƒØ¨ÙŠØ± Ø¨ÙŠÙ† ÙˆÙ‚Øª Ø§Ù„Ø³ÙŠØ±ÙØ± ÙˆÙˆÙ‚Øª Ø§Ù„Ø¬Ù‡Ø§Ø²: ${Math.round(timeDifference / 1000 / 60)} Ø¯Ù‚ÙŠÙ‚Ø©.`); 
                    this.sendManagerNotification(`ğŸš¨ ØªØ­Ø°ÙŠØ± Ø²Ù…Ù†ÙŠ: ÙØ§Ø±Ù‚ ÙƒØ¨ÙŠØ± (${Math.round(timeDifference / 1000 / 60)} Ø¯Ù‚ÙŠÙ‚Ø©) Ø¨ÙŠÙ† ÙˆÙ‚Øª Ø§Ù„Ø³ÙŠØ±ÙØ± ÙˆÙˆÙ‚Øª Ø¬Ù‡Ø§Ø² Ø§Ù„Ù…ÙˆØ¸Ù. Ù‚Ø¯ ÙŠØ´ÙŠØ± Ø¥Ù„Ù‰ Ù…Ø­Ø§ÙˆÙ„Ø© ØªÙ„Ø§Ø¹Ø¨.`, 'MANAGER_ALERT'); 
                } 
                this.serverTime = fetchedTime; 
            } else { 
                this.serverTime = new Date(); 
                isUncertain = true; 
                this.sendManagerNotification(`ğŸš¨ ÙØ´Ù„ Ø¬Ù…ÙŠØ¹ Ù…ØµØ§Ø¯Ø± Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ø®Ø§Ø±Ø¬ÙŠØ©. Ø§Ø³ØªØ®Ø¯Ø§Ù… ÙˆÙ‚Øª Ø§Ù„Ø¬Ù‡Ø§Ø² Ø§Ù„Ù…Ø­Ù„ÙŠ. Ù‚Ø¯ ÙŠÙƒÙˆÙ† Ø§Ù„ØªÙˆÙ‚ÙŠØª ØºÙŠØ± Ù…Ø¤ÙƒØ¯.`, 'MANAGER_ALERT'); 
                alert("âš ï¸ ÙØ´Ù„ Ù…Ø²Ø§Ù…Ù†Ø© Ø§Ù„ÙˆÙ‚Øª Ù…Ø¹ Ø§Ù„Ø³ÙŠØ±ÙØ±Ø§Øª Ø§Ù„Ø®Ø§Ø±Ø¬ÙŠØ©. Ø³ÙŠØªÙ… Ø§Ø³ØªØ®Ø¯Ø§Ù… ÙˆÙ‚Øª Ø¬Ù‡Ø§Ø²Ùƒ Ø§Ù„Ù…Ø­Ù„ÙŠ. Ø§Ù„ØªÙˆÙ‚ÙŠØª ØºÙŠØ± Ù…Ø¤ÙƒØ¯."); 
            } 
 
            document.getElementById('serverTimeSource').textContent = `${source} ${isUncertain ? ' (ØºÙŠØ± Ù…Ø¤ÙƒØ¯ âš ï¸)' : ''}`; 
            return {time: this.serverTime, isUncertain: isUncertain}; 
        } 
 
        async getCurrentGPS() { 
            return new Promise(async (resolve, reject) => { 
                if (!navigator.geolocation) { 
                    return reject(new Error('Ø®Ø¯Ù…Ø© ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø¬ØºØ±Ø§ÙÙŠ ØºÙŠØ± Ù…Ø¯Ø¹ÙˆÙ…Ø© ÙÙŠ Ù…ØªØµÙØ­Ùƒ.')); 
                } 
                const GEOLOCATION_OPTIONS = {enableHighAccuracy: true, timeout: 8000, maximumAge: 0}; 
 
                navigator.geolocation.getCurrentPosition( 
                    async (position) => { 
                        const gpsData = { 
                            latitude: position.coords.latitude, 
                            longitude: position.coords.longitude, 
                            accuracy: position.coords.accuracy, 
                            timestamp: Date.now() 
                        }; 
 
                        try { 
                            const ACCURACY_THRESHOLD = 200; 
                            if (gpsData.accuracy > ACCURACY_THRESHOLD) { 
                                throw new Error(`Ø¯Ù‚Ø© Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ù…Ù†Ø®ÙØ¶Ø© Ø¬Ø¯Ø§Ù‹ (${gpsData.accuracy}mØŒ Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰ 200m). ÙŠØ±Ø¬Ù‰ Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ù„Ù…ÙƒØ§Ù† Ø£ÙØ¶Ù„ Ø£Ùˆ Ù…Ø­Ø§ÙˆÙ„Ø© Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆÙ‚Ø¹.`); 
                            } 
 
                            const ipResponse = await fetch('https://ipapi.co/json/'); 
                            const ipData = await ipResponse.json(); 
                            const distanceIPGPS = this.getDistance( 
                                parseFloat(ipData.latitude), parseFloat(ipData.longitude), 
                                gpsData.latitude, gpsData.longitude 
                            ); 
                            const IP_GPS_MAX_DISTANCE = 5000; 
 
                            if (distanceIPGPS > IP_GPS_MAX_DISTANCE) { 
                                throw new Error(`ØªÙ†Ø§Ù‚Ø¶ ÙƒØ¨ÙŠØ± Ø¨ÙŠÙ† Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø¬Ù‡Ø§Ø² ÙˆÙ…ÙˆÙ‚Ø¹ IP (${Math.round(distanceIPGPS / 1000)}km).`); 
                            } 
 
                            if (this.lastGPSPosition) { 
                                const timeDiff = (gpsData.timestamp - this.lastGPSUpdateTime) / 1000; 
                                const dist = this.getDistance(this.lastGPSPosition.latitude, this.lastGPSPosition.longitude, gpsData.latitude, gpsData.longitude); 
                                const speed = dist / timeDiff; 
                                const MAX_REAL_WORLD_SPEED = 50; // 50 m/s = 180 km/h, reasonable max speed. 
 
                                if (speed > MAX_REAL_WORLD_SPEED && timeDiff > 5) { // Only flag if significant speed over reasonable time 
                                    throw new Error(`Ø³Ø±Ø¹Ø© Ø­Ø±ÙƒØ© ØºÙŠØ± Ø·Ø¨ÙŠØ¹ÙŠØ© (${Math.round(speed * 3.6)} ÙƒÙ…/Ø³)`); 
                                } 
                            } 
                            this.lastGPSPosition = gpsData; 
                            this.lastGPSUpdateTime = gpsData.timestamp; 
 
                            resolve({ 
                                latitude: gpsData.latitude, 
                                longitude: gpsData.longitude, 
                                accuracy: gpsData.accuracy 
                            }); 
 
                        } catch (error) { 
                            reject(new Error(`ÙØ´Ù„ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ù…ÙˆÙ‚Ø¹: ${error.message}`)); 
                        } 
                    }, 
                    (error) => reject(new Error(`ÙØ´Ù„ Ø§Ù„ØªØ­Ø¯ÙŠØ¯ (${error.code}): ${error.message}`)), 
                    GEOLOCATION_OPTIONS 
                ); 
            }); 
        } 
 
        // =============================================== 
        // ğŸ”¥ ÙˆØ¸Ø§Ø¦Ù ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… 
        // =============================================== 
 
        updateTimeDisplay() { 
            setInterval(async () => { 
                const timeData = await this.getServerTime(); 
                const now = timeData.time; 
                const isUncertain = timeData.isUncertain; 
 
                document.getElementById('currentWorkTime').textContent = now.toLocaleTimeString('ar-EG', { 
                    hour: '2-digit', 
                    minute: '2-digit', 
                    second: '2-digit' 
                }) + (isUncertain ? ' âš ï¸' : ''); 
                document.getElementById('loginCurrentTime').textContent = now.toLocaleTimeString('ar-EG', { 
                    hour: '2-digit', 
                    minute: '2-digit', 
                    second: '2-digit' 
                }) + (isUncertain ? ' âš ï¸' : ''); 
 
                // Update overtime display on employee panel 
                if (this.currentEmployee && document.getElementById('employeeDashboard').classList.contains('hidden') === false) { 
                    const employee = this.appData.employees.find(emp => emp.id === this.currentEmployee.id); 
                    if (employee && employee.lastCheckIn) { 
                        const checkInTime = new Date(employee.lastCheckIn); 
                        const nowMillis = now.getTime(); 
                        const workDurationMillis = nowMillis - checkInTime.getTime(); 
                        const eightHoursMillis = 8 * 60 * 60 * 1000; // 8 hours in milliseconds 
 
                        let overtimeMillis = 0; 
                        if (workDurationMillis > eightHoursMillis) { 
                            overtimeMillis = workDurationMillis - eightHoursMillis; 
                        } 
 
                        const hours = Math.floor(overtimeMillis / (60 * 60 * 1000)); 
                        const minutes = Math.floor((overtimeMillis % (60 * 60 * 1000)) / (60 * 1000)); 
                        const seconds = Math.floor(((overtimeMillis % (60 * 60 * 1000)) % (60 * 1000)) / 1000); 
 
                        document.getElementById('overtimeDisplay').textContent = 
                            `${String(hours).padStart(2, '0')}:${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`; 
 
                        // Check for mandatory break 
                        if (!employee.breakReminderSet && workDurationMillis >= (this.MANDATORY_BREAK_AFTER_HOURS * 60 * 60 * 1000)) { 
                            this.showDignityBreakModal(); // Ø³Ø§Ø¹Ø© ÙƒØ±Ø§Ù…Ø© 
                            employee.breakReminderSet = true; // Set flag to prevent repeated reminders for the same check-in session 
                            // Log this break reminder to the attendance archive 
                            if (this.currentEmployee) { 
                                const textArchiveEntry = { 
                                    employeeId: this.currentEmployee.id, 
                                    employeeName: this.currentEmployee.full_name, 
                                    timestamp: new Date().toISOString(), 
                                    date: new Date().toISOString().slice(0, 10), 
                                    time: new Date().toLocaleTimeString('ar-EG'), 
                                    type: 'break-reminder', 
                                    status: 'notified', 
                                    legal: true // ØªÙˆØ«ÙŠÙ‚ Ù‚Ø§Ù†ÙˆÙ†ÙŠ Ù„ÙˆÙ‚Øª Ø§Ù„Ø§Ø³ØªØ±Ø§Ø­Ø© 
                                }; 
                                this.saveIndexedDBRecord('attendanceArchive', textArchiveEntry); 
                            } 
                        } 
                    } else { 
                        document.getElementById('overtimeDisplay').textContent = '00:00:00'; 
                    } 
                } 
 
                this.checkAttendanceWindow(); 
            }, 1000); 
        } 
 
        async checkAttendanceWindow() { 
            const loginBtn = document.getElementById('employeeLoginBtn'); 
            const voiceBtn = document.getElementById('voiceSignatureBtn'); 
            const loginMessageEl = document.getElementById('loginMessage'); 
            const sosBtn = document.getElementById('sosButton'); 
 
            const timeData = await this.getServerTime(); 
            const currentTime = timeData.time; 
 
            const departmentEntryTime = this.appData.workSettings.departments['Ø¥Ø¯Ø§Ø±Ø©'] || this.appData.workSettings.officialEntryTime; 
            const [entryHour, entryMinute] = departmentEntryTime.split(':').map(Number); 
            const officialEntryDate = new Date(currentTime.getFullYear(), currentTime.getMonth(), currentTime.getDate(), entryHour, entryMinute, 0); 
 
            const attendanceWindowEnd = new Date(officialEntryDate.getTime() + this.appData.workSettings.attendanceWindowDuration * 60 * 1000); 
 
            let isWithinGeoFence = false; 
            let geoFenceMessage = ''; 
            if (this.appData.workSettings.companyGPS) { 
                try { 
                    const gpsData = await this.getCurrentGPS(); 
                    isWithinGeoFence = this.isWithinCompanyBounds(gpsData); 
                    if (!isWithinGeoFence) { 
                        geoFenceMessage = 'ğŸš« Ø£Ù†Øª Ø®Ø§Ø±Ø¬ Ù†Ø·Ø§Ù‚ Ø§Ù„Ø¹Ù…Ù„. Ù„Ø§ ÙŠÙ…ÙƒÙ† ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø­Ø¶ÙˆØ±.'; 
                    } 
                } catch (error) { 
                    console.warn("Geo-fencing check failed:", error.message); 
                    geoFenceMessage = `âš ï¸ ÙØ´Ù„ ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆÙ‚Ø¹: ${error.message}. Ù‚Ø¯ Ù„Ø§ ØªØªÙ…ÙƒÙ† Ù…Ù† ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø­Ø¶ÙˆØ±.`; 
                } 
            } else { 
                isWithinGeoFence = true; // No geo-fencing configured, so allow by default 
            } 
            // Always enable SOS button 
            sosBtn.classList.remove('attendance-closed'); 
            sosBtn.disabled = false; 
 
 
            if (currentTime < officialEntryDate) { 
                loginBtn.classList.add('attendance-closed'); 
                loginBtn.disabled = true; 
                loginBtn.textContent = 'Ù„Ù… ØªØ¨Ø¯Ø£ ÙØªØ±Ø© Ø§Ù„Ø³Ù…Ø§Ø­ Ø¨Ø§Ù„Ø¯Ø®ÙˆÙ„'; 
                voiceBtn.classList.add('attendance-closed'); 
                voiceBtn.disabled = true; 
                if (geoFenceMessage) { 
                    loginMessageEl.textContent = geoFenceMessage; 
                } else { 
                    loginMessageEl.textContent = 'Ù„Ù… ØªØ¨Ø¯Ø£ ÙØªØ±Ø© Ø§Ù„Ø³Ù…Ø§Ø­ Ù„ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø­Ø¶ÙˆØ± Ø¨Ø¹Ø¯.'; 
                } 
            } else if (currentTime > attendanceWindowEnd) { 
                loginBtn.classList.add('attendance-closed'); 
                loginBtn.disabled = true; 
                loginBtn.textContent = 'Ø§Ù†ØªÙ‡Øª ÙØªØ±Ø© Ø§Ù„Ø³Ù…Ø§Ø­ Ù„ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø­Ø¶ÙˆØ±'; 
                voiceBtn.classList.add('attendance-closed'); 
                voiceBtn.disabled = true; 
                if (geoFenceMessage) { 
                    loginMessageEl.textContent = geoFenceMessage; 
                } else { 
                    loginMessageEl.textContent = 'Ø§Ù†ØªÙ‡Øª ÙØªØ±Ø© Ø§Ù„Ø³Ù…Ø§Ø­ Ù„ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø­Ø¶ÙˆØ± Ø§Ù„ÙŠÙˆÙ….'; 
                } 
 
                const lastNotificationDate = localStorage.getItem('lastAttendanceWindowClosedNotification'); 
                const today = currentTime.toISOString().slice(0, 10); 
 
                if (lastNotificationDate !== today) { 
                    this.sendDailyAttendanceSummaryToManager(); 
                    localStorage.setItem('lastAttendanceWindowClosedNotification', today); 
                } 
            } else { 
                const canClockIn = isWithinGeoFence && !this.currentEmployee?.lastCheckIn; 
                loginBtn.classList.toggle('attendance-closed', !canClockIn); 
                loginBtn.disabled = !canClockIn; 
                loginBtn.innerHTML = '<i class="fas fa-camera mr-2"></i>ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨Ø§Ù„ØªØ­Ù‚Ù‚ Ø§Ù„Ø¨ØµØ±ÙŠ'; 
 
                voiceBtn.classList.toggle('attendance-closed', !canClockIn); 
                voiceBtn.disabled = !canClockIn; 
 
                if (geoFenceMessage) { 
                    loginMessageEl.textContent = geoFenceMessage; 
                } else if (this.currentEmployee?.lastCheckIn) { 
                    loginMessageEl.textContent = 'âœ… Ù„Ù‚Ø¯ Ø³Ø¬Ù„Øª Ø¯Ø®ÙˆÙ„Ùƒ Ø¨Ø§Ù„ÙØ¹Ù„ Ø§Ù„ÙŠÙˆÙ….'; 
                    loginBtn.textContent = 'ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„'; 
                    voiceBtn.textContent = 'ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„'; 
                } else { 
                    loginMessageEl.textContent = ''; 
                } 
            } 
        } 
 
        async sendDailyAttendanceSummaryToManager() { 
            const today = new Date().toISOString().slice(0, 10); 
            const allArchiveRecords = await this.getAllIndexedDBRecords('attendanceArchive'); 
            const todayArchiveRecords = allArchiveRecords.filter(log => log.date === today && log.status !== 'failed_location'); 
 
            const lateToday = todayArchiveRecords.filter(record => record.isLate).length; 
            const verifiedToday = todayArchiveRecords.filter(record => record.status.startsWith('verified')).length; 
            const totalEmployees = this.appData.employees.length; 
 
            let summaryMessage = `Ù…Ù„Ø®Øµ Ø§Ù„Ø­Ø¶ÙˆØ± Ø§Ù„ÙŠÙˆÙ…ÙŠ Ù„Ù€ ${today}:\n`; 
            summaryMessage += `- Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†: ${totalEmployees}\n`; 
            summaryMessage += `- ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø­Ø¶ÙˆØ±Ù‡Ù…: ${verifiedToday}\n`; 
            summaryMessage += `- Ø§Ù„Ù…ØªØ£Ø®Ø±ÙˆÙ†: ${lateToday}\n`; 
            summaryMessage += `- Ø§Ù„ØºØ§Ø¦Ø¨ÙˆÙ† (ØªÙ‚Ø±ÙŠØ¨ÙŠ): ${totalEmployees - verifiedToday}\n`; 
 
            this.sendManagerNotification(`ğŸ“Š ${summaryMessage}`, 'DAILY_SUMMARY'); 
        } 
 
        async employeeLoginAttempt(method = 'visual') { 
            const loginPhone = document.getElementById('loginPhone').value.trim(); 
            const loginPassword = document.getElementById('loginPassword').value; 
            const virtualOfficeKey = document.getElementById('virtualOfficeKey').value.trim(); 
            const loginMessageEl = document.getElementById('loginMessage'); 
            loginMessageEl.textContent = ''; 
 
            // Check legal agreement first 
            if (!this.appData.legalAgreementAccepted) { 
                this.showLegalAgreementScreen(); 
                return; 
            } 
 
            // ØªØ­Ù‚Ù‚ Ù…Ù† Super Admin Ù‚Ø¨Ù„ ÙƒÙ„ Ø´ÙŠØ¡ 
            if (window.paypalGate.checkLoginForSuperAdminBypass(loginPhone, loginPassword)) { 
                this.handleSuccessfulSuperAdminLogin(); 
                return; 
            } 
 
 
            let employeeFound = null; 
            for (const emp of this.appData.employees) { 
                const decryptedPhone = await this.decryptPhoneNumber(emp.phone_encrypted); 
                if (decryptedPhone === loginPhone) { 
                    employeeFound = emp; 
                    break; 
                } 
            } 
 
            if (!employeeFound) { 
                // Check if logging in via Virtual Office 
                const office = this.appData.virtualOffices.find(off => off.key === virtualOfficeKey); 
                if (office) { 
                    // Log the action to sovereignty log 
                    this.addSovereigntyLogEntry('Virtual Office Login', `Ø§Ù„Ù…ÙƒØªØ¨ Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ ${office.name} (Ù…ÙØªØ§Ø­: ${office.key}) Ù‚Ø§Ù… Ø¨ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„.`); 
                    this.currentVirtualOffice = office; 
                    this.handleSuccessfulAdminLogin(office.name, office.role); // ØªÙ…Ø±ÙŠØ± role Ø¨Ø¯Ù„Ø§Ù‹ Ù…Ù† roles 
                    return; // Exit after successful office login 
                } else { 
                    let pendingEmployeeFound = null; 
                    for (const pendEmp of this.appData.pendingUsers) { 
                        const decryptedPendPhone = await this.decryptPhoneNumber(pendEmp.phoneNumber); 
                        if (decryptedPendPhone === loginPhone) { 
                            pendingEmployeeFound = pendEmp; 
                            break; 
                        } 
                    } 
                    if (pendingEmployeeFound) { 
                        loginMessageEl.textContent = 'ğŸš« Ø­Ø³Ø§Ø¨Ùƒ Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©. ÙŠØ±Ø¬Ù‰ Ø§Ù†ØªØ¸Ø§Ø± Ù…ÙˆØ§ÙÙ‚Ø© Ø§Ù„Ù…Ø¯ÙŠØ±.'; 
                    } else { 
                        // Traffic light violation for unauthorized login attempt 
                        this.processTrafficLightViolation('unknown_user_attempt', 'login_fail'); 
                        loginMessageEl.textContent = 'âŒ Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ Ø£Ùˆ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ØºÙŠØ± ØµØ­ÙŠØ­Ø©.'; 
                    } 
                    return; 
                } 
            } 
 
            // If employee found, check password and revoked status 
            if (employeeFound && bcrypt.compareSync(loginPassword, employeeFound.password_hash)) { 
                if (employeeFound.accessRevoked) { 
                    this.processTrafficLightViolation(employeeFound.id, 'red_card_login_attempt'); // Auto red card on login attempt if revoked 
                    loginMessageEl.textContent = `ğŸš« ØªÙ… Ø¥Ù†Ù‡Ø§Ø¡ ØµÙ„Ø§Ø­ÙŠØªÙƒ! ÙŠØ±Ø¬Ù‰ Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© (Ù…Ø®Ø§Ù„ÙØ© Ø§Ù„Ø¨Ù†Ø¯ Ø±Ù‚Ù… 3 Ù…Ù† Ù‚Ø§Ù†ÙˆÙ† Ø­Ù…Ø§ÙŠØ© Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø¤Ø³Ø³Ø©).`; 
                    this.failedLoginAttempts++; 
                    this.checkAndWipeData(); // Ø¨Ø±ÙˆØªÙˆÙƒÙˆÙ„ Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡ - ØªØ¯Ù…ÙŠØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª 
                    return; 
                } 
 
                this.currentEmployee = employeeFound; 
                this.resetSessionTimeout(); 
                this.failedLoginAttempts = 0; // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø§Øª Ø§Ù„ÙØ§Ø´Ù„Ø© 
 
                // Check for geo-fencing before proceeding 
                let isWithinGeoFence = false; 
                if (this.appData.workSettings.companyGPS) { 
                    try { 
                        const gpsData = await this.getCurrentGPS(); 
                        isWithinGeoFence = this.isWithinCompanyBounds(gpsData); 
                        if (!isWithinGeoFence) { // ØªÙ†Ø¨ÙŠÙ‡ Ø§Ù„Ù…Ø¯ÙŠØ± Ø¹Ù†Ø¯ Ø¯Ø®ÙˆÙ„ Ù…ÙˆØ¸Ù Ù„Ù…Ù†Ø·Ù‚Ø© Ù…Ø­Ø¸ÙˆØ±Ø© 
                            this.sendManagerNotification(`ğŸš¨ Ø§Ù„Ù…ÙˆØ¸Ù ${employeeFound.full_name} ÙŠØ­Ø§ÙˆÙ„ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ù…Ù† Ø®Ø§Ø±Ø¬ Ù†Ø·Ø§Ù‚ Ø§Ù„Ø¹Ù…Ù„. Ø§Ù„Ù…ÙˆÙ‚Ø¹: (${gpsData.latitude}, ${gpsData.longitude})`, 'MANAGER_ALERT'); 
                        } 
                    } catch (error) { 
                        console.warn("Geo-fencing check failed:", error.message); 
                        loginMessageEl.textContent = `âš ï¸ ÙØ´Ù„ ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆÙ‚Ø¹: ${error.message}. Ù„Ø§ ÙŠÙ…ÙƒÙ† ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø­Ø¶ÙˆØ±.`; 
                        this.processTrafficLightViolation(employeeFound.id, 'failed_gps_check'); 
                        return; // Prevent login if geo-fencing check fails 
                    } 
                } else { 
                    isWithinGeoFence = true; // No geo-fencing configured 
                } 
 
                if (!isWithinGeoFence) { 
                    loginMessageEl.textContent = 'ğŸš« Ø£Ù†Øª Ø®Ø§Ø±Ø¬ Ù†Ø·Ø§Ù‚ Ø§Ù„Ø¹Ù…Ù„. Ù„Ø§ ÙŠÙ…ÙƒÙ† ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø­Ø¶ÙˆØ±.'; 
                    this.processTrafficLightViolation(employeeFound.id, 'outside_geofence'); 
                    return; // Prevent login if outside geo-fence 
                } 
                // If already checked in, prevent further check-ins 
                if (this.currentEmployee.lastCheckIn) { 
                    loginMessageEl.textContent = 'âœ… Ù„Ù‚Ø¯ Ø³Ø¬Ù„Øª Ø¯Ø®ÙˆÙ„Ùƒ Ø¨Ø§Ù„ÙØ¹Ù„ Ø§Ù„ÙŠÙˆÙ….'; 
                    document.getElementById('loginForm').classList.add('hidden'); 
                    document.getElementById('employeeDashboard').classList.remove('hidden'); 
                    document.getElementById('employeeDashboardName').textContent = `Ù…Ø±Ø­Ø¨Ø§Ù‹ ${this.currentEmployee.full_name}`; 
                    this.updateEmployeeDashboardUI(); 
                    return; 
                } 
 
 
                // Check for active broadcast message 
                const latestBroadcast = this.appData.broadcastMessages[this.appData.broadcastMessages.length - 1]; 
                if (latestBroadcast && !localStorage.getItem(`broadcast_seen_${latestBroadcast.id}`)) { 
                    this.showBroadcastModal(latestBroadcast.message); 
                    localStorage.setItem(`broadcast_seen_${latestBroadcast.id}`, 'true'); // Mark as seen 
                } 
 
                if (method === 'visual' && this.appData.workSettings.visualVerification) { 
                    document.getElementById('loginForm').classList.add('hidden'); 
                    document.getElementById('visualVerificationScreen').classList.remove('hidden'); 
                    this.startSecureVisualVerification(); 
                } else if (method === 'voice') { 
                    document.getElementById('loginForm').classList.add('hidden'); 
                    document.getElementById('voiceSignatureScreen').classList.remove('hidden'); 
                    this.startVoiceSignatureRecording(); 
                } else { 
                    this.handleSuccessfulLogin(employeeFound, 'normal'); 
                } 
            } else { 
                // Wrong password, check for traffic light violation 
                this.processTrafficLightViolation(employeeFound ? employeeFound.id : 'unknown_user_attempt', 'login_fail'); 
                this.failedLoginAttempts++; 
                this.checkAndWipeData(); // Ø¨Ø±ÙˆØªÙˆÙƒÙˆÙ„ Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡ - ØªØ¯Ù…ÙŠØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª 
                if (employeeFound && employeeFound.accessRevoked) { // After processing, check if access revoked 
                    loginMessageEl.textContent = `ğŸš« ØªÙ… Ø¥Ù†Ù‡Ø§Ø¡ ØµÙ„Ø§Ø­ÙŠØªÙƒ! ÙŠØ±Ø¬Ù‰ Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© (Ù…Ø®Ø§Ù„ÙØ© Ø§Ù„Ø¨Ù†Ø¯ Ø±Ù‚Ù… 3 Ù…Ù† Ù‚Ø§Ù†ÙˆÙ† Ø­Ù…Ø§ÙŠØ© Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø¤Ø³Ø³Ø©).`; 
                } else { 
                    loginMessageEl.textContent = 'âŒ Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ Ø£Ùˆ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ØºÙŠØ± ØµØ­ÙŠØ­Ø©.'; 
                } 
            } 
        } 
 
        async handleSuccessfulLogin(employee, method, voiceSignature = null) { 
            const timeData = await this.getServerTime(); 
            const currentTime = timeData.time; 
            const isUncertainTime = timeData.isUncertain; 
 
            if (isUncertainTime) { 
                alert("âš ï¸ ÙØ´Ù„ Ù…Ø²Ø§Ù…Ù†Ø© Ø§Ù„ÙˆÙ‚Øª Ù…Ø¹ Ø§Ù„Ø³ÙŠØ±ÙØ±. Ù„Ø§ ÙŠÙ…ÙƒÙ† ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ ÙÙŠ ÙˆØ¶Ø¹ Ø¹Ø¯Ù… Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ù„ÙˆÙ‚Øª."); 
                this.sendManagerNotification(`ğŸš¨ Ù…Ù†Ø¹ ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„ Ù„Ù„Ù…ÙˆØ¸Ù ${employee.full_name} Ø¨Ø³Ø¨Ø¨ ØªÙˆÙ‚ÙŠØª ØºÙŠØ± Ù…Ø¤ÙƒØ¯.`, 'MANAGER_ALERT'); 
                document.getElementById('loginMessage').textContent = 'ğŸš« Ù„Ø§ ÙŠÙ…ÙƒÙ† ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„: Ø§Ù„ØªÙˆÙ‚ÙŠØª ØºÙŠØ± Ù…Ø¤ÙƒØ¯.'; 
                return; 
            } 
 
            const departmentEntryTime = this.appData.workSettings.departments[employee.department] || this.appData.workSettings.officialEntryTime; 
            const [entryHour, entryMinute] = departmentEntryTime.split(':').map(Number); 
            const officialEntryDate = new Date(currentTime.getFullYear(), currentTime.getMonth(), currentTime.getDate(), entryHour, entryMinute, 0); 
            const graceEndDate = new Date(officialEntryDate.getTime() + this.appData.workSettings.gracePeriodMinutes * 60 * 1000); 
 
            let lateMinutes = 0; 
            let isLate = false; 
            if (currentTime > graceEndDate) { 
                lateMinutes = Math.floor((currentTime - officialEntryDate) / (60 * 1000)); 
                isLate = true; 
                document.getElementById('loginMessage').textContent = `â° ØªØ£Ø®Ø±Øª ${lateMinutes} Ø¯Ù‚ÙŠÙ‚Ø© | ÙŠØ±Ø¬Ù‰ Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©`; 
 
                this.appData.lateArrivalsLog.push({ 
                    employeeId: employee.id, 
                    employeeName: employee.full_name, 
                    lateBy: lateMinutes, 
                    timestamp: currentTime.toISOString(), 
                    status: 'Pending Review' 
                }); 
                this.sendManagerNotification(`ğŸš¨ Ø§Ù„Ù…ÙˆØ¸Ù ${employee.full_name} ØªØ£Ø®Ø± ${lateMinutes} Ø¯Ù‚ÙŠÙ‚Ø©. (${method} Ø¯Ø®ÙˆÙ„)`, 'MANAGER_ALERT'); 
                alert(`ğŸš¨ Ø¥Ø´Ø¹Ø§Ø± Ù„Ù„Ù…Ø¯ÙŠØ±: Ø§Ù„Ù…ÙˆØ¸Ù ${employee.full_name} Ù…ØªØ£Ø®Ø± ${lateMinutes} Ø¯Ù‚ÙŠÙ‚Ø©\nØ­Ø§Ù„ØªÙ‡: Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©`); 
            } else { 
                document.getElementById('loginMessage').textContent = 'âœ… ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨Ù†Ø¬Ø§Ø­'; 
                if (employee.points !== undefined) { 
                    employee.points += 10; 
                    this.sendManagerNotification(`ğŸ’° Ø§Ù„Ù…ÙˆØ¸Ù ${employee.full_name} Ø­ØµÙ„ Ø¹Ù„Ù‰ 10 Ù†Ù‚Ø§Ø· Ù„Ø­Ø¶ÙˆØ±Ù‡ ÙÙŠ Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…Ø­Ø¯Ø¯. Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù†Ù‚Ø§Ø·: ${employee.points}`, 'MANAGER_ALERT'); 
                } 
            } 
 
            // Record check-in time 
            employee.lastCheckIn = currentTime.toISOString(); 
            employee.breakReminderSet = false; // Reset break reminder for new session 
 
            const textArchiveEntry = { 
                visualRecordId: null, 
                employeeId: employee.id, 
                employeeName: employee.full_name, 
                department: employee.department, 
                timestamp: currentTime.toISOString(), 
                date: currentTime.toISOString().slice(0, 10), 
                time: currentTime.toLocaleTimeString('ar-EG'), 
                type: 'check-in', 
                status: (method === 'visual' ? 'verified_visual' : (method === 'voice' ? 'verified_voice' : 'verified_normal')), 
                locationStatus: 'ØºÙŠØ± Ù…Ø·Ø¨Ù‚', // Will be updated by visual/voice if GPS is used 
                lateMinutes: lateMinutes, 
                isLate: isLate, 
                voiceSignature: voiceSignature 
            }; 
            const archivedId = await this.saveIndexedDBRecord('attendanceArchive', textArchiveEntry); 
            textArchiveEntry.id = archivedId; 
            this.appData.attendanceArchive.unshift(textArchiveEntry); 
 
            await this.saveData(); 
            this.updateLateEmployeesList(); 
 
            // Show employee dashboard after check-in 
            document.getElementById('loginForm').classList.add('hidden'); 
            document.getElementById('employeeDashboard').classList.remove('hidden'); 
            document.getElementById('employeeDashboardName').textContent = `Ù…Ø±Ø­Ø¨Ø§Ù‹ ${this.currentEmployee.full_name}`; 
            this.updateEmployeeDashboardUI(); 
        } 
 
        handleSuccessfulSuperAdminLogin() { 
            this.currentEmployee = { // Simulate admin user from virtual office 
                id: 'super_admin', 
                full_name: 'Super Admin', 
                role: 'Ù…Ø¯ÙŠØ±', 
                virtualOfficeRoles: ['Super Admin'] 
            }; 
            this.loadDashboard(); 
            this.addSovereigntyLogEntry('Super Admin Login', 'Super Admin Ù‚Ø§Ù… Ø¨ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„.'); 
            alert('ğŸ‘‘ ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„ Super Admin Ø¨Ù†Ø¬Ø§Ø­!'); 
        } 
 
        // New: Admin Login via Virtual Office 
        handleSuccessfulAdminLogin(officeName, role) { 
            this.currentEmployee = { // Simulate admin user from virtual office 
                id: `admin_vo_${officeName}`, 
                full_name: officeName, 
                role: 'Ù…Ø¯ÙŠØ±', // Ø¬Ù…ÙŠØ¹ Ù…Ø¯Ø±Ø§Ø¡ Ø§Ù„Ù…ÙƒØ§ØªØ¨ Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ© ÙŠØ¹ØªØ¨Ø±ÙˆÙ† Ù…Ø¯Ø±Ø§Ø¡ 
                virtualOfficeRole: role // Ø§Ù„Ø¯ÙˆØ± Ø§Ù„ÙØ¹Ù„ÙŠ Ù„Ù„Ù…ÙƒØªØ¨ Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ 
            }; 
            // For now, virtual office logins go directly to admin dashboard 
            // In a more complex app, roles would filter admin panel features 
            this.loadDashboard(); 
        } 
 
        async handleClockOut() { 
            if (!this.currentEmployee) { 
                alert('Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…ÙˆØ¸Ù Ù…Ø³Ø¬Ù„ Ù„Ù„Ø¯Ø®ÙˆÙ„.'); 
                return; 
            } 
 
            if (!this.currentEmployee.lastCheckIn) { 
                alert('Ø§Ù„Ù…ÙˆØ¸Ù Ù„Ù… ÙŠØ³Ø¬Ù„ Ø¯Ø®ÙˆÙ„Ù‡ Ø¨Ø¹Ø¯ Ø§Ù„ÙŠÙˆÙ….'); 
                return; 
            } 
 
            const confirmClockOut = confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬ØŸ Ø³ÙŠØªÙ… Ø­Ø³Ø§Ø¨ Ø³Ø§Ø¹Ø§Øª Ø¹Ù…Ù„Ùƒ.'); 
            if (!confirmClockOut) return; 
 
            const employee = this.appData.employees.find(emp => emp.id === this.currentEmployee.id); 
            if (!employee) return; 
 
            const timeData = await this.getServerTime(); 
            const currentTime = timeData.time; 
 
            const checkInTime = new Date(employee.lastCheckIn); 
            const workDurationMillis = currentTime.getTime() - checkInTime.getTime(); 
            const eightHoursMillis = 8 * 60 * 60 * 1000; // 8 hours in milliseconds 
 
            let overtimeMinutes = 0; 
            if (workDurationMillis > eightHoursMillis) { 
                overtimeMinutes = Math.floor((workDurationMillis - eightHoursMillis) / (60 * 1000)); 
            } 
            const totalWorkMinutes = Math.floor(workDurationMillis / (60 * 1000)); 
 
            // Ø­Ø³Ø§Ø¨ Ø§Ù„Ø±Ø§ØªØ¨ Ù…Ø¹ Ù…Ø¹Ø§Ù…Ù„ Ø§Ù„Ø¬Ù‡Ø¯ 1.5 Ù„Ù„Ø³Ø§Ø¹Ø§Øª Ø§Ù„Ø¥Ø¶Ø§ÙÙŠØ© 
            const normalWorkHours = Math.min(8, totalWorkMinutes / 60); 
            const normalPay = normalWorkHours * (employee.hourlyRate || 50); 
            const overtimeHours = overtimeMinutes / 60; 
            const overtimePay = overtimeHours * (employee.hourlyRate || 50) * 1.5; // Ù…Ø¹Ø§Ù…Ù„ Ø§Ù„Ø¬Ù‡Ø¯ 1.5 
            const totalEarnings = normalPay + overtimePay; 
 
            // ØªØ·Ø¨ÙŠÙ‚ Ø£ÙŠ Ø®ØµÙˆÙ…Ø§Øª Ù…Ù† Ù†Ø¸Ø§Ù… Ø§Ù„Ø¥Ø´Ø§Ø±Ø§Øª 
            let totalDeductions = 0; 
            if (this.appData.trafficLightViolations[employee.id]?.totalDeduction) { 
                totalDeductions = this.appData.trafficLightViolations[employee.id].totalDeduction; 
            } 
            const netEarnings = totalEarnings - totalDeductions; 
 
 
            const textArchiveEntry = { 
                employeeId: employee.id, 
                employeeName: employee.full_name, 
                department: employee.department, 
                timestamp: currentTime.toISOString(), 
                date: currentTime.toISOString().slice(0, 10), 
                time: currentTime.toLocaleTimeString('ar-EG'), 
                type: 'check-out', 
                checkInTime: employee.lastCheckIn, 
                totalWorkMinutes: totalWorkMinutes, 
                overtimeMinutes: overtimeMinutes, 
                totalEarnings: totalEarnings, // Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø£Ø±Ø¨Ø§Ø­ Ù‚Ø¨Ù„ Ø§Ù„Ø®ØµÙˆÙ…Ø§Øª 
                totalDeductions: totalDeductions, // Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø®ØµÙˆÙ…Ø§Øª 
                netEarnings: netEarnings, // ØµØ§ÙÙŠ Ø§Ù„Ø£Ø±Ø¨Ø§Ø­ 
                status: 'checked_out' 
            }; 
            await this.saveIndexedDBRecord('attendanceArchive', textArchiveEntry); 
            this.appData.attendanceArchive.unshift(textArchiveEntry); 
 
            employee.lastCheckIn = null; // Reset check-in status 
            employee.breakReminderSet = false; // Reset break reminder status 
            clearTimeout(this.mandatoryBreakTimeoutId); // Clear any pending break reminders 
            await this.saveData(); 
 
            alert(`âœ… ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬Ùƒ Ø¨Ù†Ø¬Ø§Ø­.\nØ³Ø§Ø¹Ø§Øª Ø¹Ù…Ù„Ùƒ Ø§Ù„Ø¥Ø¶Ø§ÙÙŠØ© Ø§Ù„ÙŠÙˆÙ…: ${overtimeMinutes} Ø¯Ù‚ÙŠÙ‚Ø©.\nØµØ§ÙÙŠ Ø£Ø±Ø¨Ø§Ø­Ùƒ Ø§Ù„ÙŠÙˆÙ…: ${netEarnings.toFixed(2)} Ø¯Ø±Ù‡Ù….`); 
            this.logout(); // Redirect to login after clock out 
        } 
 
 
        async startSecureVisualVerification() { 
            const loadingText = document.getElementById('loadingText'); 
            const liveVideo = document.getElementById('liveVideo'); 
            const statusMessage = document.getElementById('statusMessage'); 
            const visualVerificationScreen = document.getElementById('visualVerificationScreen'); 
            const backToLoginBtn = document.getElementById('backToLoginBtn'); 
 
            visualVerificationScreen.classList.remove('hidden'); 
            loadingText.classList.remove('hidden'); 
            liveVideo.classList.add('hidden'); 
            document.getElementById('capturedImage').classList.add('hidden'); 
            statusMessage.textContent = 'Ø¬Ø§Ø±ÙŠ Ø·Ù„Ø¨ Ø§Ù„ÙˆØµÙˆÙ„ Ù„Ù„ÙƒØ§Ù…ÙŠØ±Ø§ Ø§Ù„Ø¢Ù…Ù†Ø©...'; 
            backToLoginBtn.onclick = () => { 
                this.stopCamera(); 
                document.getElementById('visualVerificationScreen').classList.add('hidden'); 
                document.getElementById('loginForm').classList.remove('hidden'); 
                clearTimeout(this.cameraTimeoutId); 
            }; 
 
            this.cameraTimeoutId = setTimeout(() => { 
                this.stopCamera(); 
                statusMessage.textContent = 'ğŸš« Ø§Ù†ØªÙ‡Ù‰ ÙˆÙ‚Øª Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§ (30 Ø«Ø§Ù†ÙŠØ©). ÙŠØ±Ø¬Ù‰ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.'; 
                this.sendManagerNotification(`ğŸš¨ Ø§Ù„Ù…ÙˆØ¸Ù ${this.currentEmployee.full_name}: Ø§Ù†ØªÙ‡Ù‰ ÙˆÙ‚Øª Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§ (30 Ø«Ø§Ù†ÙŠØ©).`, 'MANAGER_ALERT'); 
                setTimeout(() => { 
                    document.getElementById('visualVerificationScreen').classList.add('hidden'); 
                    document.getElementById('loginForm').classList.remove('hidden'); 
                }, 2000); 
            }, 30000); 
 
            this.mediaStream = await this.safeCameraAccess(); 
            if (!this.mediaStream) { 
                statusMessage.textContent = 'ğŸš« Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ÙˆØµÙˆÙ„ Ù„Ù„ÙƒØ§Ù…ÙŠØ±Ø§. ÙŠØ±Ø¬Ù‰ Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª.'; 
                this.sendManagerNotification(`ğŸš¨ ÙØ´Ù„ Ø§Ù„ØªØ­Ù‚Ù‚ Ø§Ù„Ø¨ØµØ±ÙŠ Ù„Ù„Ù…ÙˆØ¸Ù ${this.currentEmployee.full_name}: ÙØ´Ù„ Ø§Ù„ÙˆØµÙˆÙ„ Ù„Ù„ÙƒØ§Ù…ÙŠØ±Ø§.`, 'MANAGER_ALERT'); 
                setTimeout(() => { 
                    document.getElementById('visualVerificationScreen').classList.add('hidden'); 
                    document.getElementById('loginForm').classList.remove('hidden'); 
                }, 3000); 
                clearTimeout(this.cameraTimeoutId); 
                return; 
            } 
 
            liveVideo.srcObject = this.mediaStream; 
            liveVideo.play(); 
 
            liveVideo.onloadedmetadata = () => { 
                loadingText.classList.add('hidden'); 
                liveVideo.classList.remove('hidden'); 
                statusMessage.textContent = 'âœ… Ø§Ù†Ø¸Ø± Ù…Ø¨Ø§Ø´Ø±Ø© Ù„Ù„ÙƒØ§Ù…ÙŠØ±Ø§ - Ø³ÙŠØªÙ… Ø§Ù„ØªÙ‚Ø§Ø· Ø§Ù„ØµÙˆØ±Ø© Ø®Ù„Ø§Ù„ 2-5 Ø«ÙˆØ§Ù†Ù'; 
                setTimeout(() => this.captureSecureAttendancePhoto(), Math.random() * 3000 + 2000); 
            }; 
        } 
 
        async captureSecureAttendancePhoto() { 
            clearTimeout(this.cameraTimeoutId); 
 
            const video = document.getElementById('liveVideo'); 
            const canvas = document.getElementById('hiddenCanvas'); 
            const ctx = canvas.getContext('2d'); 
            const statusMessage = document.getElementById('statusMessage'); 
            const capturedImage = document.getElementById('capturedImage'); 
 
            const targetWidth = 320; 
            const targetHeight = 240; 
            canvas.width = targetWidth; 
            canvas.height = targetHeight; 
            ctx.drawImage(video, 0, 0, targetWidth, targetHeight); 
 
            const timeData = await this.getServerTime(); 
            const serverTime = timeData.time; 
            const isUncertainTime = timeData.isUncertain; 
 
            if (isUncertainTime) { 
                alert("âš ï¸ ÙØ´Ù„ Ù…Ø²Ø§Ù…Ù†Ø© Ø§Ù„ÙˆÙ‚Øª Ù…Ø¹ Ø§Ù„Ø³ÙŠØ±ÙØ±. Ù„Ø§ ÙŠÙ…ÙƒÙ† ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ ÙÙŠ ÙˆØ¶Ø¹ Ø¹Ø¯Ù… Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ù„ÙˆÙ‚Øª."); 
                this.sendManagerNotification(`ğŸš¨ Ù…Ù†Ø¹ Ø§Ù„ØªØ­Ù‚Ù‚ Ø§Ù„Ø¨ØµØ±ÙŠ Ù„Ù„Ù…ÙˆØ¸Ù ${this.currentEmployee.full_name} Ø¨Ø³Ø¨Ø¨ ØªÙˆÙ‚ÙŠØª ØºÙŠØ± Ù…Ø¤ÙƒØ¯.`, 'MANAGER_ALERT'); 
                statusMessage.textContent = 'ğŸš« Ù„Ø§ ÙŠÙ…ÙƒÙ† ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„: Ø§Ù„ØªÙˆÙ‚ÙŠØª ØºÙŠØ± Ù…Ø¤ÙƒØ¯.'; 
                this.stopCamera(); 
                setTimeout(() => { 
                    document.getElementById('visualVerificationScreen').classList.add('hidden'); 
                    document.getElementById('loginForm').classList.remove('hidden'); 
                }, 3000); 
                return; 
            } 
 
            let gpsData = null; 
            let locationStatus = 'Ù…ØªØ§Ø­'; 
            let distanceToCompany = -1; 
            let verificationStatus = 'verified_visual'; 
 
            try { 
                gpsData = await this.getCurrentGPS(); 
                distanceToCompany = this.getDistance(this.appData.workSettings.companyGPS.lat, this.appData.workSettings.companyGPS.lng, gpsData.latitude, gpsData.longitude); 
 
                if (!this.isWithinCompanyBounds(gpsData)) { 
                    locationStatus = 'Ø®Ø§Ø±Ø¬ Ø§Ù„Ù†Ø·Ø§Ù‚'; 
                    verificationStatus = 'failed_location'; 
                    statusMessage.textContent = `ğŸš« ØºÙŠØ± Ù…Ø³Ù…ÙˆØ­ - Ø£Ù†Øª Ø®Ø§Ø±Ø¬ Ù†Ø·Ø§Ù‚ Ø§Ù„Ø´Ø±ÙƒØ© (${Math.floor(distanceToCompany - this.appData.workSettings.companyGPS.radius)} Ù…ØªØ±).`; 
                    this.sendManagerNotification(`ğŸš¨ Ø§Ù„Ù…ÙˆØ¸Ù ${this.currentEmployee.full_name} Ø­Ø§ÙˆÙ„ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ù…Ù† Ø®Ø§Ø±Ø¬ Ù†Ø·Ø§Ù‚ Ø§Ù„Ø´Ø±ÙƒØ©. Ø§Ù„Ù…ÙˆÙ‚Ø¹: (${gpsData.latitude}, ${gpsData.longitude})`, 'MANAGER_ALERT'); 
                    this.stopCamera(); 
                    setTimeout(() => { 
                        document.getElementById('visualVerificationScreen').classList.add('hidden'); 
                        document.getElementById('loginForm').classList.remove('hidden'); 
                    }, 3000); 
                    return; 
                } 
            } catch (err) { 
                locationStatus = 'ÙØ´Ù„ Ø§Ù„ØªØ­Ø¯ÙŠØ¯'; 
                verificationStatus = 'failed_location'; 
                console.warn("GPS error during capture:", err.message); 
                statusMessage.textContent = `âš ï¸ ØªØ­Ø°ÙŠØ±: ÙØ´Ù„ ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø¬ØºØ±Ø§ÙÙŠ. ${err.message}`; 
                this.sendManagerNotification(`ğŸš¨ Ø§Ù„Ù…ÙˆØ¸Ù ${this.currentEmployee.full_name}: ÙØ´Ù„ ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø¬ØºØ±Ø§ÙÙŠ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„ØªØ­Ù‚Ù‚ Ø§Ù„Ø¨ØµØ±ÙŠ: ${err.message}.`, 'MANAGER_ALERT'); 
                this.stopCamera(); 
                setTimeout(() => { 
                    document.getElementById('visualVerificationScreen').classList.add('hidden'); 
                    document.getElementById('loginForm').classList.remove('hidden'); 
                }, 3000); 
                return; 
            } 
 
            const deviceHash = await this.generateDeviceFingerprint(); 
 
            ctx.font = 'bold 10px Cairo'; 
            ctx.fillStyle = 'rgba(255,255,255,0.95)'; 
            ctx.strokeStyle = 'rgba(0,0,0,0.8)'; 
            ctx.lineWidth = 1; 
 
            const watermarkLines = [ 
                `â° ${serverTime.toLocaleString('ar-MA', { 
                    year: 'numeric', month: '2-digit', day: '2-digit', 
                    hour: '2-digit', minute: '2-digit', second: '2-digit' 
                })}`, 
                `ğŸ“ ${gpsData ? `Lat: ${gpsData.latitude.toFixed(4)}, Lng: ${gpsData.longitude.toFixed(4)} (Acc: ${gpsData.accuracy}m, Dist: ${distanceToCompany.toFixed(0)}m)` : 'Ø§Ù„Ù…ÙˆÙ‚Ø¹: ØºÙŠØ± Ù…ØªØ§Ø­'}`, 
                `ğŸ” Ø§Ù„Ø¬Ù‡Ø§Ø²: ${deviceHash.slice(0, 10)}... | Ø§Ù„Ù…ÙˆØ¸Ù: ${this.currentEmployee.full_name}` 
            ]; 
 
            let yOffset = 15; 
            watermarkLines.forEach(line => { 
                ctx.strokeText(line, 5, yOffset); 
                ctx.fillText(line, 5, yOffset); 
                yOffset += 12; 
            }); 
 
            const secureImageData = canvas.toDataURL('image/jpeg', 0.6); 
            capturedImage.src = secureImageData; 
            capturedImage.classList.remove('hidden'); 
            video.classList.add('hidden'); 
 
            await this.saveEncryptedVisualAttendance(secureImageData, serverTime, gpsData, deviceHash, locationStatus, verificationStatus, null); // Pass null for voice signature 
 
            statusMessage.innerHTML = 'âœ… <strong>ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø­Ø¶ÙˆØ± Ø¨Ø§Ù„ØªØ­Ù‚Ù‚ Ø§Ù„Ø¨ØµØ±ÙŠ Ø¨Ù†Ø¬Ø§Ø­!</strong><br>Ø§Ù„ØµÙˆØ±Ø© Ù…Ø´ÙØ±Ø© ÙˆÙ…Ø­ÙÙˆØ¸Ø© Ù…Ø­Ù„ÙŠØ§Ù‹.'; 
 
            setTimeout(() => { 
                this.stopCamera(); 
                this.handleSuccessfulLogin(this.currentEmployee, 'visual'); 
            }, 3000); 
        } 
 
        // New: Start voice signature recording 
        async startVoiceSignatureRecording() { 
            const voiceStatusMessage = document.getElementById('voiceStatusMessage'); 
            const startVoiceRecordingBtn = document.getElementById('startVoiceRecordingBtn'); 
            const recordedAudioPlayback = document.getElementById('recordedAudioPlayback'); 
            const confirmVoiceSignatureBtn = document.getElementById('confirmVoiceSignatureBtn'); 
            const cancelVoiceSignatureBtn = document.getElementById('cancelVoiceSignatureBtn'); 
 
            recordedAudioPlayback.classList.add('hidden'); 
            confirmVoiceSignatureBtn.classList.add('hidden'); 
            voiceStatusMessage.textContent = 'Ø¬Ø§Ø±ÙŠ Ø·Ù„Ø¨ Ø§Ù„ÙˆØµÙˆÙ„ Ù„Ù„Ù…ÙŠÙƒØ±ÙˆÙÙˆÙ†...'; 
            startVoiceRecordingBtn.classList.remove('hidden'); 
            startVoiceRecordingBtn.classList.remove('recording-pulse'); 
            startVoiceRecordingBtn.disabled = false; 
 
            cancelVoiceSignatureBtn.onclick = () => { 
                this.stopVoiceRecording(); 
                document.getElementById('voiceSignatureScreen').classList.add('hidden'); 
                document.getElementById('loginForm').classList.remove('hidden'); 
            }; 
 
            startVoiceRecordingBtn.onclick = async () => { 
                startVoiceRecordingBtn.disabled = true; 
                startVoiceRecordingBtn.classList.add('recording-pulse'); 
                voiceStatusMessage.textContent = 'ğŸ¤ Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ³Ø¬ÙŠÙ„ (3 Ø«ÙˆØ§Ù†Ù)...'; 
 
                try { 
                    const stream = await navigator.mediaDevices.getUserMedia({audio: true}); 
                    this.mediaRecorder = new MediaRecorder(stream); 
                    this.audioChunks = []; 
 
                    this.mediaRecorder.ondataavailable = event => { 
                        this.audioChunks.push(event.data); 
                    }; 
 
                    this.mediaRecorder.onstop = async () => { 
                        const audioBlob = new Blob(this.audioChunks, {type: 'audio/webm'}); 
                        const audioUrl = URL.createObjectURL(audioBlob); 
                        recordedAudioPlayback.src = audioUrl; 
                        recordedAudioPlayback.classList.remove('hidden'); 
 
                        const reader = new FileReader(); 
                        reader.readAsDataURL(audioBlob); 
                        reader.onloadend = async () => { 
                            const base64Audio = reader.result; 
                            voiceStatusMessage.textContent = 'âœ… ØªÙ… Ø§Ù„ØªØ³Ø¬ÙŠÙ„ Ø¨Ù†Ø¬Ø§Ø­. ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„Ø§Ø³ØªÙ…Ø§Ø¹ ÙˆØ§Ù„ØªØ£ÙƒÙŠØ¯.'; 
                            confirmVoiceSignatureBtn.classList.remove('hidden'); 
                            confirmVoiceSignatureBtn.onclick = async () => { 
                                await this.processVoiceSignature(base64Audio); 
                            }; 
                        }; 
 
                        startVoiceRecordingBtn.classList.remove('recording-pulse'); 
                        stream.getTracks().forEach(track => track.stop()); // Stop microphone stream 
                    }; 
 
                    this.mediaRecorder.start(); 
                    this.voiceRecordingTimeoutId = setTimeout(() => { 
                        this.mediaRecorder.stop(); 
                    }, 3000); // Record for 3 seconds 
 
                } catch (err) { 
                    console.error('ÙØ´Ù„ Ø§Ù„ÙˆØµÙˆÙ„ Ù„Ù„Ù…ÙŠÙƒØ±ÙˆÙÙˆÙ†:', err); 
                    voiceStatusMessage.textContent = 'ğŸš« ÙØ´Ù„ Ø§Ù„ÙˆØµÙˆÙ„ Ù„Ù„Ù…ÙŠÙƒØ±ÙˆÙÙˆÙ†. ÙŠØ±Ø¬Ù‰ Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª.'; 
                    startVoiceRecordingBtn.disabled = false; 
                    startVoiceRecordingBtn.classList.remove('recording-pulse'); 
                } 
            }; 
        } 
 
        // New: Stop voice recording 
        stopVoiceRecording() { 
            if (this.mediaRecorder && this.mediaRecorder.state !== 'inactive') { 
                this.mediaRecorder.stop(); 
            } 
            clearTimeout(this.voiceRecordingTimeoutId); 
            const recordedAudioPlayback = document.getElementById('recordedAudioPlayback'); 
            recordedAudioPlayback.src = ''; // Clear audio 
            recordedAudioPlayback.classList.add('hidden'); 
            document.getElementById('startVoiceRecordingBtn').disabled = false; 
            document.getElementById('startVoiceRecordingBtn').classList.remove('recording-pulse'); 
            document.getElementById('confirmVoiceSignatureBtn').classList.add('hidden'); 
        } 
 
        // New: Process voice signature 
        async processVoiceSignature(base64Audio) { 
            const employee = this.currentEmployee; 
            if (!employee) { 
                alert('Ø®Ø·Ø£: Ù„Ù… ÙŠØªÙ… ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆØ¸Ù.'); 
                return; 
            } 
 
            document.getElementById('voiceSignatureScreen').classList.add('hidden'); 
            document.getElementById('loginForm').classList.remove('hidden'); // Return to login form momentarily or dashboard 
 
            let gpsData = null; 
            let locationStatus = 'Ù…ØªØ§Ø­'; 
            let verificationStatus = 'verified_voice'; 
 
            try { 
                gpsData = await this.getCurrentGPS(); 
                const distanceToCompany = this.getDistance(this.appData.workSettings.companyGPS.lat, this.appData.workSettings.companyGPS.lng, gpsData.latitude, gpsData.longitude); 
 
                if (!this.isWithinCompanyBounds(gpsData)) { 
                    locationStatus = 'Ø®Ø§Ø±Ø¬ Ø§Ù„Ù†Ø·Ø§Ù‚'; 
                    verificationStatus = 'failed_location'; 
                    this.sendManagerNotification(`ğŸš¨ Ø§Ù„Ù…ÙˆØ¸Ù ${employee.full_name} Ø­Ø§ÙˆÙ„ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨Ø§Ù„ØªÙˆÙ‚ÙŠØ¹ Ø§Ù„ØµÙˆØªÙŠ Ù…Ù† Ø®Ø§Ø±Ø¬ Ù†Ø·Ø§Ù‚ Ø§Ù„Ø´Ø±ÙƒØ©. Ø§Ù„Ù…ÙˆÙ‚Ø¹: (${gpsData.latitude}, ${gpsData.longitude})`, 'MANAGER_ALERT'); 
                    alert(`ğŸš« ØºÙŠØ± Ù…Ø³Ù…ÙˆØ­ - Ø£Ù†Øª Ø®Ø§Ø±Ø¬ Ù†Ø·Ø§Ù‚ Ø§Ù„Ø´Ø±ÙƒØ© (${Math.floor(distanceToCompany - this.appData.workSettings.companyGPS.radius)} Ù…ØªØ±).`); 
                    return; 
                } 
            } catch (err) { 
                locationStatus = 'ÙØ´Ù„ Ø§Ù„ØªØ­Ø¯ÙŠØ¯'; 
                verificationStatus = 'failed_location'; 
                console.warn("GPS error during voice signature:", err.message); 
                this.sendManagerNotification(`ğŸš¨ Ø§Ù„Ù…ÙˆØ¸Ù ${employee.full_name}: ÙØ´Ù„ ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø¬ØºØ±Ø§ÙÙŠ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„ØªÙˆÙ‚ÙŠØ¹ Ø§Ù„ØµÙˆØªÙŠ: ${err.message}.`, 'MANAGER_ALERT'); 
                alert(`âš ï¸ ØªØ­Ø°ÙŠØ±: ÙØ´Ù„ ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø¬ØºØ±Ø§ÙÙŠ. ${err.message}`); 
            } 
 
            await this.saveEncryptedVisualAttendance(null, new Date(), gpsData, await this.generateDeviceFingerprint(), locationStatus, verificationStatus, base64Audio); 
            this.handleSuccessfulLogin(employee, 'voice', base64Audio); 
        } 
 
        // New: Send SOS Alert 
        async sendSOSAlert() { 
            if (!this.currentEmployee && !document.getElementById('loginPhone').value) { 
                alert('Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…ÙˆØ¸Ù Ù…Ø³Ø¬Ù„ Ù„Ù„Ø¯Ø®ÙˆÙ„ Ø£Ùˆ Ø±Ù‚Ù… Ù‡Ø§ØªÙ Ù„Ø¥Ø±Ø³Ø§Ù„ ØªÙ†Ø¨ÙŠÙ‡ SOS.'); 
                return; 
            } 
 
            const confirmSOS = confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ø£Ù†Ùƒ ØªØ±ÙŠØ¯ Ø¥Ø±Ø³Ø§Ù„ ØªÙ†Ø¨ÙŠÙ‡ SOSØŸ Ø³ÙŠØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ù…ÙˆÙ‚Ø¹Ùƒ Ø§Ù„Ø­Ø§Ù„ÙŠ Ù„Ù„Ù…Ø¯ÙŠØ± ÙÙˆØ±Ø§Ù‹.'); 
            if (!confirmSOS) return; 
 
            let sosEmployeeName = this.currentEmployee ? this.currentEmployee.full_name : 'Ù…ÙˆØ¸Ù ØºÙŠØ± Ù…Ø³Ø¬Ù„'; 
            let sosEmployeeId = this.currentEmployee ? this.currentEmployee.id : 'N/A'; 
            let sosPhoneNumber = document.getElementById('loginPhone').value || 'N/A'; 
 
            let gpsData = null; 
            try { 
                gpsData = await this.getCurrentGPS(); 
            } catch (error) { 
                alert(`âš ï¸ ÙØ´Ù„ ØªØ­Ø¯ÙŠØ¯ Ù…ÙˆÙ‚Ø¹Ùƒ Ù„Ø¥Ø±Ø³Ø§Ù„ ØªÙ†Ø¨ÙŠÙ‡ SOS: ${error.message}.`); 
                gpsData = {latitude: 'ØºÙŠØ± Ù…ØªØ§Ø­', longitude: 'ØºÙŠØ± Ù…ØªØ§Ø­', accuracy: 'ØºÙŠØ± Ù…ØªØ§Ø­'}; 
            } 
 
            const sosMessage = `ğŸ†˜ ØªÙ†Ø¨ÙŠÙ‡ SOS Ù…Ù† Ø§Ù„Ù…ÙˆØ¸Ù ${sosEmployeeName} (ID: ${sosEmployeeId}, Phone: ${sosPhoneNumber})!\n` + 
                `ğŸ“ Ø§Ù„Ù…ÙˆÙ‚Ø¹: Latitude ${gpsData.latitude}, Longitude ${gpsData.longitude} (Accuracy: ${gpsData.accuracy}m)\n` + 
                `â° Ø§Ù„ÙˆÙ‚Øª: ${new Date().toLocaleString('ar-MA')}`; 
 
            this.sendManagerNotification(sosMessage, 'SOS_ALERT'); 
            alert('âœ… ØªÙ… Ø¥Ø±Ø³Ø§Ù„ ØªÙ†Ø¨ÙŠÙ‡ SOS Ù„Ù„Ù…Ø¯ÙŠØ± Ø¨Ù†Ø¬Ø§Ø­.'); 
            this.addSovereigntyLogEntry('SOS Alert', `ØªÙ… Ø¥Ø±Ø³Ø§Ù„ ØªÙ†Ø¨ÙŠÙ‡ SOS Ù…Ù† ${sosEmployeeName}.`); 
        } 
 
        // âœ… Ø§Ù„Ø¯ÙˆØ§Ù„ Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¢Ù…Ù†Ø© (Ù…Ø«Ù„ getDistance, isWithinCompanyBounds) 
        getDistance(lat1, lon1, lat2, lon2) { 
            const R = 6371e3; // Earth's radius in meters 
            const Ï†1 = lat1 * Math.PI / 180; 
            const Ï†2 = lat2 * Math.PI / 180; 
            const Î”Ï† = (lat2 - lat1) * Math.PI / 180; 
            const Î”Î» = (lon2 - lon1) * Math.PI / 180; 
 
            const a = Math.sin(Î”Ï† / 2) * Math.sin(Î”Ï† / 2) + 
                Math.cos(Ï†1) * Math.cos(Ï†2) * 
                Math.sin(Î”Î» / 2) * Math.sin(Î”Î» / 2); 
            const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a)); 
 
            return R * c; 
        } 
 
        isWithinCompanyBounds(gps) { 
            if (!gps || !this.appData.workSettings.companyGPS || gps.latitude === 'N/A' || gps.longitude === 'N/A') return false; 
            const companyLat = this.appData.workSettings.companyGPS.lat; 
            const companyLng = this.appData.workSettings.companyGPS.lng; 
            const radius = this.appData.workSettings.companyGPS.radius; 
            const distance = this.getDistance(companyLat, companyLng, gps.latitude, gps.longitude); 
            return distance <= radius; 
        } 
 
        getEmployeeDepartment(empId) { 
            const emp = this.appData.employees.find(e => e.id === empId); 
            return emp?.department || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'; 
        } 
 
        calculateLateMinutes(timestamp, employeeId) { 
            const employee = this.appData.employees.find(emp => emp.id === employeeId); 
            if (!employee) return 0; 
 
            const entryTimeSetting = this.appData.workSettings.departments[employee.department] || this.appData.workSettings.officialEntryTime; 
            const [entryHour, entryMinute] = entryTimeSetting.split(':').map(Number); 
 
            const currentTime = new Date(timestamp); 
            const officialEntryDate = new Date(currentTime.getFullYear(), currentTime.getMonth(), currentTime.getDate(), entryHour, entryMinute, 0); 
 
            const gracePeriodMillis = this.appData.workSettings.gracePeriodMinutes * 60 * 1000; 
            const graceEndDate = new Date(officialEntryDate.getTime() + gracePeriodMillis); 
 
            if (currentTime > graceEndDate) { 
                return Math.floor((currentTime - officialEntryDate) / (60 * 1000)); 
            } 
            return 0; 
        } 
 
        isEmployeeLate(timestamp, employeeId) { 
            return this.calculateLateMinutes(timestamp, employeeId) > 0; 
        } 
 
        // âœ… Ø­ÙØ¸ Ø³Ø¬Ù„ Ø§Ù„Ø­Ø¶ÙˆØ± Ø§Ù„Ø¨ØµØ±ÙŠ Ø§Ù„Ù…Ø´ÙØ± ÙÙŠ IndexedDB 
        async saveEncryptedVisualAttendance(imageData, serverTime, gps, deviceHash, locationStatus, verificationStatus, voiceSignatureData = null) { 
            const attendanceRecord = { 
                employeeId: this.currentEmployee.id, 
                employeeName: this.currentEmployee.full_name, 
                timestamp: serverTime.toISOString(), 
                gps: { 
                    latitude: gps?.latitude || 'N/A', 
                    longitude: gps?.longitude || 'N/A', 
                    accuracy: gps?.accuracy || 'N/A' 
                }, 
                deviceHash: deviceHash, 
                locationStatus: locationStatus, 
                photoData: imageData, // Ù‚Ø¯ ØªÙƒÙˆÙ† null Ù„Ù„ØªÙˆÙ‚ÙŠØ¹ Ø§Ù„ØµÙˆØªÙŠ 
                voiceSignatureData: voiceSignatureData, // Ù‚Ø¯ ØªÙƒÙˆÙ† null Ù„Ù„ØªØ­Ù‚Ù‚ Ø§Ù„Ø¨ØµØ±ÙŠ 
                verificationStatus: verificationStatus 
            }; 
 
            // ØªÙˆÙ‚ÙŠØ¹ Ø§Ù„Ø³Ø¬Ù„ Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… CompanyVault 
            const signedRecord = await this.companyVault.signAttendanceRecord(attendanceRecord); 
 
            const encryptedData = await this.encryptData(signedRecord); // ØªØ´ÙÙŠØ± Ø§Ù„Ø³Ø¬Ù„ Ø§Ù„Ù…ÙˆÙ‚Ø¹ 
 
            const recordId = await this.saveIndexedDBRecord('visualAttendanceRecords', { 
                data: encryptedData, 
                timestamp: serverTime.toISOString(), 
                employeeId: this.currentEmployee.id 
            }); 
 
            // The text archive record will also contain GPS data for heatmap 
            await this.stripAndArchiveVisualRecord(recordId, attendanceRecord); 
 
            this.appData.visualAttendanceLog.unshift({ 
                id: recordId, 
                timestamp: serverTime.toISOString(), 
                employeeName: this.currentEmployee.full_name, 
                status: attendanceRecord.verificationStatus, 
                locationStatus: locationStatus, 
            }); 
            if (this.appData.visualAttendanceLog.length > 10) { 
                this.appData.visualAttendanceLog.pop(); 
            } 
 
            await this.saveData(true); 
            this.updateVisualAttendanceLogDisplay(); 
        } 
 
        // âœ… Ø¯Ø§Ù„Ø© Ù„Ø§Ø³ØªØ®Ù„Ø§Øµ ÙˆØ£Ø±Ø´ÙØ© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù†ØµÙŠØ© Ù…Ù† Ø§Ù„Ø³Ø¬Ù„ Ø§Ù„Ø¨ØµØ±ÙŠ 
        async stripAndArchiveVisualRecord(visualRecordId, fullRecord) { 
            const lateMinutes = this.calculateLateMinutes(fullRecord.timestamp, fullRecord.employeeId); 
            const isLate = this.isEmployeeLate(fullRecord.timestamp, fullRecord.employeeId); 
 
            const textArchiveEntry = { 
                visualRecordId: visualRecordId, 
                employeeId: fullRecord.employeeId, 
                employeeName: fullRecord.employee_name || fullRecord.employeeName, // Ensure compatibility 
                department: this.getEmployeeDepartment(fullRecord.employeeId), 
                timestamp: fullRecord.timestamp, 
                date: fullRecord.timestamp.slice(0, 10), 
                time: new Date(fullRecord.timestamp).toLocaleTimeString('ar-EG'), 
                type: 'check-in', // Default to check-in for visual/voice records 
                status: fullRecord.verificationStatus, 
                locationStatus: fullRecord.locationStatus, 
                lateMinutes: lateMinutes, 
                isLate: isLate, 
                voiceSignatureExists: !!fullRecord.voiceSignatureData, 
                gps: fullRecord.gps // Store GPS data in archive for heatmap 
            }; 
 
            const archivedId = await this.saveIndexedDBRecord('attendanceArchive', textArchiveEntry); 
            textArchiveEntry.id = archivedId; 
 
            this.appData.attendanceArchive.unshift(textArchiveEntry); 
            if (this.appData.attendanceArchive.length > 100) { 
                this.appData.attendanceArchive.pop(); 
            } 
        } 
 
        // New: Generate Monthly PDF Report 
        async generateMonthlyReport() { 
            if (!this.currentEmployee) { 
                alert('Ø§Ù„Ø±Ø¬Ø§Ø¡ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø£ÙˆÙ„Ø§Ù‹.'); 
                return; 
            } 
 
            alert('Ø¬Ø§Ø±ÙŠ Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø´Ù‡Ø±ÙŠ. Ù‚Ø¯ ÙŠØ³ØªØºØ±Ù‚ Ù‡Ø°Ø§ Ø¨Ø¹Ø¶ Ø§Ù„ÙˆÙ‚Øª...'); 
 
            const employee = this.currentEmployee; 
            const allArchiveRecords = await this.getAllIndexedDBRecords('attendanceArchive'); 
            const employeeRecords = allArchiveRecords.filter(record => record.employeeId === employee.id); 
 
            const today = new Date(); 
            const currentMonth = today.getMonth(); 
            const currentYear = today.getFullYear(); 
 
            const monthlyRecords = employeeRecords.filter(record => { 
                const recordDate = new Date(record.timestamp); 
                return recordDate.getMonth() === currentMonth && recordDate.getFullYear() === currentYear; 
            }).sort((a, b) => new Date(a.timestamp) - new Date(b.timestamp)); 
 
            let totalWorkMinutes = 0; 
            let totalOvertimeMinutes = 0; 
            let workDays = 0; 
            let breakReminders = 0; // Track break reminders 
            let lastCheckInTime = null; 
 
            const reportDetails = monthlyRecords.map(record => { 
                let recordInfo = `${new Date(record.timestamp).toLocaleDateString('ar-MA')} - ${record.time}`; 
                if (record.type === 'check-in') { 
                    lastCheckInTime = new Date(record.timestamp); 
                    recordInfo += ` (Ø¯Ø®ÙˆÙ„)`; 
                } else if (record.type === 'check-out' && lastCheckInTime) { 
                    const duration = (new Date(record.timestamp).getTime() - lastCheckInTime.getTime()) / (60 * 1000); 
                    totalWorkMinutes += duration; 
                    totalOvertimeMinutes += record.overtimeMinutes || 0; 
                    workDays++; 
                    recordInfo += ` (Ø®Ø±ÙˆØ¬) - ${Math.floor(duration)} Ø¯Ù‚ÙŠÙ‚Ø© Ø¹Ù…Ù„. Ø¥Ø¶Ø§ÙÙŠ: ${record.overtimeMinutes || 0} Ø¯Ù‚ÙŠÙ‚Ø©`; 
                    if (record.netEarnings !== undefined) { 
                        recordInfo += ` (Ø£Ø±Ø¨Ø§Ø­: ${record.netEarnings.toFixed(2)} Ø¯Ø±Ù‡Ù…)`; 
                    } 
                    lastCheckInTime = null; 
                } else if (record.isLate) { 
                    recordInfo += ` (ØªØ£Ø®ÙŠØ± ${record.lateMinutes} Ø¯Ù‚ÙŠÙ‚Ø©)`; 
                } 
                if (record.status.includes('visual')) recordInfo += ' (Ø¨ØµØ±ÙŠ)'; 
                if (record.status.includes('voice')) recordInfo += ' (ØµÙˆØªÙŠ)'; 
                if (record.type === 'break-reminder' || record.type === 'dignity_break_6h') { // New: Include break reminders in report 
                    recordInfo += ' (ØªØ°ÙƒÙŠØ± Ø¨Ø§Ù„Ø±Ø§Ø­Ø©)'; 
                    breakReminders++; 
                } 
                return recordInfo; 
            }).join('<br>'); 
 
            // Ø­Ø³Ø§Ø¨ Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø®ØµÙˆÙ…Ø§Øª Ø§Ù„Ø´Ù‡Ø±ÙŠØ© 
            const monthlyDeductions = this.appData.trafficLightViolations[employee.id]?.violations 
                .filter(v => new Date(v.time).getMonth() === currentMonth && new Date(v.time).getFullYear() === currentYear) 
                .reduce((sum, v) => sum + (v.deduction || 0), 0) || 0; 
 
            const reportContent = ` 
                <div style="font-family: 'Cairo', sans-serif; text-align: right; direction: rtl; padding: 20px; color: #333;"> 
                    <h1 style="text-align: center; color: #0052FF; margin-bottom: 20px;">ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø­Ø¶ÙˆØ± Ø§Ù„Ø´Ù‡Ø±ÙŠ</h1> 
                    <p style="font-size: 1.2em; font-weight: bold;">Ø§Ø³Ù… Ø§Ù„Ù…ÙˆØ¸Ù: ${employee.full_name}</p> 
                    <p>Ø§Ù„Ù‚Ø³Ù…: ${employee.department}</p> 
                    <p>Ø§Ù„Ø´Ù‡Ø±: ${new Date(currentYear, currentMonth).toLocaleDateString('ar-MA', { 
                        month: 'long', 
                        year: 'numeric' 
                    })}</p> 
                    <hr style="border-top: 1px solid #eee; margin: 20px 0;"> 
                    <h2 style="color: #0052FF;">Ù…Ù„Ø®Øµ Ø§Ù„Ø­Ø¶ÙˆØ±:</h2> 
                    <p>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø£ÙŠØ§Ù… Ø§Ù„Ø¹Ù…Ù„ Ø§Ù„Ù…Ø³Ø¬Ù„Ø©: ${workDays}</p> 
                    <p>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø³Ø§Ø¹Ø§Øª Ø§Ù„Ø¹Ù…Ù„: ${Math.floor(totalWorkMinutes / 60)} Ø³Ø§Ø¹Ø© Ùˆ ${Math.floor(totalWorkMinutes % 60)} Ø¯Ù‚ÙŠÙ‚Ø©</p> 
                    <p>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø³Ø§Ø¹Ø§Øª Ø§Ù„Ø¹Ù…Ù„ Ø§Ù„Ø¥Ø¶Ø§ÙÙŠØ©: ${Math.floor(totalOvertimeMinutes / 60)} Ø³Ø§Ø¹Ø© Ùˆ ${Math.floor(totalOvertimeMinutes % 60)} Ø¯Ù‚ÙŠÙ‚Ø©</p> 
                    <p>Ø¹Ø¯Ø¯ Ù…Ø±Ø§Øª ØªØ°ÙƒÙŠØ± Ø§Ù„Ø±Ø§Ø­Ø©: ${breakReminders}</p> 
                    <p>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ù†Ù‚Ø§Ø· Ø§Ù„ÙˆÙ„Ø§Ø¡: ${employee.points}</p> 
                    <hr style="border-top: 1px solid #eee; margin: 20px 0;"> 
                    <h2 style="color: #0052FF;">ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø³Ø¬Ù„Ø§Øª:</h2> 
                    <p>${reportDetails}</p> 
                    <hr style="border-top: 1px solid #eee; margin: 20px 0;"> 
                    <p style="text-align: center; font-size: 0.9em; color: #777;">ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø¨ÙˆØ§Ø³Ø·Ø© Wizz.ink ÙÙŠ ${new Date().toLocaleString('ar-MA')}</p> 
                    <p style="text-align: center; font-size: 0.9em; color: #777;">Ù‡Ø°Ø§ Ø§Ù„ØªÙ‚Ø±ÙŠØ± ØºÙŠØ± Ù‚Ø§Ø¨Ù„ Ù„Ù„ØªØ¹Ø¯ÙŠÙ„.</p> 
                </div> 
            `; 
 
            const element = document.createElement('div'); 
            element.innerHTML = reportContent; 
 
            // Ø­Ù…Ø§ÙŠØ© Ù…Ù„Ù PDF Ø¨ÙƒÙ„Ù…Ø© Ù…Ø±ÙˆØ± (Ø±Ù‚Ù… Ø§Ù„Ø³Ø¬Ù„ Ø§Ù„ØªØ¬Ø§Ø±ÙŠ) 
            const password = this.appData.workSettings.pdfPassword; // Ø§Ø³ØªØ®Ø¯Ø§Ù… ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ù…Ù† Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª 
            html2pdf().from(element).set({ 
                margin: 10, 
                filename: `Wizz_Monthly_Report_${employee.full_name}_${currentYear}_${currentMonth + 1}.pdf`, 
                image: {type: 'jpeg', quality: 0.98}, 
                html2canvas: {scale: 2}, 
                jsPDF: {unit: 'mm', format: 'a4', orientation: 'portrait'}, 
                // Ù‡Ù†Ø§ ÙŠÙ…ÙƒÙ† Ø¥Ø¶Ø§ÙØ© ØªØ´ÙÙŠØ± PDF ÙˆÙ„ÙƒÙ† html2pdf Ù„Ø§ ÙŠØ¯Ø¹Ù…Ù‡Ø§ Ø¨Ø´ÙƒÙ„ Ù…Ø¨Ø§Ø´Ø± 
                // ÙŠØªØ·Ù„Ø¨ Ù…ÙƒØªØ¨Ø© PDF Ø£Ø®Ø±Ù‰ Ù…Ø«Ù„ jsPDF-autotable Ù…Ø¹ jsPDF Ù„Ø¥Ù†Ø´Ø§Ø¡ Ù…Ù„ÙØ§Øª PDF Ù…Ø­Ù…ÙŠØ© Ø¨ÙƒÙ„Ù…Ø© Ù…Ø±ÙˆØ±. 
                // for this example, we simulate password protection by mentioning it in alert 
            }).save().then(() => { 
                alert(`âœ… ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ ØªÙ‚Ø±ÙŠØ± PDF. ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ù‡ÙŠ (Ø±Ù‚Ù… Ø§Ù„Ø³Ø¬Ù„ Ø§Ù„ØªØ¬Ø§Ø±ÙŠ): ${password}`); 
                this.addSovereigntyLogEntry('PDF Report Generated', `ØªÙ… ØªÙˆÙ„ÙŠØ¯ ØªÙ‚Ø±ÙŠØ± Ø´Ù‡Ø±ÙŠ Ù„Ù„Ù…ÙˆØ¸Ù ${employee.full_name}.`); 
            }); 
        } 
 
        // New: Submit Objection Request 
        async submitObjectionRequest() { 
            if (!this.currentEmployee) { 
                alert('Ø§Ù„Ø±Ø¬Ø§Ø¡ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ù„ØªÙ‚Ø¯ÙŠÙ… Ø·Ù„Ø¨ Ø§Ø¹ØªØ±Ø§Ø¶.'); 
                return; 
            } 
 
            const objectionDate = document.getElementById('objectionDate').value; 
            const objectionTime = document.getElementById('objectionTime').value; 
            const objectionReason = document.getElementById('objectionReason').value.trim(); 
 
            if (!objectionDate || !objectionTime || !objectionReason) { 
                document.getElementById('objectionMessage').textContent = 'Ø§Ù„Ø±Ø¬Ø§Ø¡ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„.'; 
                return; 
            } 
 
            const objectionTimestamp = new Date(`${objectionDate}T${objectionTime}`).toISOString(); 
 
            const newObjection = { 
                id: `obj_${Date.now()}`, 
                employeeId: this.currentEmployee.id, 
                employeeName: this.currentEmployee.full_name, 
                timestamp: new Date().toISOString(), 
                objectionDate: objectionDate, 
                objectionTime: objectionTime, 
                objectionTimestamp: objectionTimestamp, 
                reason: objectionReason, 
                status: 'Pending' 
            }; 
 
            this.appData.objectionRequests.push(newObjection); 
            await this.saveData(); 
            this.sendManagerNotification(`ğŸ“ Ø·Ù„Ø¨ Ø§Ø¹ØªØ±Ø§Ø¶ Ø¬Ø¯ÙŠØ¯ Ù…Ù† Ø§Ù„Ù…ÙˆØ¸Ù ${this.currentEmployee.full_name} Ø¨Ø®ØµÙˆØµ ${objectionDate} ${objectionTime}. Ø§Ù„Ø³Ø¨Ø¨: ${objectionReason}`, 'OBJECTION_REQUEST'); 
            this.addSovereigntyLogEntry('Objection Request', `Ø§Ù„Ù…ÙˆØ¸Ù ${this.currentEmployee.full_name} Ù‚Ø¯Ù… Ø·Ù„Ø¨ Ø§Ø¹ØªØ±Ø§Ø¶.`); 
 
            document.getElementById('objectionMessage').textContent = 'âœ… ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø·Ù„Ø¨ Ø§Ù„Ø§Ø¹ØªØ±Ø§Ø¶ Ø¨Ù†Ø¬Ø§Ø­. Ø³ÙŠØªÙ… Ù…Ø±Ø§Ø¬Ø¹ØªÙ‡ Ù…Ù† Ù‚Ø¨Ù„ Ø§Ù„Ù…Ø¯ÙŠØ±.'; 
            setTimeout(() => { 
                this.hideObjectionModal(); 
                document.getElementById('objectionMessage').textContent = ''; 
            }, 3000); 
        } 
 
        // New: Display objection requests for manager 
        async updateObjectionRequestsDisplay() { 
            const container = document.getElementById('objectionRequestsDisplay'); 
            if (container) { 
                if (this.appData.objectionRequests.length === 0) { 
                    container.innerHTML = '<p class="text-white/70 text-center">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª Ø§Ø¹ØªØ±Ø§Ø¶ Ø­Ø§Ù„ÙŠØ§Ù‹.</p>'; 
                } else { 
                    let html = ''; 
                    for (const req of this.appData.objectionRequests) { 
                        html += ` 
                            <div class="glass p-4 rounded-2xl mb-2 flex justify-between items-center ${req.status === 'Pending' ? 'bg-yellow-500/20' : (req.status === 'Approved' ? 'bg-green-500/20' : 'bg-red-500/20')}"> 
                                <div> 
                                    <p class="font-bold text-white">${req.employeeName} - ${req.objectionDate} ${req.objectionTime}</p> 
                                    <p class="text-white/70 text-sm">Ø§Ù„Ø³Ø¨Ø¨: ${req.reason}</p> 
                                    <p class="text-white/70 text-xs">Ø§Ù„Ø­Ø§Ù„Ø©: ${req.status}</p> 
                                </div> 
                                ${req.status === 'Pending' ? ` 
                                <div> 
                                    <button onclick="wizzApp.approveObjection('${req.id}')" class="bg-green-500 hover:bg-green-600 text-white px-3 py-1 rounded-2xl text-sm ml-2">Ù…ÙˆØ§ÙÙ‚Ø©</button> 
                                    <button onclick="wizzApp.rejectObjection('${req.id}')" class="bg-red-500 hover:bg-red-600 text-white px-3 py-1 rounded-2xl text-sm">Ø±ÙØ¶</button> 
                                </div> 
                                ` : ''} 
                            </div> 
                        `; 
                    } 
                    container.innerHTML = html; 
                } 
            } 
        } 
 
        // New: Approve objection 
        async approveObjection(objectionId) { 
            if (!await this.authenticateAdminAction('Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø© Ø¹Ù„Ù‰ Ø·Ù„Ø¨ Ø§Ø¹ØªØ±Ø§Ø¶')) return; 
 
            const objectionIndex = this.appData.objectionRequests.findIndex(req => req.id === objectionId); 
            if (objectionIndex !== -1) { 
                this.appData.objectionRequests[objectionIndex].status = 'Approved'; 
                // Here, you might want to add logic to actually adjust attendance records 
                // For now, it just changes the status. 
                await this.saveData(); 
                alert('âœ… ØªÙ… Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø© Ø¹Ù„Ù‰ Ø·Ù„Ø¨ Ø§Ù„Ø§Ø¹ØªØ±Ø§Ø¶ Ø¨Ù†Ø¬Ø§Ø­.'); 
                this.sendManagerNotification(`âœ… ØªÙ… Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø© Ø¹Ù„Ù‰ Ø·Ù„Ø¨ Ø§Ù„Ø§Ø¹ØªØ±Ø§Ø¶ Ù„Ù„Ù…ÙˆØ¸Ù ${this.appData.objectionRequests[objectionIndex].employeeName}.`, 'MANAGER_ALERT'); 
                this.addSovereigntyLogEntry('Objection Approved', `ØªÙ…Øª Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø© Ø¹Ù„Ù‰ Ø·Ù„Ø¨ Ø§Ø¹ØªØ±Ø§Ø¶ Ù„Ù„Ù…ÙˆØ¸Ù ${this.appData.objectionRequests[objectionIndex].employeeName}.`); 
                this.updateObjectionRequestsDisplay(); 
            } 
        } 
 
        // New: Reject objection 
        async rejectObjection(objectionId) { 
            if (!await this.authenticateAdminAction('Ø±ÙØ¶ Ø·Ù„Ø¨ Ø§Ø¹ØªØ±Ø§Ø¶')) return; 
 
            const objectionIndex = this.appData.objectionRequests.findIndex(req => req.id === objectionId); 
            if (objectionIndex !== -1) { 
                this.appData.objectionRequests[objectionIndex].status = 'Rejected'; 
                await this.saveData(); 
                alert('âŒ ØªÙ… Ø±ÙØ¶ Ø·Ù„Ø¨ Ø§Ù„Ø§Ø¹ØªØ±Ø§Ø¶.'); 
                this.sendManagerNotification(`âŒ ØªÙ… Ø±ÙØ¶ Ø·Ù„Ø¨ Ø§Ù„Ø§Ø¹ØªØ±Ø§Ø¶ Ù„Ù„Ù…ÙˆØ¸Ù ${this.appData.objectionRequests[objectionIndex].employeeName}.`, 'MANAGER_ALERT'); 
                this.addSovereigntyLogEntry('Objection Rejected', `ØªÙ… Ø±ÙØ¶ Ø·Ù„Ø¨ Ø§Ø¹ØªØ±Ø§Ø¶ Ù„Ù„Ù…ÙˆØ¸Ù ${this.appData.objectionRequests[objectionIndex].employeeName}.`); 
                this.updateObjectionRequestsDisplay(); 
            } 
        } 
 
        // New: Render Heat Map 
        async renderHeatMap() { 
            const mapContainer = document.getElementById('employeeMap'); 
            if (!mapContainer) return; 
 
            if (this.employeeMap) { 
                this.employeeMap.remove(); // Destroy existing map instance 
                this.employeeMap = null; 
            } 
 
            this.employeeMap = L.map('employeeMap').setView([this.appData.workSettings.companyGPS.lat, this.appData.workSettings.companyGPS.lng], 13); 
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', { 
                attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors' 
            }).addTo(this.employeeMap); 
 
            L.circle([this.appData.workSettings.companyGPS.lat, this.appData.workSettings.companyGPS.lng], { 
                color: 'blue', 
                fillColor: '#0052FF', 
                fillOpacity: 0.2, 
                radius: this.appData.workSettings.companyGPS.radius 
            }).addTo(this.employeeMap).bindPopup("Ù…Ù‚Ø± Ø§Ù„Ø´Ø±ÙƒØ© (Ù†Ø·Ø§Ù‚ Geo-Fencing)"); 
 
            const allArchiveRecords = await this.getAllIndexedDBRecords('attendanceArchive'); 
            const relevantRecords = allArchiveRecords.filter(record => 
                record.gps && typeof record.gps.latitude === 'number' && typeof record.gps.longitude === 'number' && record.status !== 'failed_location' 
            ); 
 
            const heatmapData = relevantRecords.map(record => { 
                return [record.gps.latitude, record.gps.longitude, 0.5]; // lat, lng, intensity 
            }); 
 
            if (this.heatmapLayer) { 
                this.employeeMap.removeLayer(this.heatmapLayer); 
            } 
 
            const heat = L.heatmapOverlay({ 
                "radius": 25, 
                "maxOpacity": 0.8, 
                "scaleRadius": true, 
                "useLocalExtrema": true, 
                latField: '0', 
                lngField: '1', 
                valueField: '2' 
            }); 
            heat.setData(heatmapData); 
            this.employeeMap.addLayer(heat); 
            this.heatmapLayer = heat; 
        } 
 
        // New: Store Layout Management 
        renderStoreLayoutEditor() { 
            const canvas = document.getElementById('storeLayoutCanvas'); 
            canvas.innerHTML = ''; // Clear existing layout 
 
            this.appData.employees.forEach(employee => { // Ø¥Ø¶Ø§ÙØ© ÙƒÙ„ Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ† Ø§Ù„Ù…ØªØ§Ø­ÙŠÙ† 
                const icon = document.createElement('div'); 
                icon.className = 'draggable-employee'; 
                icon.textContent = employee.short_ext; 
                icon.dataset.employeeId = employee.id; 
                icon.dataset.employeeName = employee.full_name; 
                icon.dataset.employeeExt = employee.short_ext; 
                icon.dataset.employeePhone = employee.phone_encrypted; 
                 
                // ØªØ­Ø¯ÙŠØ¯ Ù…ÙˆÙ‚Ø¹ Ù…Ø¨Ø¯Ø¦ÙŠ Ø¥Ø°Ø§ Ù„Ù… ÙŠÙƒÙ† Ù…ÙˆØ¬ÙˆØ¯Ø§Ù‹ ÙÙŠ Ø§Ù„ØªØ®Ø·ÙŠØ· 
                const existingLayout = this.appData.storeLayout.find(l => l.employeeId === employee.id); 
                if (existingLayout) { 
                    icon.style.left = `${existingLayout.x}px`; 
                    icon.style.top = `${existingLayout.y}px`; 
                } else { 
                    icon.style.left = `${Math.random() * (canvas.offsetWidth - 40)}px`; 
                    icon.style.top = `${Math.random() * (canvas.offsetHeight - 40)}px`; 
                } 
 
                icon.onmousedown = (e) => this.dragStart(e, icon); 
                icon.ontouchstart = (e) => this.dragStart(e, icon); 
                icon.onclick = (e) => { 
                    e.stopPropagation(); 
                    this.showCallMenu(e, employee.full_name, employee.short_ext, employee.id, employee.phone_encrypted); 
                }; 
                canvas.appendChild(icon); 
            }); 
 
            const select = document.getElementById('employeeToPlaceSelect'); 
            select.innerHTML = '<option value="">Ø§Ø®ØªØ± Ù…ÙˆØ¸Ù Ù„ÙˆØ¶Ø¹Ù‡</option>'; 
            this.appData.employees.forEach(emp => { 
                if (!this.appData.storeLayout.some(layoutEmp => layoutEmp.employeeId === emp.id)) { 
                    const option = document.createElement('option'); 
                    option.value = emp.id; 
                    option.textContent = `${emp.full_name} (${emp.short_ext})`; 
                    select.appendChild(option); 
                } 
            }); 
        } 
 
        dragStart(e, element) { 
            this.draggedEmployee = element; 
            let startX = e.clientX || e.touches[0].clientX; 
            let startY = e.clientY || e.touches[0].clientY; 
            let offsetX = startX - element.getBoundingClientRect().left; 
            let offsetY = startY - element.getBoundingClientRect().top; 
 
            const onMouseMove = (e) => { 
                const currentX = e.clientX || e.touches[0].clientX; 
                const currentY = e.clientY || e.touches[0].clientY; 
                let newX = currentX - offsetX; 
                let newY = currentY - offsetY; 
 
                const canvas = document.getElementById('storeLayoutCanvas'); 
                const canvasRect = canvas.getBoundingClientRect(); 
 
                newX = Math.max(0, Math.min(newX, canvasRect.width - element.offsetWidth)); 
                newY = Math.max(0, Math.min(newY, canvasRect.height - element.offsetHeight)); 
 
                element.style.left = `${newX}px`; 
                element.style.top = `${newY}px`; 
            }; 
 
            const onMouseUp = () => { 
                document.removeEventListener('mousemove', onMouseMove); 
                document.removeEventListener('mouseup', onMouseUp); 
                document.removeEventListener('touchmove', onMouseMove); 
                document.removeEventListener('touchend', onMouseUp); 
                this.draggedEmployee = null; 
                this.saveStoreLayout(); 
            }; 
 
            document.addEventListener('mousemove', onMouseMove); 
            document.addEventListener('mouseup', onMouseUp); 
            document.addEventListener('touchmove', onMouseMove); 
            document.addEventListener('touchend', onMouseUp); 
        } 
 
        addEmployeeToLayout() { 
            const select = document.getElementById('employeeToPlaceSelect'); 
            const employeeId = select.value; 
            if (employeeId) { 
                const employee = this.appData.employees.find(emp => emp.id === employeeId); 
                if (employee) { 
                    const canvas = document.getElementById('storeLayoutCanvas'); 
                    const canvasRect = canvas.getBoundingClientRect(); 
                    const initialX = Math.random() * (canvasRect.width - 40); 
                    const initialY = Math.random() * (canvasRect.height - 40); 
 
                    this.appData.storeLayout.push({ 
                        employeeId: employee.id, 
                        x: initialX, 
                        y: initialY 
                    }); 
                    this.saveStoreLayout(); 
                    this.renderStoreLayoutEditor(); 
                    this.addSovereigntyLogEntry('Store Layout Update', `ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…ÙˆØ¸Ù ${employee.full_name} Ø¥Ù„Ù‰ ØªØ®Ø·ÙŠØ· Ø§Ù„Ù…ØªØ¬Ø±.`); 
                } 
            } else { 
                alert('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ø®ØªÙŠØ§Ø± Ù…ÙˆØ¸Ù Ø£ÙˆÙ„Ø§Ù‹.'); 
            } 
        } 
 
        saveStoreLayout() { 
            const canvas = document.getElementById('storeLayoutCanvas'); 
            const employeeIcons = canvas.querySelectorAll('.draggable-employee'); 
            this.appData.storeLayout = Array.from(employeeIcons).map(icon => ({ 
                employeeId: icon.dataset.employeeId, 
                x: parseFloat(icon.style.left), 
                y: parseFloat(icon.style.top) 
            })); 
            this.saveData(true); 
            this.addSovereigntyLogEntry('Store Layout Update', `ØªÙ… Ø­ÙØ¸ ØªØ®Ø·ÙŠØ· Ø§Ù„Ù…ØªØ¬Ø±.`); 
            alert('âœ… ØªÙ… Ø­ÙØ¸ ØªØ®Ø·ÙŠØ· Ø§Ù„Ù…ØªØ¬Ø± Ø¨Ù†Ø¬Ø§Ø­.'); 
        } 
 
        clearStoreLayout() { 
            if (confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ù…Ø³Ø­ ØªØ®Ø·ÙŠØ· Ø§Ù„Ù…ØªØ¬Ø± Ø¨Ø§Ù„ÙƒØ§Ù…Ù„ØŸ')) { 
                this.appData.storeLayout = []; 
                this.saveData(); 
                this.renderStoreLayoutEditor(); 
                this.addSovereigntyLogEntry('Store Layout Update', `ØªÙ… Ù…Ø³Ø­ ØªØ®Ø·ÙŠØ· Ø§Ù„Ù…ØªØ¬Ø±.`); 
                alert('âœ… ØªÙ… Ù…Ø³Ø­ ØªØ®Ø·ÙŠØ· Ø§Ù„Ù…ØªØ¬Ø±.'); 
            } 
        } 
 
        // New: Customer Feedback 
        showCustomerFeedbackModal() { 
            document.getElementById('customerFeedbackModal').classList.remove('hidden'); 
            document.getElementById('customerFeedbackPhone').value = ''; 
            document.getElementById('customerFeedbackText').value = ''; 
            document.getElementById('customerFeedbackMessage').textContent = ''; 
        } 
 
        hideCustomerFeedbackModal() { 
            document.getElementById('customerFeedbackModal').classList.add('hidden'); 
        } 
 
        async submitCustomerFeedback() { 
            const phone = document.getElementById('customerFeedbackPhone').value.trim(); 
            const feedbackText = document.getElementById('customerFeedbackText').value.trim(); 
 
            if (!feedbackText) { 
                document.getElementById('customerFeedbackMessage').textContent = 'Ø§Ù„Ø±Ø¬Ø§Ø¡ ÙƒØªØ§Ø¨Ø© Ø±Ø£ÙŠÙƒ Ø£Ùˆ Ø´ÙƒÙˆØ§Ùƒ.'; 
                document.getElementById('customerFeedbackMessage').classList.add('text-red-400'); 
                return; 
            } 
 
            const newFeedback = { 
                id: `fb_${Date.now()}`, 
                phone: phone, 
                feedback: feedbackText, 
                timestamp: new Date().toISOString() 
            }; 
 
            this.appData.customerFeedback.push(newFeedback); 
            await this.saveData(); 
 
            this.sendManagerNotification(`ğŸ’¬ Ø±Ø£ÙŠ Ø²Ø¨ÙˆÙ† Ø¬Ø¯ÙŠØ¯ (Ø§Ù„Ù‡Ø§ØªÙ: ${phone || 'ØºÙŠØ± Ù…Ø¹Ù„ÙˆÙ…'}): "${feedbackText.substring(0, 50)}..."`, 'CUSTOMER_FEEDBACK'); 
 
            document.getElementById('customerFeedbackMessage').textContent = 'âœ… ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø±Ø£ÙŠÙƒ Ø¨Ù†Ø¬Ø§Ø­. Ø´ÙƒØ±Ø§Ù‹ Ù„Ùƒ!'; 
            document.getElementById('customerFeedbackMessage').classList.remove('text-red-400'); 
            document.getElementById('customerFeedbackMessage').classList.add('text-green-400'); 
 
            setTimeout(() => { 
                this.hideCustomerFeedbackModal(); 
            }, 3000); 
        } 
 
        updateCustomerFeedbackDisplay() { 
            const container = document.getElementById('customerFeedbackDisplay'); 
            if (container) { 
                if (this.appData.customerFeedback.length === 0) { 
                    container.innerHTML = '<p class="text-white/70 text-center">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¢Ø±Ø§Ø¡ Ù„Ù„Ø²Ø¨Ø§Ø¦Ù† Ø­Ø§Ù„ÙŠØ§Ù‹.</p>'; 
                } else { 
                    container.innerHTML = this.appData.customerFeedback.map(fb => ` 
                            <div class="glass p-4 rounded-2xl mb-2 flex justify-between items-center bg-purple-500/20"> 
                                <div> 
                                    <p class="font-bold text-white">${fb.feedback.substring(0, 70)}...</p> 
                                    <p class="text-white/70 text-sm">Ø§Ù„Ù‡Ø§ØªÙ: ${fb.phone || 'ØºÙŠØ± Ù…Ø¹Ù„ÙˆÙ…'} | ÙÙŠ: ${new Date(fb.timestamp).toLocaleString('ar-MA')}</p> 
                                </div> 
                            </div> 
                        `).join(''); 
                } 
            } 
        } 
 
        clearCustomerFeedback() { 
            if (confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø¢Ø±Ø§Ø¡ Ø§Ù„Ø²Ø¨Ø§Ø¦Ù†ØŸ Ù‡Ø°Ø§ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ØªØ±Ø§Ø¬Ø¹ Ø¹Ù†Ù‡.')) { 
                this.appData.customerFeedback = []; 
                this.saveData(); 
                this.updateCustomerFeedbackDisplay(); 
                alert('âœ… ØªÙ… Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø¢Ø±Ø§Ø¡ Ø§Ù„Ø²Ø¨Ø§Ø¦Ù†.'); 
            } 
        } 
 
        // New: Smart Calculator 
        calculatorInput(value) { 
            const calcInputEl = document.getElementById('calculatorInput'); 
            if (value === 'C') { 
                this.calcInput = ''; 
            } else if (value === 'ØªÙ†ÙÙŠØ°') { 
                this.performInventoryAction(); 
                return; 
            } else { 
                this.calcInput += value; 
            } 
            calcInputEl.value = this.calcInput; 
            try { 
                const sanitizedInput = this.calcInput.replace(/[^-()\d/*+.]/g, ''); 
                if (sanitizedInput) { 
                    const result = eval(sanitizedInput); // Using eval for simplicity, needs safer parsing for production 
                    document.getElementById('calculatorResult').textContent = `Ø§Ù„Ù†ØªÙŠØ¬Ø©: ${result}`; 
                } else { 
                    document.getElementById('calculatorResult').textContent = 'Ø§Ù„Ù†ØªÙŠØ¬Ø©: 0'; 
                } 
            } catch (e) { 
                document.getElementById('calculatorResult').textContent = 'Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø¹Ù…Ù„ÙŠØ©'; 
            } 
        } 
 
        clearCalculator() { 
            this.calcInput = ''; 
            document.getElementById('calculatorInput').value = ''; 
            document.getElementById('calculatorResult').textContent = 'Ø§Ù„Ù†ØªÙŠØ¬Ø©: 0'; 
        } 
 
        performInventoryAction() { 
            const calcInputEl = document.getElementById('calculatorInput'); 
            const command = calcInputEl.value.trim(); 
            const inventoryResultEl = document.getElementById('calculatorResult'); 
 
            const sellRegex = /(?:Ø¨ÙŠØ¹|Ø®ØµÙ…|Ù†Ù‚Øµ)\s*(\d+)\s*(?:Ù…Ù†|Ù„Ù€|Ø¹Ù†)?\s*(.+)/i; 
            const addRegex = /(?:Ø¥Ø¶Ø§ÙØ©|Ø²ÙŠØ§Ø¯Ø©|Ø²Ø¯)\s*(\d+)\s*(?:Ø¥Ù„Ù‰|Ù„Ù€)?\s*(.+)/i; 
 
            let match; 
            if ((match = command.match(sellRegex))) { 
                const quantity = parseInt(match[1]); 
                const itemName = match[2].trim(); 
                this.updateInventory(itemName, -quantity); 
                inventoryResultEl.textContent = `ØªÙ… Ø¨ÙŠØ¹ ${quantity} Ù…Ù† ${itemName}.`; 
                this.addSovereigntyLogEntry('Inventory Update', `ØªÙ… Ø¨ÙŠØ¹ ${quantity} Ù…Ù† Ø§Ù„Ù…Ù†ØªØ¬ ${itemName}.`); 
            } else if ((match = command.match(addRegex))) { 
                const quantity = parseInt(match[1]); 
                const itemName = match[2].trim(); 
                this.updateInventory(itemName, quantity); 
                inventoryResultEl.textContent = `ØªÙ… Ø¥Ø¶Ø§ÙØ© ${quantity} Ø¥Ù„Ù‰ ${itemName}.`; 
                this.addSovereigntyLogEntry('Inventory Update', `ØªÙ… Ø¥Ø¶Ø§ÙØ© ${quantity} Ø¥Ù„Ù‰ Ø§Ù„Ù…Ù†ØªØ¬ ${itemName}.`); 
            } else { 
                inventoryResultEl.textContent = 'Ø¹Ù…Ù„ÙŠØ© Ø¬Ø±Ø¯ ØºÙŠØ± Ù…ÙÙ‡ÙˆÙ…Ø©.'; 
            } 
            this.calcInput = ''; 
            calcInputEl.value = ''; 
        } 
 
        updateInventory(itemName, change) { 
            const item = this.appData.inventory.find(inv => inv.name.toLowerCase() === itemName.toLowerCase()); 
            if (item) { 
                item.quantity += change; 
                if (item.quantity < 0) item.quantity = 0; // Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø£Ù† ØªÙƒÙˆÙ† Ø§Ù„ÙƒÙ…ÙŠØ© Ø³Ø§Ù„Ø¨Ø© 
                this.saveData(); 
                this.renderInventoryDisplay(); 
 
                // ğŸš¨ ØªÙ†Ø¨ÙŠÙ‡ Ù†Ù‚Øµ Ø§Ù„Ø³ÙŠÙˆÙ„Ø©/Ø§Ù„Ù…Ø®Ø²ÙˆÙ† 
                if (item.quantity <= 5) { // Ø¹ØªØ¨Ø© Ø§Ù„Ù†Ù‚Øµ ÙŠÙ…ÙƒÙ† ØªØ¹Ø¯ÙŠÙ„Ù‡Ø§ 
                    this.sendManagerNotification(`ğŸš¨ Ø®Ø·Ø± Ù…Ø§Ù„ÙŠ: Ø§Ù„Ù…Ø®Ø²ÙˆÙ† Ù…Ù† ${item.name} Ù…Ù†Ø®ÙØ¶ Ø¬Ø¯Ø§Ù‹ (${item.quantity}).`, 'FINANCIAL_RISK'); 
                    // Ø¹Ø±Ø¶ ØªÙ†Ø¨ÙŠÙ‡ Ù…Ø±Ø¦ÙŠ Ù„Ù„Ù…Ø¯ÙŠØ± (Ù…Ø«Ø§Ù„: ÙˆÙ…ÙŠØ¶ Ø£Ø­Ù…Ø±) 
                    const notificationDiv = document.createElement('div'); 
                    notificationDiv.className = 'fixed top-4 right-4 bg-red-600 text-white p-3 rounded-lg shadow-lg animate-pulse z-50'; 
                    notificationDiv.textContent = `ğŸš¨ Ù†Ù‚Øµ Ø­Ø§Ø¯ ÙÙŠ Ù…Ø®Ø²ÙˆÙ† ${item.name}!`; 
                    document.body.appendChild(notificationDiv); 
                    setTimeout(() => notificationDiv.remove(), 5000); 
                } 
            } else { 
                alert(`Ø§Ù„Ù…Ù†ØªØ¬ "${itemName}" ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯ ÙÙŠ Ø§Ù„Ù…Ø®Ø²ÙˆÙ†.`); 
            } 
        } 
 
        renderInventoryDisplay() { 
            const container = document.getElementById('inventoryDisplay'); 
            container.innerHTML = ''; 
            if (this.appData.inventory.length === 0) { 
                container.innerHTML = '<p class="text-white/70 text-center">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù†ØªØ¬Ø§Øª ÙÙŠ Ø§Ù„Ù…Ø®Ø²ÙˆÙ† Ø­Ø§Ù„ÙŠØ§Ù‹.</p>'; 
                return; 
            } 
            this.appData.inventory.forEach(item => { 
                const div = document.createElement('div'); 
                div.className = 'flex justify-between p-2 bg-white/10 rounded-md'; 
                div.innerHTML = ` 
                        <span class="text-white">${item.name}</span> 
                        <span class="text-white">${item.quantity}</span> 
                    `; 
                container.appendChild(div); 
            }); 
        } 
 
        addInventoryItem() { 
            const nameInput = document.getElementById('newInventoryItem'); 
            const quantityInput = document.getElementById('newInventoryQuantity'); 
            const name = nameInput.value.trim(); 
            const quantity = parseInt(quantityInput.value); 
 
            if (!name || isNaN(quantity) || quantity < 0) { 
                alert('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù… ÙˆÙƒÙ…ÙŠØ© ØµØ­ÙŠØ­Ø© Ù„Ù„Ù…Ù†ØªØ¬.'); 
                return; 
            } 
 
            const existingItem = this.appData.inventory.find(item => item.name.toLowerCase() === name.toLowerCase()); 
            if (existingItem) { 
                existingItem.quantity += quantity; 
            } else { 
                this.appData.inventory.push({id: `inv_${Date.now()}`, name: name, quantity: quantity}); 
            } 
            this.saveData(); 
            this.renderInventoryDisplay(); 
            nameInput.value = ''; 
            quantityInput.value = '0'; 
            this.addSovereigntyLogEntry('Inventory Update', `ØªÙ… Ø¥Ø¶Ø§ÙØ©/ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ù†ØªØ¬ ${name} ÙÙŠ Ø§Ù„Ù…Ø®Ø²ÙˆÙ†.`); 
        } 
 
        // New: Dignity Break Logic 
        showDignityBreakModal() { 
            document.getElementById('dignityBreakModal').classList.remove('hidden'); 
        } 
 
        hideDignityBreakModal() { 
            document.getElementById('dignityBreakModal').classList.add('hidden'); 
        } 
 
        // New: Walkie-Talkie Functionality 
        async startEmployeeWalkieTalkie() { 
            if (!this.currentEmployee) return; 
            alert('Ø§Ø¶ØºØ· Ø¨Ø§Ø³ØªÙ…Ø±Ø§Ø± Ù„Ù„ØªØ­Ø¯Ø« ÙÙŠ Ø§Ù„Ù„Ø§Ø³Ù„ÙƒÙŠ.'); 
            // For a real walkie-talkie, this would open a PTT stream 
            // For now, it's a simulated "talk" experience. 
            document.getElementById('walkieTalkieModal').classList.remove('hidden'); 
            document.getElementById('walkieTalkieStatus').textContent = 'Ø£Ù†Øª ØªØªØ­Ø¯Ø«...'; 
            // In a real scenario, this would initiate a connection to receive admin broadcast 
        } 
 
        stopEmployeeWalkieTalkie() { 
            if (!this.currentEmployee) return; 
            // For a real walkie-talkie, this would close the PTT stream 
            document.getElementById('walkieTalkieStatus').textContent = 'Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø§Ø³ØªÙ…Ø§Ø¹...'; 
            // In a real scenario, this would close the connection to receive admin broadcast 
        } 
 
        async startAdminWalkieTalkie() { 
            const adminStartRecordingBtn = document.getElementById('adminStartRecordingBtn'); 
            const adminWalkieTalkieStatus = document.getElementById('adminWalkieTalkieStatus'); 
            const adminWalkieTalkieTranscription = document.getElementById('adminWalkieTalkieTranscription'); 
 
            adminStartRecordingBtn.classList.add('recording-pulse'); 
            adminWalkieTalkieStatus.textContent = 'Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ³Ø¬ÙŠÙ„...'; 
            adminWalkieTalkieTranscription.innerHTML = '<p>Ø¬Ø§Ø±ÙŠ ØªØ­ÙˆÙŠÙ„ Ø§Ù„ØµÙˆØª Ø¥Ù„Ù‰ Ù†Øµ...</p>'; 
 
            try { 
                const stream = await navigator.mediaDevices.getUserMedia({audio: true}); 
                this.adminWalkieTalkieStream = stream; 
                this.adminWalkieTalkieRecorder = new MediaRecorder(stream); 
                const audioChunks = []; 
 
                this.adminWalkieTalkieRecorder.ondataavailable = event => { 
                    audioChunks.push(event.data); 
                }; 
 
                this.adminWalkieTalkieRecorder.onstop = async () => { 
                    const audioBlob = new Blob(audioChunks, {type: 'audio/webm'}); 
                    const audioUrl = URL.createObjectURL(audioBlob); 
 
                    // Simulate sending to all employees and showing acknowledgment 
                    // In a real app, this audio would be sent to all connected employee clients. 
                    this.receiveWalkieTalkieBroadcast(audioUrl); // Simulating local receive 
 
                    adminStartRecordingBtn.classList.remove('recording-pulse'); 
                    adminWalkieTalkieStatus.textContent = 'Ø§Ø¶ØºØ· Ù„Ù„ØªØ­Ø¯Ø«'; 
                    stream.getTracks().forEach(track => track.stop()); // Stop microphone 
 
                    // Perform STT 
                    if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) { 
                        const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition; 
                        this.speechRecognition = new SpeechRecognition(); 
                        this.speechRecognition.lang = 'ar-MA'; // Moroccan Arabic or just Arabic 
                        this.speechRecognition.interimResults = false; 
                        this.speechRecognition.maxAlternatives = 1; 
 
                        this.speechRecognition.onresult = (event) => { 
                            const transcript = event.results[0][0].transcript; 
                            adminWalkieTalkieTranscription.innerHTML = `<p>${transcript}</p>`; 
                            this.addSovereigntyLogEntry('Walkie-Talkie Broadcast', `Ø§Ù„Ù…Ø¯ÙŠØ± Ø£Ø±Ø³Ù„ Ø¨Ø«Ø§Ù‹ ØµÙˆØªÙŠØ§Ù‹: "${transcript.substring(0, 50)}..."`); 
                        }; 
                        this.speechRecognition.onerror = (event) => { 
                            adminWalkieTalkieTranscription.innerHTML = `<p style="color:red;">Ø®Ø·Ø£ ÙÙŠ ØªØ­ÙˆÙŠÙ„ Ø§Ù„ØµÙˆØª Ø¥Ù„Ù‰ Ù†Øµ: ${event.error}</p>`; 
                        }; 
                        this.speechRecognition.start(); 
                    } else { 
                        adminWalkieTalkieTranscription.innerHTML = `<p style="color:orange;">ØªØ­ÙˆÙŠÙ„ Ø§Ù„ØµÙˆØª Ù„Ù†Øµ ØºÙŠØ± Ù…Ø¯Ø¹ÙˆÙ… ÙÙŠ Ù…ØªØµÙØ­Ùƒ.</p>`; 
                        this.addSovereigntyLogEntry('Walkie-Talkie Broadcast', `Ø§Ù„Ù…Ø¯ÙŠØ± Ø£Ø±Ø³Ù„ Ø¨Ø«Ø§Ù‹ ØµÙˆØªÙŠØ§Ù‹ (STT ØºÙŠØ± Ù…Ø¯Ø¹ÙˆÙ…).`); 
                    } 
                }; 
 
                this.adminWalkieTalkieRecorder.start(); 
            } catch (err) { 
                console.error('ÙØ´Ù„ Ø§Ù„ÙˆØµÙˆÙ„ Ù„Ù„Ù…ÙŠÙƒØ±ÙˆÙÙˆÙ† Ù„Ø¨Ø« Ø§Ù„Ù„Ø§Ø³Ù„ÙƒÙŠ:', err); 
                adminWalkieTalkieStatus.textContent = 'ğŸš« ÙØ´Ù„ Ø§Ù„ÙˆØµÙˆÙ„ Ù„Ù„Ù…ÙŠÙƒØ±ÙˆÙÙˆÙ†.'; 
                adminStartRecordingBtn.classList.remove('recording-pulse'); 
            } 
        } 
 
        stopAdminWalkieTalkie() { 
            if (this.adminWalkieTalkieRecorder && this.adminWalkieTalkieRecorder.state === 'recording') { 
                this.adminWalkieTalkieRecorder.stop(); 
            } 
        } 
 
        receiveWalkieTalkieBroadcast(audioUrl, transcription) { 
            // This is a simulated broadcast for the current user (if logged in as employee) 
            // In a multi-user app, this would be triggered by an external message. 
            const walkieTalkieModal = document.getElementById('walkieTalkieModal'); 
            const walkieTalkieStatus = document.getElementById('walkieTalkieStatus'); 
            const walkieTalkieTranscriptionEl = document.getElementById('walkieTalkieTranscription'); 
            const walkieTalkieAcknowledgeBtn = document.getElementById('walkieTalkieAcknowledgeBtn'); 
 
            if (this.currentEmployee) { 
                walkieTalkieModal.classList.remove('hidden'); 
                walkieTalkieStatus.textContent = 'Ø±Ø³Ø§Ù„Ø© Ø¬Ø¯ÙŠØ¯Ø© Ù…Ù† Ø§Ù„Ù…Ø¯ÙŠØ±!'; 
                walkieTalkieTranscriptionEl.innerHTML = `<audio controls src="${audioUrl}"></audio><p>${transcription}</p>`; 
                walkieTalkieAcknowledgeBtn.classList.remove('hidden'); 
                this.addSovereigntyLogEntry('Walkie-Talkie Received', `Ø§Ù„Ù…ÙˆØ¸Ù ${this.currentEmployee.full_name} Ø§Ø³ØªÙ‚Ø¨Ù„ Ø¨Ø« Ù„Ø§Ø³Ù„ÙƒÙŠ.`); 
            } 
        } 
 
        acknowledgeWalkieTalkie() { 
            if (!this.currentEmployee) return; 
            this.addSovereigntyLogEntry('Walkie-Talkie Acknowledgment', `Ø§Ù„Ù…ÙˆØ¸Ù ${this.currentEmployee.full_name} Ø£Ù†ØµØª ÙˆØ£Ø¯Ø±Ùƒ Ø§Ù„Ø£Ù…Ø± Ù…Ù† Ø¨Ø« Ø§Ù„Ù„Ø§Ø³Ù„ÙƒÙŠ.`); 
            this.hideWalkieTalkieModal(); 
            alert('âœ… ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ø³ØªØ¬Ø§Ø¨ØªÙƒ.'); 
        } 
 
        hideWalkieTalkieModal() { 
            document.getElementById('walkieTalkieModal').classList.add('hidden'); 
            document.getElementById('walkieTalkieAcknowledgeBtn').classList.add('hidden'); 
        } 
 
        hideAdminWalkieTalkieModal() { 
            document.getElementById('adminWalkieTalkieModal').classList.add('hidden'); 
        } 
 
        // New: Visual Commands Functionality 
        showAdminVisualCommandModal() { 
            document.getElementById('adminVisualCommandModal').classList.remove('hidden'); 
            document.getElementById('visualCommandRecipient').value = ''; 
            document.getElementById('visualCommandImageInput').value = ''; 
            document.getElementById('capturedVisualCommandPreview').src = ''; 
            document.getElementById('capturedVisualCommandPreview').classList.add('hidden'); 
            document.getElementById('sendVisualCommandFinalBtn').classList.add('hidden'); 
            document.getElementById('adminVisualCommandMessage').textContent = ''; 
            this.adminVisualCommandImage = null; // Reset captured image 
            this.populateVisualCommandRecipients(); 
        } 
 
        hideAdminVisualCommandModal() { 
            document.getElementById('adminVisualCommandModal').classList.add('hidden'); 
        } 
 
        populateVisualCommandRecipients() { 
            const select = document.getElementById('visualCommandRecipient'); 
            select.innerHTML = '<option value="">Ø§Ø®ØªØ± Ù…ÙˆØ¸Ù</option>'; 
            this.appData.employees.forEach(emp => { 
                const option = document.createElement('option'); 
                option.value = emp.id; 
                option.textContent = emp.full_name; 
                select.appendChild(option); 
            }); 
        } 
 
        previewVisualCommandImage(file) { 
            if (file) { 
                const reader = new FileReader(); 
                reader.onload = (e) => { 
                    this.adminVisualCommandImage = e.target.result; // Store Base64 image 
                    document.getElementById('capturedVisualCommandPreview').src = this.adminVisualCommandImage; 
                    document.getElementById('capturedVisualCommandPreview').classList.remove('hidden'); 
                    document.getElementById('sendVisualCommandFinalBtn').classList.remove('hidden'); 
                }; 
                reader.readAsDataURL(file); 
            } 
        } 
 
        async captureAdminVisualCommand() { 
            try { 
                const stream = await navigator.mediaDevices.getUserMedia({video: true}); 
                const video = document.createElement('video'); 
                video.srcObject = stream; 
                await video.play(); 
 
                const canvas = document.createElement('canvas'); 
                canvas.width = video.videoWidth; 
                canvas.height = video.videoHeight; 
                const context = canvas.getContext('2d'); 
                context.drawImage(video, 0, 0, canvas.width, canvas.height); 
 
                this.adminVisualCommandImage = canvas.toDataURL('image/jpeg'); 
                document.getElementById('capturedVisualCommandPreview').src = this.adminVisualCommandImage; 
                document.getElementById('capturedVisualCommandPreview').classList.remove('hidden'); 
                document.getElementById('sendVisualCommandFinalBtn').classList.remove('hidden'); 
 
                stream.getTracks().forEach(track => track.stop()); // Stop camera 
            } catch (err) { 
                document.getElementById('adminVisualCommandMessage').textContent = 'ğŸš« ÙØ´Ù„ Ø§Ù„ÙˆØµÙˆÙ„ Ù„Ù„ÙƒØ§Ù…ÙŠØ±Ø§: ' + err.message; 
                console.error('Camera access failed for visual command:', err); 
            } 
        } 
 
        async sendAdminVisualCommand() { 
            const recipientId = document.getElementById('visualCommandRecipient').value; 
            if (!recipientId || !this.adminVisualCommandImage) { 
                document.getElementById('adminVisualCommandMessage').textContent = 'Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ø®ØªÙŠØ§Ø± Ù…ÙˆØ¸Ù ÙˆØ§Ù„ØªÙ‚Ø§Ø·/Ø§Ø®ØªÙŠØ§Ø± ØµÙˆØ±Ø©.'; 
                return; 
            } 
 
            const recipientEmployee = this.appData.employees.find(emp => emp.id === recipientId); 
            if (!recipientEmployee) { 
                document.getElementById('adminVisualCommandMessage').textContent

