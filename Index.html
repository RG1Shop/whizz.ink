<!DOCTYPE html> 
<html lang="ar" dir="rtl"> 
<head> 
    <meta charset="UTF-8"> 
    <meta name="viewport" content="width=device-width, initial-scale=1.0"> 
    <title>Aladan AI - Ø§Ù„Ø¥ØµØ¯Ø§Ø± Ø§Ù„Ø£Ù‚ÙˆÙ‰</title> <link rel="preconnect" href="https://fonts.googleapis.com"> 
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin> 
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;500;600;700;900&display=swap" rel="stylesheet"> 
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css"> 
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/dracula.min.css"> 
    <style> 
        /* ========================================================================== 
           AGNES ULTRA 5.0 - Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„ÙØ§Ø¦Ù‚Ø© Ø§Ù„ØªÙŠ ØªÙ‡Ø²Ù… Gemini (2025 Ultimate Edition) 
           ========================================================================== */ 
 
        :root { 
            /* Neon P3 Color System - Default Cyan Theme */ 
            --neon-cyan: #00FFFF; 
            --neon-green: #00FF7F; 
            --neon-purple: #FF00FF; 
            --neon-blue: #7C3AED; 
            --neon-orange: #FF8C00; /* Added for more theme options */ 
 
            --text-primary: #E0E7FF; 
            --text-secondary: #A0B3C8; 
            --bg-primary: #0A111E; 
            --bg-secondary: #0D1B2A; 
            --bg-glass: rgba(13, 27, 42, 0.85); /* Slightly darker for better contrast */ 
            --border-glow: rgba(0, 255, 255, 0.4); /* Stronger glow */ 
 
            /* Dynamic Variables */ 
            --header-height: 80px; 
            --input-height: 90px; 
            --mobile-header-height: 70px; 
            --mobile-input-height: 80px; 
            --glow-intensity: 0; 
            --theme: 'cyan'; /* Current active theme */ 
        } 
 
        /* --- THEME OVERRIDES (Enhanced from Gemini's feature) --- */ 
        body.purple-theme { 
            --neon-cyan: #FF00FF;      /* Magenta */ 
            --neon-green: #FF69B4;     /* Pink */ 
            --border-glow: rgba(255, 0, 255, 0.4); 
        } 
        body.green-theme { 
            --neon-cyan: #00FF7F;      /* Bright Green */ 
            --neon-green: #32CD32;     /* Lime Green */ 
            --border-glow: rgba(0, 255, 127, 0.4); 
        } 
        body.orange-theme { 
            --neon-cyan: #FF8C00;      /* Dark Orange */ 
            --neon-green: #FFA500;     /* Orange */ 
            --border-glow: rgba(255, 140, 0, 0.4); 
        } 
        body.rainbow-theme { /* Dynamic Rainbow Animation */ 
            animation: rainbow 3s linear infinite; 
        } 
        @keyframes rainbow { 
            0%,100%{--neon-cyan:#FF0000; --neon-green:#FF8000; --border-glow:rgba(255,0,0,0.4);} 
            16%{--neon-cyan:#FF8000; --neon-green:#FFFF00; --border-glow:rgba(255,128,0,0.4);} 
            33%{--neon-cyan:#FFFF00; --neon-green:#00FF00; --border-glow:rgba(255,255,0,0.4);} 
            50%{--neon-cyan:#00FF00; --neon-green:#00FFFF; --border-glow:rgba(0,255,0,0.4);} 
            66%{--neon-cyan:#00FFFF; --neon-green:#0000FF; --border-glow:rgba(0,255,255,0.4);} 
            83%{--neon-cyan:#0000FF; --neon-green:#FF00FF; --border-glow:rgba(0,0,255,0.4);} 
        } 
 
 
        /* Reset & Base */ 
        * { margin: 0; padding: 0; box-sizing: border-box; } 
        html { scroll-behavior: smooth; font-feature-settings: 'liga' 1, 'clig' 1; } /* Enable Arabic ligatures for better rendering */ 
        body { 
            font-family: 'Cairo', system-ui, -apple-system, sans-serif; 
            background: var(--bg-primary); 
            color: var(--text-primary); 
            height: 100vh; 
            overflow: hidden; 
            direction: rtl; /* Right-to-Left for Arabic */ 
            position: relative; 
            /* Dynamic Neon Background Animation */ 
            background-image: 
                radial-gradient(circle at 20% 80%, rgba(120, 119, 198, 0.3) 0%, transparent 50%), 
                radial-gradient(circle at 80% 20%, rgba(255, 119, 198, 0.3) 0%, transparent 50%), 
                radial-gradient(circle at 40% 40%, rgba(120, 219, 255, 0.3) 0%, transparent 50%); 
            background-size: 200% 200%; 
            animation: bgShift 20s ease infinite; 
        } 
 
        @keyframes bgShift { 
            0%, 100% { background-position: 0% 50%; } 
            50% { background-position: 100% 50%; } 
        } 
 
        /* ========================================================================== 
           HEADER - Ø´Ø±ÙŠØ· Ø¹Ù„ÙˆÙŠ Ù…ØªØ·ÙˆØ± Ù…Ø¹ Glassmorphism (Agnes Original Perfection) 
           ========================================================================== */ 
        .header { 
            position: fixed; top: 0; left: 0; right: 0; height: var(--header-height); 
            background: var(--bg-glass); 
            backdrop-filter: blur(25px) saturate(180%); 
            border-bottom: 1px solid var(--border-glow); 
            z-index: 1000; 
            display: flex; align-items: center; justify-content: space-between; 
            padding: 0 32px; 
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1); 
        } 
 
        .app-name { display: flex; align-items: center; gap: 16px; } 
 
        .logo-gradient { 
            font-size: 28px; font-weight: 900; 
            background: linear-gradient(135deg, var(--neon-cyan) 0%, var(--neon-green) 50%, var(--neon-purple) 100%); 
            background-size: 200% 200%; 
            -webkit-background-clip: text; background-clip: text; -webkit-text-fill-color: transparent; 
            animation: logoShimmer 3s ease-in-out infinite; 
            text-shadow: 0 0 30px rgba(0, 255, 255, 0.6); 
        } 
 
        @keyframes logoShimmer { 
            0%, 100% { background-position: 0% 50%; } 
            50% { background-position: 100% 50%; } 
        } 
 
        .header-icon { 
            width: 48px; height: 48px; border-radius: 16px; 
            background: rgba(0, 255, 255, 0.08); border: 1px solid var(--border-glow); 
            display: flex; align-items: center; justify-content: center; 
            color: var(--text-secondary); cursor: pointer; 
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); 
            position: relative; overflow: hidden; 
        } 
 
        .header-icon::before { /* Shimmer effect on hover */ 
            content: ''; position: absolute; top: 0; left: -100%; width: 100%; height: 100%; 
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent); 
            transition: left 0.5s; 
        } 
 
        .header-icon:hover::before { left: 100%; } 
 
        .header-icon:hover { 
            background: rgba(0, 255, 255, 0.2); box-shadow: 0 0 25px rgba(0, 255, 255, 0.6); 
            transform: translateY(-2px) scale(1.05); color: var(--neon-cyan); 
        } 
 
        .header-icons { display: flex; gap: 16px; } 
 
        /* ========================================================================== 
           CHAT CONTAINER - Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø© Ø§Ù„Ù…ØªÙ‚Ø¯Ù…Ø© (Agnes Original Perfection) 
           ========================================================================== */ 
        .chat-container { 
            height: calc(100vh - var(--header-height) - var(--input-height)); 
            overflow-y: auto; 
            padding: calc(var(--header-height) + 40px) 32px 32px; 
            background: var(--bg-primary); 
            scrollbar-width: thin; scrollbar-color: var(--border-glow) transparent; 
        } 
 
        .chat-container::-webkit-scrollbar { width: 6px; } 
        .chat-container::-webkit-scrollbar-track { background: transparent; } 
        .chat-container::-webkit-scrollbar-thumb { background: var(--border-glow); border-radius: 3px; } 
 
        /* --- ULTIMATE WELCOME SCREEN (Agnes Original Perfection) --- */ 
        .welcome-container { 
            max-width: 600px; margin: 0 auto; text-align: center; 
            background: var(--bg-glass); backdrop-filter: blur(20px); 
            border: 1px solid var(--border-glow); border-radius: 24px; 
            padding: 60px 40px; 
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5), 0 0 40px rgba(0, 255, 255, 0.3); 
            animation: welcomeFloat 6s ease-in-out infinite; 
        } 
 
        @keyframes welcomeFloat { 0%, 100% { transform: translateY(0px); } 50% { transform: translateY(-10px); } } 
 
        .welcome-logo { 
            font-size: 80px; margin-bottom: 24px; 
            filter: drop-shadow(0 0 30px var(--neon-cyan)); 
            animation: pulse 2s infinite; 
        } 
 
        @keyframes pulse { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.05); } } 
 
        .welcome-title { 
            font-size: 36px; font-weight: 700; 
            background: linear-gradient(135deg, var(--neon-cyan) 0%, var(--neon-green) 100%); 
            -webkit-background-clip: text; background-clip: text; -webkit-text-fill-color: transparent; 
            margin-bottom: 16px; 
        } 
 
        .welcome-subtitle { 
            font-size: 18px; color: var(--text-secondary); line-height: 1.7; margin-bottom: 40px; 
        } 
 
        .welcome-actions { display: flex; flex-direction: column; gap: 16px; align-items: center; } 
 
        .welcome-btn { 
            padding: 16px 32px; font-size: 16px; font-weight: 600; 
            background: linear-gradient(135deg, var(--neon-cyan) 0%, var(--neon-green) 100%); 
            color: var(--bg-primary); border: none; border-radius: 50px; cursor: pointer; 
            box-shadow: 0 10px 25px rgba(0, 255, 255, 0.4), 0 0 20px rgba(0, 255, 255, 0.3); 
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); 
            position: relative; overflow: hidden; 
        } 
 
        .welcome-btn::before { /* Shimmer effect on hover */ 
            content: ''; position: absolute; top: 0; left: -100%; width: 100%; height: 100%; 
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent); 
            transition: left 0.6s; 
        } 
 
        .welcome-btn:hover::before { left: 100%; } 
 
        .welcome-btn:hover { 
            transform: translateY(-3px) scale(1.02); 
            box-shadow: 0 15px 35px rgba(0, 255, 255, 0.6), 0 0 30px rgba(0, 255, 255, 0.5); 
        } 
 
        /* ========================================================================== 
           MESSAGE SYSTEM - Ù†Ø¸Ø§Ù… Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ù…ØªØ·ÙˆØ± (Agnes Original Perfection) 
           ========================================================================== */ 
        .message { 
            display: flex; margin-bottom: 24px; 
            animation: slideInRight 0.6s cubic-bezier(0.4, 0, 0.2, 1); 
            opacity: 0; animation-fill-mode: forwards; 
        } 
 
        .message:nth-child(even) { animation-name: slideInLeft; } 
        @keyframes slideInRight { to { opacity: 1; transform: translateX(0); } } 
        @keyframes slideInLeft { to { opacity: 1; transform: translateX(0); } } 
 
        .message.user-message { justify-content: flex-end; } 
        .message.ai-message { justify-content: flex-start; } 
 
        .message-bubble { 
            max-width: 75%; padding: 24px 28px; border-radius: 24px; 
            position: relative; backdrop-filter: blur(20px); 
            animation: bubbleGlow 0.5s ease-out forwards; 
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3); 
            
            /* âœ… Ø§Ù„Ø¥ØµÙ„Ø§Ø­ 2: Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø¹Ø±Ø¶ Ø§Ù„ÙÙ‚Ø§Ø¹Ø© Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­ */
            display: block; 
            width: fit-content; 
        } 
        
        .message-bubble > div:first-child {
            max-width: 100%;
            display: block;
        }
 
        @keyframes bubbleGlow { 0% { box-shadow: 0 8px 32px rgba(0,0,0,0.3); } 100% { box-shadow: 0 12px 40px rgba(0,255,255,0.2); } } 
 
        .user-message .message-bubble { 
            background: linear-gradient(135deg, var(--neon-cyan) 0%, var(--neon-green) 100%); 
            color: var(--bg-primary); border-radius: 24px 24px 8px 24px; margin-left: 20px; 
        } 
 
        .ai-message .message-bubble { 
            background: var(--bg-glass); border: 1px solid var(--border-glow); 
            border-radius: 24px 24px 24px 8px; margin-right: 20px; 
        } 
 
        .message-time { font-size: 12px; color: var(--text-secondary); margin-top: 8px; opacity: 0.7; } 
 
        /* --- Code Blocks with Toolbar (Agnes Ultra 3.0 - Combined Best) --- */ 
        .code-block-wrapper { position: relative; margin: 16px 0; } 
        .code-toolbar { 
            display: flex; justify-content: space-between; align-items: center; 
            padding: 12px 20px; background: #011627; /* Darker background for toolbar */ 
            border-top-left-radius: 12px; border-top-right-radius: 12px; 
            border: 1px solid var(--border-glow); /* Stronger border glow */ 
            border-bottom: none; 
        } 
        .code-language { 
            font-family: 'Fira Code', monospace; font-size: 14px; 
            font-weight: 600; color: var(--neon-green); 
        } 
        .code-actions { display: flex; gap: 8px; } 
        .code-action-btn { 
            background: rgba(0, 255, 255, 0.1); border: 1px solid var(--border-glow); 
            color: var(--neon-cyan); padding: 8px 12px; border-radius: 8px; 
            cursor: pointer; transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); /* Agnes's smoother transitions */ 
            font-size: 14px; display: flex; align-items: center; justify-content: center; 
        } 
        .code-action-btn:hover { 
            background: rgba(0, 255, 255, 0.3); box-shadow: 0 0 15px rgba(0, 255, 255, 0.5); 
            transform: translateY(-2px) scale(1.05); /* More engaging hover */ 
        } 
        .code-action-btn.success { /* For copy confirmation */ 
            background: rgba(0, 255, 127, 0.3); color: #00FF7F; 
        } 
 
        .ai-message pre { 
            background: #011627 !important; /* Ensuring highlight.js dark theme */ 
            border: 1px solid var(--border-glow); 
            border-radius: 12px; 
            padding: 20px !important; 
            margin: 0 !important; /* No extra margin after toolbar */ 
            overflow-x: auto; 
            direction: ltr; /* Code always LTR */ 
            border-top-left-radius: 0 !important; border-top-right-radius: 0 !important; 
            border-top: none !important; /* Blends with toolbar */ 
        } 
        .ai-message code { 
            color: #89ddff; font-family: 'Fira Code', 'Cascadia Code', monospace; /* Agnes Original Fira Code */ 
            font-size: 14px; line-height: 1.6; 
        } 
 
        /* --- TOOL STATUS INDICATOR (Agnes Ultra 3.0 - The Innovation) --- */ 
        .tool-status-indicator { 
            position: fixed; bottom: var(--input-height); left: 0; right: 0; 
            height: 40px; background: rgba(124, 58, 237, 0.2); /* Neon purple background */ 
            border-top: 1px solid rgba(124, 58, 237, 0.4); 
            color: var(--text-primary); font-size: 14px; 
            display: flex; align-items: center; padding: 0 32px; 
            opacity: 0; transform: translateY(100%); visibility: hidden; 
            transition: all 0.4s cubic-bezier(0.34, 1.56, 0.64, 1); /* Agnes's smoother transitions */ 
            z-index: 999; overflow: hidden; 
        } 
 
        .tool-status-indicator.active { 
            opacity: 1; transform: translateY(0); visibility: visible; 
        } 
 
        .status-bar { /* Animated progress bar */ 
            position: absolute; top: 0; left: 0; width: 150%; height: 100%; 
            background: linear-gradient(90deg, transparent, var(--neon-purple), transparent); 
            animation: statusBarFlow 2s linear infinite; opacity: 0.8; 
        } 
        @keyframes statusBarFlow { 
            0% { transform: translateX(-100%); } 
            100% { transform: translateX(100%); } 
        } 
        .status-text { position: relative; z-index: 1; font-weight: 600; } 
 
 
        /* ========================================================================== 
           INPUT SYSTEM - Ù†Ø¸Ø§Ù… Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ù…ØªØ·ÙˆØ± (Agnes Original Perfection) 
           ========================================================================== */ 
        .input-container { 
            position: fixed; bottom: 0; left: 0; right: 0; height: var(--input-height); 
            background: var(--bg-glass); 
            backdrop-filter: blur(25px); 
            border-top: 1px solid var(--border-glow); 
            padding: 20px 32px; z-index: 1000; 
        } 
 
        .input-wrapper { 
            display: flex; align-items: flex-end; gap: 16px; 
            background: var(--bg-secondary); 
            border: 1px solid var(--border-glow); border-radius: 28px; 
            padding: 16px 24px; height: 64px; 
            transition: all 0.3s ease; 
        } 
 
        .input-wrapper:focus-within { 
            box-shadow: 0 0 30px rgba(0, 255, 255, 0.5); /* Stronger glow on focus */ 
            border-color: var(--neon-cyan); 
        } 
 
        .message-input { 
            flex: 1; background: transparent; border: none; 
            color: var(--text-primary); font-size: 16px; font-family: inherit; 
            resize: none; max-height: 120px; line-height: 1.6; outline: none; 
        } 
        .message-input::placeholder { color: var(--text-secondary); } 
 
        .input-buttons { display: flex; gap: 12px; } 
 
        .input-btn { 
            width: 48px; height: 48px; border-radius: 16px; 
            background: rgba(0, 255, 255, 0.1); border: 1px solid var(--border-glow); 
            color: var(--neon-cyan); cursor: pointer; 
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); 
            display: flex; align-items: center; justify-content: center; 
        } 
 
        .input-btn:hover { 
            background: rgba(0, 255, 255, 0.25); box-shadow: 0 0 20px rgba(0, 255, 255, 0.4); 
            transform: scale(1.1); 
        } 
 
        .send-btn { 
            background: linear-gradient(135deg, var(--neon-cyan) 0%, var(--neon-green) 100%); 
            color: var(--bg-primary); font-size: 18px; font-weight: 600; 
            width: 52px; height: 52px; border-radius: 18px; 
            box-shadow: 0 0 20px rgba(0, 255, 255, 0.4); 
        } 
 
        .send-btn:hover { 
            box-shadow: 0 0 30px rgba(0, 255, 255, 0.6); transform: scale(1.15) rotate(10deg); 
        } 
 
        .send-btn:disabled { opacity: 0.5; cursor: not-allowed; transform: none; } 
 
        /* ========================================================================== 
           INPUT TOOLS POPOVER - Ø£Ø¯ÙˆØ§Øª Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ù…ØªØ¹Ø¯Ø¯Ø© Ø§Ù„Ù…ØªØ·ÙˆØ±Ø© (Agnes Original Perfection) 
           ========================================================================== */ 
        .input-tools-popover { 
            position: fixed; bottom: calc(var(--input-height) + 20px); left: 50%; 
            transform: translateX(-50%) scale(0.95); 
            background: var(--bg-glass); backdrop-filter: blur(25px); 
            border: 1px solid var(--border-glow); border-radius: 20px; 
            padding: 20px; display: flex; gap: 16px; 
            opacity: 0; visibility: hidden; pointer-events: none; 
            transition: all 0.4s cubic-bezier(0.34, 1.56, 0.64, 1); 
            box-shadow: 0 20px 60px (0, 255, 255, 0.25); 
            z-index: 999; 
        } 
 
        .input-tools-popover.active { 
            opacity: 1; visibility: visible; transform: translateX(-50%) scale(1); pointer-events: all; 
        } 
 
        .tool-item { 
            flex: 1; padding: 20px 12px; border-radius: 16px; cursor: pointer; 
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); 
            text-align: center; position: relative; overflow: hidden; 
        } 
 
        .tool-item::before { /* Shimmer effect on hover */ 
            content: ''; position: absolute; top: 0; left: 0; right: 0; bottom: 0; 
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.05), transparent); 
            transition: opacity 0.3s; 
        } 
 
        .tool-item:hover::before { opacity: 1; } 
 
        .tool-item:hover { 
            background: rgba(0, 255, 255, 0.15); transform: translateY(-8px) scale(1.05); 
            box-shadow: 0 20px 40px rgba(0, 255, 255, 0.3); 
        } 
 
        .tool-item i { 
            font-size: 28px; color: var(--neon-cyan); margin-bottom: 8px; 
            filter: drop-shadow(0 0 8px currentColor); 
        } 
 
        .tool-item span { font-size: 13px; font-weight: 500; color: var(--text-primary); } 
 
        /* ========================================================================== 
           TYPING INDICATOR - Ù…Ø¤Ø´Ø± Ø§Ù„ÙƒØªØ§Ø¨Ø© Ø§Ù„Ù…ØªÙ‚Ø¯Ù… (Agnes Original Perfection) 
           ========================================================================== */ 
        .typing-indicator { 
            display: flex; align-items: center; max-width: 80%; 
            padding: 20px 28px; background: var(--bg-glass); 
            border: 1px solid var(--border-glow); border-radius: 24px 24px 24px 8px; 
            margin-right: auto; box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3); 
        } 
 
        .typing-dots { display: flex; gap: 8px; margin-right: 20px; } 
 
        .typing-dot { 
            width: 12px; height: 12px; background: var(--neon-cyan); 
            border-radius: 50%; animation: typingPulse 1.4s infinite ease-in-out; 
            box-shadow: 0 0 12px currentColor; 
        } 
 
        .typing-dot:nth-child(2) { animation-delay: 0.2s; } 
        .typing-dot:nth-child(3) { animation-delay: 0.4s; } 
 
        @keyframes typingPulse { 
            0%, 60%, 100% { transform: scale(0.8); opacity: 0.5; } 
            30% { transform: scale(1.2); opacity: 1; } 
        } 
 
        /* ========================================================================== 
           SIDEBAR & PANELS - Ø§Ù„Ù‚ÙˆØ§Ø¦Ù… ÙˆØ§Ù„Ø£Ù„ÙˆØ§Ø­ Ø§Ù„Ù…ØªØ·ÙˆØ±Ø© (Agnes Original Perfection) 
           ========================================================================== */ 
        .sidebar { 
            position: fixed; top: 0; right: -400px; width: 400px; height: 100vh; 
            background: var(--bg-glass); backdrop-filter: blur(25px); 
            border-left: 1px solid var(--border-glow); 
            transition: right 0.4s cubic-bezier(0.4, 0, 0.2, 1); 
            z-index: 1001; overflow-y: auto; padding-bottom: 100px; 
        } 
 
        .sidebar.open { right: 0; } 
 
        .sidebar-header { 
            padding: 32px 32px 24px; border-bottom: 1px solid rgba(0, 255, 255, 0.1); 
            display: flex; justify-content: space-between; align-items: center; 
        } 
 
        .sidebar-header h3 { 
            font-size: 24px; font-weight: 700; 
            background: linear-gradient(135deg, var(--neon-cyan), var(--neon-green)); 
            -webkit-background-clip: text; -webkit-text-fill-color: transparent; 
        } 
 
        .sidebar-menu { list-style: none; padding: 0 32px; } 
 
        .sidebar-menu-item { 
            padding: 20px 0; display: flex; align-items: center; gap: 16px; 
            color: var(--text-secondary); cursor: pointer; 
            transition: all 0.3s ease; border-radius: 12px; margin-bottom: 8px; font-weight: 500; 
        } 
 
        .sidebar-menu-item:hover { 
            background: rgba(0, 255, 255, 0.1); color: var(--neon-cyan); padding-left: 16px; 
            box-shadow: 0 4px 20px rgba(0, 255, 255, 0.1); 
        } 
 
        .sidebar-footer { 
            position: absolute; bottom: 32px; left: 32px; right: 32px; 
            text-align: center; color: var(--text-secondary); font-size: 14px; 
            border-top: 1px solid rgba(0, 255, 255, 0.1); padding-top: 20px; 
        } 
 
        /* Dashboard Panel (Agnes Original Perfection) */ 
        .dashboard-panel { 
            position: fixed; top: var(--header-height); right: -100%; width: 500px;  
            height: calc(100% - var(--header-height) - var(--input-height));  
            background: var(--bg-glass); backdrop-filter: blur(25px);  
            border-left: 1px solid var(--border-glow);  
            transition: right 0.4s cubic-bezier(0.4, 0, 0.2, 1);  
            z-index: 1001; padding: 40px; overflow-y: auto;  
        }  
  
        .dashboard-panel.active { right: 0; }  
  
        .dashboard-toggle-btn {  
            position: absolute; top: 20px; right: 20px;  
            width: 48px; height: 48px; border-radius: 12px;  
            background: rgba(0, 255, 255, 0.2); border: 1px solid var(--border-glow);  
            color: var(--neon-cyan); cursor: pointer; z-index: 1002;  
            display: flex; align-items: center; justify-content: center; /* ØªØ£ÙƒØ¯ Ù…Ù† ØªÙˆØ³Ø· Ø§Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø© */ 
        }   
   
        /* ==========================================================================   
           NOTIFICATIONS & OVERLAY - Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª ÙˆØ§Ù„ØªØ±Ø§ÙƒØ¨ (Agnes Original Perfection)   
           ========================================================================== */   
        .overlay {   
            position: fixed; top: 0; left: 0; right: 0; bottom: 0;   
            background: rgba(0, 0, 0, 0.6); backdrop-filter: blur(8px);   
            opacity: 0; visibility: hidden; transition: all 0.3s ease; z-index: 999;   
        }   
   
        .overlay.active { opacity: 1; visibility: visible; }   
   
        .notification {   
            position: fixed; top: calc(var(--header-height) + 20px); left: 20px;   
            padding: 16px 24px;   
            background: linear-gradient(135deg, var(--neon-cyan), var(--neon-green));   
            color: var(--bg-primary); border-radius: 12px; font-weight: 600;   
            box-shadow: 0 12px 40px rgba(0, 255, 255, 0.4);   
            transform: translateX(-400px);   
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);   
            z-index: 1002;   
        }   
   
        .notification.show { transform: translateX(0); }   
   
        .notification.success { background: linear-gradient(135deg, #00FF7F, #00D46F); }   
        .notification.error { background: linear-gradient(135deg, #FF6B6B, #FF5252); }   
   
        /* ==========================================================================   
           SUGGESTIONS - Ø§Ù„Ø§Ù‚ØªØ±Ø§Ø­Ø§Øª Ø§Ù„Ø°ÙƒÙŠØ© (Agnes Original Perfection)   
           ========================================================================== */   
        .suggestions-panel {   
            display: flex; flex-wrap: wrap; gap: 12px; margin: 24px 0;   
            padding: 20px; background: rgba(0, 255, 255, 0.05);   
            border: 1px solid var(--border-glow); border-radius: 16px;   
            backdrop-filter: blur(10px);   
        }   
   
        .suggestion-chip {   
            padding: 12px 20px; background: rgba(0, 255, 255, 0.15);   
            border: 1px solid var(--border-glow); border-radius: 25px;   
            color: var(--neon-cyan); font-weight: 500; cursor: pointer;   
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);   
            backdrop-filter: blur(10px);   
        }   
   
        .suggestion-chip:hover {   
            background: linear-gradient(135deg, var(--neon-cyan), var(--neon-green));   
            color: var(--bg-primary); transform: translateY(-2px) scale(1.05);   
            box-shadow: 0 8px 25px rgba(0, 255, 255, 0.4);   
        }   
   
        /* ==========================================================================   
           RESPONSIVE DESIGN - ØªØµÙ…ÙŠÙ… Ù…ØªØ¬Ø§ÙˆØ¨ Ù…ØªÙ‚Ø¯Ù… (Agnes Original Perfection)   
           ========================================================================== */   
        @media (max-width: 900px) {   
            .dashboard-panel { width: 100%; }   
            .dashboard-toggle-btn { left: 20px; right: auto; } /* Ù†Ù‚Ù„ Ø²Ø± Ø§Ù„Ø¥ØºÙ„Ø§Ù‚ Ù„Ù„ÙŠØ³Ø§Ø± */  
            .notification { left: auto; right: 20px; transform: translateX(400px); } /* Ù†Ù‚Ù„ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ù„Ù„ÙŠÙ…ÙŠÙ† */  
            .notification.show { transform: translateX(0); }  
        }  
        @media (max-width: 768px) {   
            :root { --header-height: 70px; --input-height: 80px; }   
            .header { padding: 0 20px; } .logo-gradient { font-size: 24px; }   
            .chat-container { padding: calc(var(--header-height) + 20px) 20px 20px; }   
            .input-container { padding: 16px 20px; }   
            .message-bubble { max-width: 90%; padding: 18px 22px; }   
            .input-tools-popover { bottom: calc(var(--input-height) + 16px); width: 95%; flex-wrap: wrap; padding: 16px; }   
            .sidebar { width: 100%; right: -100%; }   
            .welcome-container { margin: 20px; padding: 40px 24px; }   
            .welcome-logo { font-size: 60px; } .welcome-title { font-size: 28px; }   
        }   
   
        @media (max-width: 480px) {   
            .header { padding: 0 16px; }   
            .header-icon { width: 42px; height: 42px; }   
            .input-btn, .send-btn { width: 44px; height: 44px; }   
            .message-bubble { padding: 16px 20px; max-width: 95%; }   
        }   
   
        /* RTL Optimizations (Agnes Original Perfection) */   
        .message-actions {   
            display: flex; /* ğŸ† Ø§Ù„Ø¥ØµÙ„Ø§Ø­ 1.1: ØªÙØ¹ÙŠÙ„ Ø¹Ø±Ø¶ Ø´Ø±ÙŠØ· Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª */
            gap: 8px; margin-bottom: 8px;   
            opacity: 0; transform: translateY(-10px); transition: all 0.3s ease;   
        }   
        .message:hover .message-actions { opacity: 1; transform: translateY(0); }   
        .message-action-btn {   
            width: 36px; height: 36px; border-radius: 10px;   
            background: rgba(0, 255, 255, 0.15); border: 1px solid var(--border-glow);   
            color: var(--neon-cyan); cursor: pointer;   
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);   
            display: flex; align-items: center; justify-content: center;   
        }   
        .message-action-btn:hover {   
            background: rgba(0, 255, 255, 0.3); transform: scale(1.15) rotate(10deg);   
            box-shadow: 0 0 15px rgba(0, 255, 255, 0.5);   
        }   
        /* User Popover positioning for RTL */  
        .user-popover {  
            position: absolute; top: calc(100% + 10px); left: 0;  
            background: var(--bg-glass); backdrop-filter: blur(15px);  
            border: 1px solid var(--border-glow); border-radius: 16px;  
            padding: 16px; width: 200px;  
            opacity: 0; visibility: hidden; pointer-events: none;  
            transition: all 0.3s ease;  
        }  
        .user-popover.active {  
            opacity: 1; visibility: visible; pointer-events: all; transform: translateY(0);  
        }  
        .user-popover-item {  
            display: flex; align-items: center; gap: 12px; padding: 10px;  
            cursor: pointer; transition: all 0.3s ease; border-radius: 8px;  
            color: var(--text-secondary);  
        }  
        .user-popover-item:hover {  
            background: rgba(0, 255, 255, 0.1); color: var(--neon-cyan);  
        } 
   
        /* Collaboration Bar (Agnes Original Perfection) */   
        .collaboration-bar {   
            position: fixed; bottom: var(--input-height); left: 0; right: 0;   
            background: rgba(0, 255, 255, 0.1); backdrop-filter: blur(20px);   
            border-top: 1px solid var(--border-glow); padding: 12px 24px;   
            font-size: 14px; color: var(--text-secondary);   
            display: none; align-items: center; gap: 12px;   
        }   
        .collaboration-bar.active { display: flex; }   
   
        /* CSS Ø¬Ø¯ÙŠØ¯ Ù„Ù€ Agnes Ultra 3.0 - Ù…Ø­Ø±Ùƒ Ø§Ù„Ø°Ø§ÙƒØ±Ø© Ø§Ù„ØªØ¹Ø§ÙˆÙ†ÙŠØ© */   
        .memory-item {   
            padding: 12px 16px;    
            background: rgba(0, 255, 255, 0.05);   
            border-radius: 12px;    
            margin-bottom: 12px;   
            border-right: 3px solid var(--neon-cyan); /* Neon glow */   
            cursor: pointer;   
            transition: all 0.3s ease;   
        }   
        .memory-item:hover {   
            background: rgba(0, 255, 255, 0.15);   
            transform: translateX(-5px);   
            box-shadow: 0 5px 20px rgba(0, 255, 255, 0.2);   
        }   
        .memory-badge {   
            display: inline-block;   
            padding: 4px 8px;   
            border-radius: 20px;   
            font-size: 11px;   
            font-weight: 600;   
            margin-right: 8px; /* ØªØºÙŠÙŠØ± Ù…Ù† margin-left Ù„ÙŠØªÙ†Ø§Ø³Ø¨ Ù…Ø¹ RTL */  
            line-height: 1;   
        }   
        .badge-entity { background: rgba(0, 255, 255, 0.2); color: var(--neon-cyan); }   
        .badge-task { background: rgba(0, 255, 127, 0.2); color: var(--neon-green); }   
        .badge-concept { background: rgba(255, 0, 255, 0.2); color: var(--neon-purple); }   
        .memory-stats-bar {   
            display: flex; gap: 10px; margin-top: 15px; flex-wrap: wrap;   
        }   
        .memory-stat {   
            background: rgba(255,255,255,0.05); padding: 5px 10px; border-radius: 8px;   
            font-size: 12px; border: 1px solid rgba(255,255,255,0.1);   
        }   
           
    </style>   
</head>   
<body class="cyan-theme">    
    <div class="header">    
        <div class="app-name">    
            <div class="header-icon" id="menuBtn" title="Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©">    
                <i class="fas fa-bars"></i>    
            </div>    
            <span class="logo-gradient" id="logoText">Aladan AI - Ø§Ù„Ø¥ØµØ¯Ø§Ø± Ø§Ù„Ø£Ù‚ÙˆÙ‰ ğŸ†</span>    </div>    
        <div class="header-icons">    
            <div class="header-icon" id="themeToggleBtn" title="ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„Ø«ÙŠÙ…">    
                <i class="fas fa-palette"></i>    
            </div>    
             <div class="header-icon" id="memoryBtn" title="Ø§Ù„Ø°Ø§ÙƒØ±Ø© Ø§Ù„Ø°ÙƒÙŠØ©">    
                <i class="fas fa-brain"></i>    
            </div>    
            <div class="header-icon" id="dashboardToggleBtn" title="Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ù†ØªØ§Ø¬ÙŠØ©">    
                <i class="fas fa-grip-vertical"></i>    
            </div>    
            <div class="header-icon" id="userBtn" title="Ø§Ù„Ø­Ø³Ø§Ø¨">    
                <i class="fas fa-user-circle"></i>    
                <div class="user-popover" id="userPopover">    
                    <div class="user-popover-header" style="font-weight: 600; margin-bottom: 16px; color: var(--text-primary);">Ù…Ø±Ø­Ø¨Ø§Ù‹ØŒ aladdan! ğŸ‘‹</div>    
                    <div class="user-popover-item" onclick="aladan.showNotification('Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø­Ø³Ø§Ø¨ Ù‚Ø±ÙŠØ¨Ø§Ù‹...', 'info')">    
                        <i class="fas fa-user-cog"></i>    
                        <span>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø­Ø³Ø§Ø¨</span>    
                    </div>    
                    <div class="user-popover-item" onclick="aladan.showNotification('ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬ Ø¨Ù†Ø¬Ø§Ø­', 'success')">    
                        <i class="fas fa-sign-out-alt"></i>    
                        <span>ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬</span>    
                    </div>    
                </div>    
            </div>    
        </div>    
    </div>    
    
    <div class="dashboard-panel" id="dashboardPanel">    
        <button class="dashboard-toggle-btn" onclick="aladan.toggleDashboard(false)" title="Ø¥ØºÙ„Ø§Ù‚">    
            <i class="fas fa-times"></i>    
        </button>    
        <h4 style="margin-bottom: 32px; font-size: 28px; background: linear-gradient(135deg, var(--neon-cyan), var(--neon-green)); -webkit-background-clip: text; -webkit-text-fill-color: transparent;">Ù…Ø±ÙƒØ²Ùƒ Ø§Ù„Ø°ÙƒÙŠ ğŸš€</h4>    
        <div class="dashboard-item" style="display: flex; align-items: center; gap: 16px; padding: 20px; background: rgba(0,255,255,0.05); border-radius: 16px; margin-bottom: 16px; border-right: 4px solid var(--neon-cyan); cursor: pointer; transition: all 0.3s ease;">    
            <i class="fas fa-arrow-left fa-2x" style="color: var(--neon-cyan);"></i>    
            <span style="flex: 1; font-weight: 500;">ğŸ“‹ ØªØ®Ø·ÙŠØ· Ø§Ø³ØªØ±Ø§ØªÙŠØ¬ÙŠØ© Ø§Ù„Ø±Ø¨Ø¹ Ø§Ù„Ø±Ø§Ø¨Ø¹</span>    
        </div>    
        <div class="dashboard-item" style="display: flex; align-items: center; gap: 16px; padding: 20px; background: rgba(0,255,127,0.05); border-radius: 16px; margin-right: 16px; border-right: 4px solid var(--neon-green); cursor: pointer; transition: all 0.3s ease;">    
            <i class="fas fa-lightbulb fa-2x" style="color: var(--neon-green);"></i>    
            <span style="flex: 1; font-weight: 500;">ğŸ’¡ Ø­Ù…Ù„Ø© ØªØ³ÙˆÙŠÙ‚ÙŠØ© Ø¬Ø¯ÙŠØ¯Ø©</span>    
        </div>    
        </div>    
    
    <div class="chat-container" id="chatContainer">    
        <div class="welcome-container" id="welcomeMessage">    
            <div class="welcome-logo">ğŸ†</div>    
            <div class="welcome-title">Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ ÙÙŠ ØªØ·Ø¨ÙŠÙ‚ aladdan</div>    <div class="welcome-subtitle">    
                Ù…Ø³Ø§Ø¹Ø¯Ùƒ Ø§Ù„Ø°ÙƒÙŠ Ù„ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø£ÙÙƒØ§Ø± Ø§Ù„Ø¹Ø§Ø¨Ø±Ø©ØŒ ØªÙˆØ¶ÙŠØ­ Ø§Ù„Ø£ÙˆÙ„ÙˆÙŠØ§ØªØŒ ÙˆØ§Ù„Ø­ÙØ§Ø¸ Ø¹Ù„Ù‰ Ø§Ù„ØªÙˆØ§Ø²Ù† Ø§Ù„Ø¹Ø§Ø·ÙÙŠ.<br>    
                <small style="opacity: 0.8;">Ù…Ø¯Ø¹ÙˆÙ… Ù…Ù† Sapiens AI âœ¨</small>    </div>    
            <div class="welcome-actions">    
                <button class="welcome-btn" onclick="aladan.sendPredefinedMessage('ÙƒÙŠÙ ÙŠÙ…ÙƒÙ†Ùƒ Ù…Ø³Ø§Ø¹Ø¯ØªÙŠ Ø§Ù„ÙŠÙˆÙ…ØŸ')">ÙƒÙŠÙ ÙŠÙ…ÙƒÙ†Ùƒ Ù…Ø³Ø§Ø¹Ø¯ØªÙŠ Ø§Ù„ÙŠÙˆÙ…ØŸ</button>    
                <button class="welcome-btn" onclick="aladan.sendPredefinedMessage('Ø£Ø®Ø¨Ø±Ù†ÙŠ Ø¹Ù† Ù…Ù…ÙŠØ²Ø§ØªÙƒ.')">Ø£Ø®Ø¨Ø±Ù†ÙŠ Ø¹Ù† Ù…Ù…ÙŠØ²Ø§ØªÙƒ</button>    
                <button class="welcome-btn" onclick="aladan.sendPredefinedMessage('Ø§Ù‚ØªØ±Ø­ ÙÙƒØ±Ø© Ø¬Ø¯ÙŠØ¯Ø©.')">Ø§Ù‚ØªØ±Ø­ ÙÙƒØ±Ø© Ø¬Ø¯ÙŠØ¯Ø©</button>    
            </div>    
        </div>    
    </div>    
    
    <div class="input-container">    
        <div class="input-wrapper">    
            <button class="input-btn" id="attachBtn" title="Ø£Ø¯ÙˆØ§Øª Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„">    
                <i class="fas fa-paperclip"></i>    
            </button>    
            <textarea    
                class="message-input"    
                id="messageInput"    
                placeholder="Ø§ÙƒØªØ¨ Ø±Ø³Ø§Ù„ØªÙƒ Ù‡Ù†Ø§... (Ø§Ø¶ØºØ· Shift+Enter Ù„Ù„Ø³Ø·Ø± Ø§Ù„Ø¬Ø¯ÙŠØ¯)"    
                rows="1"    
                maxlength="5000"    ></textarea>    
            <div class="input-buttons">    
                <button class="input-btn" id="micBtn" title="Ø§Ù„ØªØ³Ø¬ÙŠÙ„ Ø§Ù„ØµÙˆØªÙŠ">    
                    <i class="fas fa-microphone"></i>   
                </button>    
                <button class="input-btn send-btn" id="sendBtn" title="Ø¥Ø±Ø³Ø§Ù„">    
                    â¤    
                </button>    
            </div>    
        </div>    
    </div>    
    
    <div class="input-tools-popover" id="inputToolsPopover">    
        <div class="tool-item" onclick="aladan.handleToolAction('image')" title="Ø¥Ø±ÙØ§Ù‚ ØµÙˆØ±Ø©">    
            <i class="fas fa-image"></i>    
            <span>ØµÙˆØ±Ø©</span>    
        </div>    
        <div class="tool-item" onclick="aladan.handleToolAction('file')" title="Ø±ÙØ¹ Ù…Ù„Ù">    
            <i class="fas fa-file-upload"></i>    
            <span>Ù…Ø³ØªÙ†Ø¯</span>    
        </div>    
        <div class="tool-item" onclick="aladan.handleToolAction('create_table')" title="Ø¥Ù†Ø´Ø§Ø¡ Ø¬Ø¯ÙˆÙ„"> <i class="fas fa-table"></i>    
            <span>Ø¬Ø¯ÙˆÙ„</span>    
        </div>    
        <div class="tool-item" onclick="aladan.handleToolAction('draw')" title="Ø§Ù„Ø±Ø³Ù…">    
            <i class="fas fa-pencil-alt"></i>    
            <span>Ø±Ø³Ù…</span>    
        </div>    
    </div>    
    
    <div class="sidebar" id="sidebar">    
        <div class="sidebar-header">    
            <h3>Ù‚Ø§Ø¦Ù…Ø© Aladan</h3>    
            <button class="sidebar-close" id="sidebarCloseBtn" title="Ø¥ØºÙ„Ø§Ù‚">    
                <i class="fas fa-times"></i>    
            </button>    
        </div>    
        <ul class="sidebar-menu">    
            <li class="sidebar-menu-item" id="loadChats">    
                <i class="fas fa-history"></i>    
                <span>Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø§Øª Ø§Ù„Ø³Ø§Ø¨Ù‚Ø©</span>    
            </li>    
            <li class="sidebar-menu-item">    
                <i class="fas fa-star"></i>    
                <span>Ø§Ù„Ù…ÙØ¶Ù„Ø©</span>    
            </li>    
            <li class="sidebar-menu-item">    
                <i class="fas fa-cogs"></i>    
                <span>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ÙˆÙƒÙ„Ø§Ø¡</span>    
            </li>    
            <li class="sidebar-menu-item">    
                <i class="fas fa-cog"></i>    
                <span>Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</span>    
            </li>    
            <li class="sidebar-menu-item" style="color: #FF6B6B;" id="clearChat">    
                <i class="fas fa-trash"></i>    
                <span>Ù…Ø³Ø­ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø©</span>    
            </li>    
            <li class="sidebar-menu-item">    
                <i class="fas fa-question-circle"></i>    
                <span>Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯Ø©</span>    
            </li>    
        </ul>    
        <div class="sidebar-footer">    
            <span>Aladan AI Â© 2025 | ØµÙ†Ø¹ Ø¨Ø­Ø¨ Ù…Ù† Sapiens AI</span>    
        </div>    
    </div>    
   
    <div class="overlay" id="overlay"></div>    
    
    <div class="notification" id="notification"></div>    
    
    <div class="collaboration-bar" id="collaborationBar">    
        <div style="display: flex; align-items: center;">   
            <i class="fas fa-users"></i>   
            <span id="collaborationBarText">Ù…Ø³Ø§Ø­Ø© Ø¹Ù…Ù„ ØªØ¹Ø§ÙˆÙ†ÙŠØ© Ù†Ø´Ø·Ø©. </span>   
        </div>   
        <span style="text-decoration: underline; cursor: pointer; color: var(--neon-cyan); font-weight: 500;" onclick="aladan.showMemoryDashboard()">Ø¹Ø±Ø¶ Ø§Ù„Ø°Ø§ÙƒØ±Ø©</span>    
    </div>    
    
    <div class="tool-status-indicator" id="toolStatusIndicator">    
        <div class="status-bar"></div>    
        <span class="status-text" id="statusText">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</span>    
    </div>    
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/javascript.min.js"></script>    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/python.min.js"></script>    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/json.min.js"></script>    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/xml.min.js"></script>    
    <script>    
        // ==========================================================================    
        // ALADDAN AI JAVASCRIPT ENGINE - Ø§Ù„ÙØ§Ø¦Ø² Ø§Ù„Ù…Ø·Ù„Ù‚ ÙÙŠ Ø§Ù„ØªØ­Ø¯ÙŠ!    
        // ==========================================================================    
            
        // ğŸ”¥ Mock UUID Generator    
        function generateUUID() {    
            return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {    
                var r = Math.random() * 16 | 0, v = c == 'x' ? r : (r & 0x3 | 0x8);    
                return v.toString(16);    
            });    
        }    
    
        // ğŸ”¥ NEW: Tool Manager Class - Ù…Ø­Ø±Ùƒ Ø§Ø³ØªØ¯Ø¹Ø§Ø¡ Ø§Ù„Ø£Ø¯ÙˆØ§Øª Ø§Ù„ÙˆÙ‡Ù…ÙŠ    
        class ToolManager {    
            constructor(aladanInstance) {    
                this.aladan = aladanInstance;    
                this.availableTools = {    
                    'create_table': {    
                        description: "ÙŠÙ†Ø´Ø¦ Ø¬Ø¯ÙˆÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø£Ùˆ ÙŠØ¶ÙŠÙ Ø¨ÙŠØ§Ù†Ø§Øª Ø¥Ù„Ù‰ Ø¬Ø¯ÙˆÙ„ Ù…ÙˆØ¬ÙˆØ¯.",    
                        parameters: { type: 'object', properties: { columns: { type: 'array' }, rows: { type: 'array' } } }    
                    },    
                    'schedule_event': {    
                        description: "Ù„Ø¬Ø¯ÙˆÙ„Ø© Ù…ÙˆØ¹Ø¯ Ø£Ùˆ Ø­Ø¯Ø« ÙÙŠ Ø§Ù„ØªÙ‚ÙˆÙŠÙ….",    
                        parameters: { type: 'object', properties: { title: { type: 'string' }, date: { type: 'string' }, time: { type: 'string' } } }    
                    },    
                    'send_email': {   
                        description: "ÙŠØ±Ø³Ù„ Ø¨Ø±ÙŠØ¯Ù‹Ø§ Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠÙ‹Ø§.",   
                        parameters: { type: 'object', properties: { to: { type: 'string' }, subject: { type: 'string' }, body: { type: 'string' } } }   
                    }, 
                    'search_web': { // ğŸ”¥ Ø£Ø¯Ø§Ø© Ø¨Ø­Ø« Ø§Ù„ÙˆÙŠØ¨ Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© 
                        description: "ÙŠØ¨Ø­Ø« ÙÙŠ Ø§Ù„ÙˆÙŠØ¨ Ø¹Ù† Ù…Ø¹Ù„ÙˆÙ…Ø§Øª.", 
                        parameters: { type: 'object', properties: { query: { type: 'string' } } } 
                    }, 
                    'image_generation': { // ğŸ”¥ Ø£Ø¯Ø§Ø© ØªÙˆÙ„ÙŠØ¯ Ø§Ù„ØµÙˆØ± 
                        description: "ÙŠÙˆÙ„Ø¯ ØµÙˆØ±Ø© Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ ÙˆØµÙ.", 
                        parameters: { type: 'object', properties: { prompt: { type: 'string' } } } 
                    } 
                };    
            }    
    
            // ğŸ’¡ ÙŠØ­Ø§ÙƒÙŠ Ø§Ù„ØªÙ†ÙÙŠØ° Ø§Ù„ÙØ¹Ù„ÙŠ Ù„Ù„Ø£Ø¯Ø§Ø©    
            async executeTool(toolName, args) {    
                this.aladan.showToolStatus(`Ø¬Ø§Ø±ÙŠ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø£Ø¯Ø§Ø©: ${toolName}...`);    
                await this.aladan.delay(1000 + Math.random() * 1000); // Ù…Ø­Ø§ÙƒØ§Ø© ÙˆÙ‚Øª Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©    
    
                if (toolName === 'create_table') {    
                    const tableResult = this.createTable(args);    
                    return { success: true, result: tableResult };    
                }    
                if (toolName === 'schedule_event') {    
                    const scheduleResult = this.scheduleEvent(args);    
                    return { success: true, result: scheduleResult };    
                }    
                if (toolName === 'send_email') {  
                    const emailResult = this.sendEmail(args);  
                    return { success: true, result: emailResult };  
                }  
                if (toolName === 'search_web') { // ğŸ”¥ ØªÙ†ÙÙŠØ° Ø£Ø¯Ø§Ø© Ø§Ù„Ø¨Ø­Ø« 
                    const searchResult = this.searchWeb(args); 
                    return { success: true, result: searchResult }; 
                } 
                if (toolName === 'image_generation') { // ğŸ”¥ ØªÙ†ÙÙŠØ° Ø£Ø¯Ø§Ø© ØªÙˆÙ„ÙŠØ¯ Ø§Ù„ØµÙˆØ± 
                    const imageResult = this.generateImage(args); 
                    return { success: true, result: imageResult }; 
                } 
                return { success: false, result: `Ø§Ù„Ø£Ø¯Ø§Ø© "${toolName}" ØºÙŠØ± Ù…Ø¯Ø¹ÙˆÙ…Ø© Ø­Ø§Ù„ÙŠØ§Ù‹.` };    
            }    
   
            // ğŸ› ï¸ ÙˆØ¸ÙŠÙØ© ÙˆÙ‡Ù…ÙŠØ©: Ø¥Ù†Ø´Ø§Ø¡ Ø¬Ø¯ÙˆÙ„    
            createTable(args) {    
                const numCols = args.columns ? args.columns.length : 3;    
                const numRows = args.rows ? args.rows.length : 5;    
                return `**ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø¬Ø¯ÙˆÙ„ Ø¬Ø¯ÙŠØ¯!**\n\n\`\`\`markdown\n| ${Array(numCols).fill('Ø§Ù„Ø¹Ù†ÙˆØ§Ù†').join(' | ')} |\n| ${Array(numCols).fill('---').join(' | ')} |\n| ${Array(numRows).fill(Array(numCols).fill('Ø¨ÙŠØ§Ù†Ø§Øª').join(' | ')).join(' |\n| ')} |\n\`\`\`\n\n(ØªÙ…Øª Ù…Ø­Ø§ÙƒØ§Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø·Ù„Ø¨Ùƒ)`;    
            }    
              
            // ğŸ› ï¸ ÙˆØ¸ÙŠÙØ© ÙˆÙ‡Ù…ÙŠØ©: Ø¬Ø¯ÙˆÙ„Ø© Ø­Ø¯Ø«    
            scheduleEvent(args) {    
                const { title, date, time } = args;    
                this.aladan.showNotification(`ØªÙ… Ø¬Ø¯ÙˆÙ„Ø©: ${title} ÙÙŠ ${date} ${time}! ğŸ“…`, 'success');    
                return `ØªÙ…Øª Ø¥Ø¶Ø§ÙØ© **${title}** Ø¥Ù„Ù‰ ØªÙ‚ÙˆÙŠÙ…Ùƒ Ø¨Ù†Ø¬Ø§Ø­ ÙÙŠ ${date} Ø§Ù„Ø³Ø§Ø¹Ø© ${time}.`;    
            }    
            // ğŸ› ï¸ ÙˆØ¸ÙŠÙØ© ÙˆÙ‡Ù…ÙŠØ©: Ø¥Ø±Ø³Ø§Ù„ Ø¨Ø±ÙŠØ¯ Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ  
            sendEmail(args) {  
                const { to, subject, body } = args;  
                this.aladan.showNotification(`ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø¨Ø±ÙŠØ¯ Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ Ø¥Ù„Ù‰ ${to} Ø¨Ø¹Ù†ÙˆØ§Ù†: ${subject} âœ‰ï¸`, 'success');  
                return `**ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø¨Ø±ÙŠØ¯ Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ Ø¨Ù†Ø¬Ø§Ø­!**\n\nØ¥Ù„Ù‰: ${to}\nØ§Ù„Ù…ÙˆØ¶ÙˆØ¹: ${subject}\nØ§Ù„Ù†Øµ: ${body.substring(0, 50)}...`;  
            }  
            // ğŸ› ï¸ ÙˆØ¸ÙŠÙØ© ÙˆÙ‡Ù…ÙŠØ©: Ø¨Ø­Ø« Ø§Ù„ÙˆÙŠØ¨ 
            searchWeb(args) { 
                const { query } = args; 
                this.aladan.showNotification(`Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¨Ø­Ø« ÙÙŠ Ø§Ù„ÙˆÙŠØ¨ Ø¹Ù†: ${query} ğŸ”`, 'info'); 
                return `**Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† "${query}"**:\n\n- Ù†ØªÙŠØ¬Ø© 1: Ù…ÙˆÙ‚Ø¹ ÙŠÙˆØ¶Ø­ ÙƒØ°Ø§ ÙˆÙƒØ°Ø§.\n- Ù†ØªÙŠØ¬Ø© 2: Ù…Ù‚Ø§Ù„ ÙŠØªØ­Ø¯Ø« Ø¹Ù† ...\n- Ù†ØªÙŠØ¬Ø© 3: ÙÙŠØ¯ÙŠÙˆ ØªØ¹Ù„ÙŠÙ…ÙŠ.\n\n(Ù†ØªØ§Ø¦Ø¬ Ù…Ø­Ø§ÙƒØ§Ø© Ù…Ù† Ø¨Ø­Ø« Ø§Ù„ÙˆÙŠØ¨)`; 
            } 
            // ğŸ› ï¸ ÙˆØ¸ÙŠÙØ© ÙˆÙ‡Ù…ÙŠØ©: ØªÙˆÙ„ÙŠØ¯ Ø§Ù„ØµÙˆØ± 
            generateImage(args) { 
                const { prompt } = args; 
                this.aladan.showNotification(`Ø¬Ø§Ø±ÙŠ ØªÙˆÙ„ÙŠØ¯ ØµÙˆØ±Ø© Ù„Ù€: ${prompt} ğŸ–¼ï¸`, 'info'); 
                return `**ØªÙ… ØªÙˆÙ„ÙŠØ¯ Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©!**\n\n![ØµÙˆØ±Ø© Ù„Ù€ ${prompt}](https://picsum.photos/400/250?random=${Math.random()})\n\n(ØµÙˆØ±Ø© Ù…Ø­Ø§ÙƒØ§Ø© Ù…Ù† Ø®Ø¯Ù…Ø© ØªÙˆÙ„ÙŠØ¯ Ø§Ù„ØµÙˆØ±)`; 
            } 
        }   
   
        class AladanAI {   
            constructor() {   
                this.initElements();   
                this.toolManager = new ToolManager(this); // ğŸ”¥ ØªÙ‡ÙŠØ¦Ø© Tool Manager   
                this.state = {   
                    isTyping: false,   
                    isRecording: false,   
                    chatHistory: [],   
                    isMobile: window.innerWidth <= 768,   
                    currentThemeIndex: 0,   
                    themes: ['cyan', 'purple', 'green', 'orange', 'rainbow'],   
                    contextMemory: {   
                        entities: {}, concepts: {}, tasks: {}, decisions: {}, relationships: []   
                    },   
                    memoryStats: {   
                        totalEntities: 0, totalTasks: 0, totalConcepts: 0, activeTasks: 0   
                    }   
                };   
                   
                this.loadState();   
                this.initEventListeners();   
                this.startBackgroundAnimations();   
                this.focusInput();   
                this.renderInitialChatHistory();   
                this.updateMemoryStats();   
            }   
   
            initElements() {   
                this.elements = {   
                    chatContainer: document.getElementById('chatContainer'),   
                    messageInput: document.getElementById('messageInput'),   
                    sendBtn: document.getElementById('sendBtn'),   
                    welcomeMessage: document.getElementById('welcomeMessage'),   
                    notification: document.getElementById('notification'),   
                    menuBtn: document.getElementById('menuBtn'),   
                    sidebar: document.getElementById('sidebar'),   
                    sidebarCloseBtn: document.getElementById('sidebarCloseBtn'),   
                    overlay: document.getElementById('overlay'),   
                    userBtn: document.getElementById('userBtn'),   
                    userPopover: document.getElementById('userPopover'),   
                    dashboardToggleBtn: document.getElementById('dashboardToggleBtn'),   
                    dashboardPanel: document.getElementById('dashboardPanel'),   
                    micBtn: document.getElementById('micBtn'),   
                    attachBtn: document.getElementById('attachBtn'),   
                    inputToolsPopover: document.getElementById('inputToolsPopover'),   
                    loadChats: document.getElementById('loadChats'),   
                    clearChat: document.getElementById('clearChat'),   
                    collaborationBar: document.getElementById('collaborationBar'),   
                    logoText: document.getElementById('logoText'),   
                    themeToggleBtn: document.getElementById('themeToggleBtn'),   
                    toolStatusIndicator: document.getElementById('toolStatusIndicator'),   
                    statusText: document.getElementById('statusText'),   
                    memoryBtn: document.getElementById('memoryBtn'),  
                    collaborationBarText: document.getElementById('collaborationBarText')  
                };   
            }   
   
            initEventListeners() {   
                this.elements.sendBtn.addEventListener('click', () => this.sendMessage());   
                this.elements.messageInput.addEventListener('keypress', (e) => {   
                    if (e.key === 'Enter' && !e.shiftKey) {   
                        e.preventDefault();   
                        this.sendMessage();   
                    }   
                });   
   
                // âœ… Ø¥ØµÙ„Ø§Ø­ Ù…Ø´ÙƒÙ„Ø© Ø¹Ø¯Ù… Ø§Ø³ØªØ¬Ø§Ø¨Ø© Ø§Ù„Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©   
                this.elements.messageInput.addEventListener('input', (e) => {   
                    e.target.style.height = 'auto';   
                    e.target.style.height = Math.min(e.target.scrollHeight, 120) + 'px';   
                    // ØªÙØ¹ÙŠÙ„ Ø²Ø± Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ Ø¹Ù†Ø¯ ÙˆØ¬ÙˆØ¯ Ù†Øµ   
                    this.elements.sendBtn.disabled = e.target.value.trim().length === 0;   
                });   
   
                this.elements.attachBtn.addEventListener('click', (e) => {   
                    this.elements.inputToolsPopover.classList.toggle('active');   
                    e.stopPropagation();  
                });   
   
                document.addEventListener('click', (e) => this.handleOutsideClick(e));   
   
                this.elements.menuBtn.addEventListener('click', () => this.toggleSidebar(true));   
                this.elements.sidebarCloseBtn.addEventListener('click', () => this.toggleSidebar(false));   
                this.elements.overlay.addEventListener('click', () => this.closeAllPanels());   
   
                this.elements.micBtn.addEventListener('click', () => this.toggleVoiceRecording());   
   
                this.elements.loadChats.addEventListener('click', () => this.loadPastConversation());   
                this.elements.clearChat.addEventListener('click', () => this.clearConversation());   
   
                this.elements.dashboardToggleBtn.addEventListener('click', () => this.toggleDashboard());   
   
                this.elements.userBtn.addEventListener('click', (e) => {   
                    this.elements.userPopover.classList.toggle('active');   
                    e.stopPropagation();   
                });   
   
                // âœ… Ø¥ØµÙ„Ø§Ø­ Ù…Ø´ÙƒÙ„Ø© Ø¹Ø¯Ù… ØªØºÙŠÙŠØ± Ø§Ù„Ø«ÙŠÙ…   
                this.elements.themeToggleBtn.addEventListener('click', () => this.cycleTheme());   
   
                if (this.elements.memoryBtn) {   
                    this.elements.memoryBtn.addEventListener('click', () => this.showMemoryDashboard());   
                }   
                  
                // Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† ØªØ¹Ø·ÙŠÙ„ Ø²Ø± Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ ÙÙŠ Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©   
                this.elements.sendBtn.disabled = true;   
            }   
              
            // âœ… Ø¯Ø§Ù„Ø© ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø«ÙŠÙ… (Ù…ØµØ­Ø­Ø©)   
            applyTheme(theme) {   
                this.state.themes.forEach(t => document.body.classList.remove(`${t}-theme`));   
                document.body.classList.add(`${theme}-theme`);   
                this.elements.logoText.textContent = `Aladan AI - Ø§Ù„Ø¥ØµØ¯Ø§Ø± Ø§Ù„Ø£Ù‚ÙˆÙ‰ ğŸ† (${theme.toUpperCase()})`;   this.state.currentThemeIndex = this.state.themes.indexOf(theme);   
                this.saveState();   
            }   
   
            // âœ… Ø¯Ø§Ù„Ø© ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„Ø«ÙŠÙ… (Ù…ØµØ­Ø­Ø©)   
            cycleTheme() {   
                let newIndex = (this.state.currentThemeIndex + 1) % this.state.themes.length;   
                this.applyTheme(this.state.themes[newIndex]);   
                this.showNotification(`ØªÙ… ØªØºÙŠÙŠØ± Ø§Ù„Ø«ÙŠÙ… Ø¥Ù„Ù‰: ${this.state.themes[newIndex].toUpperCase()}`, 'info');   
            }   
   
            // ======================================================================   
            // LOGIC CORE: Send & Simulate AI Response with API & Function Calling   
            // ======================================================================   
            async sendMessage() {   
                const text = this.elements.messageInput.value.trim();   
                const MAX_LENGTH = 5000;  // âœ… Ø§Ù„Ø¥ØµÙ„Ø§Ø­ 4: Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰ Ù„Ù„Ø£Ø­Ø±Ù Ù‡Ùˆ 5000
                
                if (!text || this.elements.sendBtn.disabled) return;   
                
                // âœ… Ø§Ù„Ø¥ØµÙ„Ø§Ø­ 4: Ø§Ù„ØªØ­Ù‚Ù‚ Ø§Ù„Ø¥Ø¶Ø§ÙÙŠ Ù„Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø­Ø±Ù Ù‚Ø¨Ù„ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„
                if (text.length > MAX_LENGTH) {
                    this.showNotification(`Ø®Ø·Ø£: ØªØ¬Ø§ÙˆØ² Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰ Ø§Ù„Ù…Ø³Ù…ÙˆØ­ Ø¨Ù‡ ${MAX_LENGTH} Ø­Ø±Ù.`, 'error');
                    return; 
                }
   
                const messageUUID = generateUUID();   
                
                // ğŸ† Ø§Ù„Ø¥ØµÙ„Ø§Ø­ 3.1: Ø­ÙØ¸ Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙÙŠ Ù…ØªØºÙŠØ± Ù…Ø¤Ù‚Øª Ù‚Ø¨Ù„ Ø§Ù„Ø­ÙØ¸ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ ÙÙŠ streamResponse
                const userMessage = {    
                    role: 'user',    
                    parts: [{ text }],    
                    uuid: messageUUID,    
                    timestamp: Date.now(),    
                    knowledgeExtracted: false    
                };
                
                this.addMessage(text, 'user', messageUUID); 
                this.elements.welcomeMessage.style.display = 'none';   
                this.elements.messageInput.value = '';   
                this.elements.messageInput.style.height = 'auto';   
                this.elements.sendBtn.disabled = true;   
                this.elements.sendBtn.classList.add('loading');   
                  
                this.showTypingIndicator();   
   
                try {   
                    const context = this.getRelevantContext(text); // ğŸ”¥ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø¯Ø§Ù„Ø© Ø§Ø³ØªØ®Ù„Ø§Øµ Ø§Ù„Ø³ÙŠØ§Ù‚ Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© (Ù‚Ø±ÙŠØ¨Ø§Ù‹)   
                      
                    // ğŸ”¥ Ø§Ù„Ø®Ø·ÙˆØ© 1: Ù…Ø­Ø§ÙƒØ§Ø© Ø§Ø³ØªØ¯Ø¹Ø§Ø¡ Ø§Ù„Ø¯Ø§Ù„Ø© (Function Calling)   
                    const functionCall = this.mockFunctionCallingAPI(text);   
                    let aiResponse = null;   
                     
                    if (functionCall && this.toolManager.availableTools[functionCall.name]) {   
                        // ØªÙ… ØªØ­Ø¯ÙŠØ¯ Ø£Ø¯Ø§Ø©: ØªÙ†ÙÙŠØ° Ø§Ù„Ø£Ø¯Ø§Ø© Ø£ÙˆÙ„Ø§Ù‹   
                        const toolResult = await this.toolManager.executeTool(functionCall.name, functionCall.args);   
                          
                        // ğŸ”¥ Ø§Ù„Ø®Ø·ÙˆØ© 2: Ù…Ø­Ø§ÙƒØ§Ø© Ø±Ø¯ Ø§Ù„Ù€ API Ø¨Ø¹Ø¯ ØªÙ†ÙÙŠØ° Ø§Ù„Ø£Ø¯Ø§Ø©   
                        aiResponse = `âœ… ØªÙ… ØªÙ†ÙÙŠØ° ${functionCall.name}.\n\nØ§Ù„Ù†Ø§ØªØ¬:\n${toolResult.result}`;   
                          
                    } else {   
                        // ğŸ”‘ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ Ù‡Ù†Ø§: Ø§Ø³ØªØ¨Ø¯Ø§Ù„ mockAPIResponse Ø¨Ø§ØªØµØ§Ù„ fetch Ø­Ù‚ÙŠÙ‚ÙŠ   
                        this.showToolStatus("Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ù€ API aladdan Ù„Ù€ Ø§Ù„Ø¯Ø±Ø¯Ø´Ø© Ø¨Ø·Ù„Ø§Ù‚Ø©...");
                        const apiResponse = await fetch('/api/chat', { 
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                                // ğŸ”¥ ÙŠÙ…ÙƒÙ† Ø¥Ø¶Ø§ÙØ© Ù…ÙØªØ§Ø­ API Ù‡Ù†Ø§ Ø¥Ø°Ø§ ÙƒØ§Ù† Ù…Ø·Ù„ÙˆØ¨Ø§Ù‹ ÙÙŠ Header:
                                // 'Authorization': 'Bearer YOUR_API_KEY' 
                            },
                            body: JSON.stringify({ 
                                prompt: text, 
                                history: this.state.chatHistory.slice(-5).map(m => ({ role: m.role, text: m.parts[0].text })), // ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ø³Ø¬Ù„ Ø¥Ù„Ù‰ ØµÙŠØºØ© Ø¨Ø³ÙŠØ·Ø©
                                memory_context: context 
                            }),
                        });

                        if (!apiResponse.ok) {
                            throw new Error(`API Error: ${apiResponse.statusText} (${apiResponse.status})`);
                        }

                        const data = await apiResponse.json();
                        // ğŸ”‘ Ø§Ù„Ø±Ø¯ Ø§Ù„ÙØ¹Ù„ÙŠ Ù„Ù„Ø¯Ø±Ø¯Ø´Ø© Ø¨Ø·Ù„Ø§Ù‚Ø©
                        aiResponse = data.response; 
                    }   
                      
                    const aiMessageUUID = generateUUID();   
                    
                    // ğŸ† Ø§Ù„Ø¥ØµÙ„Ø§Ø­ 3.2: Ø¥Ø±Ø³Ø§Ù„ Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ù…Ø®Ø²Ù†Ø© Ù…Ø¤Ù‚ØªØ§Ù‹ Ø¥Ù„Ù‰ streamResponse Ù„ÙŠØªÙ… Ø­ÙØ¸Ù‡Ø§ Ù…Ø¹ Ø±Ø¯ Ø§Ù„Ù€ AI
                    await this.streamResponse(aiResponse, aiMessageUUID, 'ai', userMessage);   
                       
                    this.saveState();   
                    this.updateMemoryStats();   
                    this.updateCollaborationBar();   
   
                } catch (error) {   
                    console.error("AI Error:", error);   
                    const errorMessage = `âŒ ÙØ´Ù„ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ù€ API aladdan. ØªØ­Ù‚Ù‚ Ù…Ù† Ù…ÙØªØ§Ø­ API Ùˆ Back-End. (Ø§Ù„Ø®Ø·Ø£: ${error.message})`;
                    const errorMessageUUID = generateUUID();   
                    this.addMessage(errorMessage, 'ai', errorMessageUUID);     
                } finally {   
                    this.hideToolStatus();   
                    this.hideTypingIndicator();   
                    this.elements.sendBtn.disabled = false;   
                    this.elements.sendBtn.classList.remove('loading');   
                    this.elements.messageInput.focus();   
                }   
            }   
              
            // ğŸ”¥ NEW: Ø¯Ø§Ù„Ø© Ù…Ø­Ø§ÙƒØ§Ø© Ø§Ø³ØªØ¯Ø¹Ø§Ø¡ Ø§Ù„Ø¯Ø§Ù„Ø© (Function Calling)   
            mockFunctionCallingAPI(text) {   
                const lowerText = text.toLowerCase();   
                  
                if (lowerText.includes('Ø¬Ø¯ÙˆÙ„') || lowerText.includes('Ø¨ÙŠØ§Ù†Ø§Øª')) {   
                    return {   
                        name: 'create_table',   
                        args: {   
                            columns: ['Ø§Ù„Ù…Ù†ØªØ¬', 'Ø§Ù„ÙƒÙ…ÙŠØ©', 'Ø§Ù„Ø­Ø§Ù„Ø©'],   
                            rows: []   
                        }   
                    };   
                }   
                if (lowerText.includes('Ø§Ø¬ØªÙ…Ø§Ø¹') || lowerText.includes('Ù…ÙˆØ¹Ø¯')) {   
                    return {   
                        name: 'schedule_event',   
                        args: {   
                            title: 'Ø§Ø¬ØªÙ…Ø§Ø¹ Ø§Ù„ØªØ®Ø·ÙŠØ· Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ÙŠ',   
                            date: '2025-12-22',   
                            time: '14:00'   
                        }   
                    };   
                }   
                if (lowerText.includes('Ø¥Ø±Ø³Ø§Ù„ Ø¨Ø±ÙŠØ¯ Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ') || lowerText.includes('Ø§ÙŠÙ…ÙŠÙ„')) {  
                    return {  
                        name: 'send_email',  
                        args: {  
                            to: 'user@example.com',  
                            subject: 'Ù…ØªØ§Ø¨Ø¹Ø© Ù…Ù† Agnes',  
                            body: 'Ù…Ø±Ø­Ø¨Ø§Ù‹ØŒ Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ù…Ø­Ø§Ø¯Ø«ØªÙ†Ø§ Ø§Ù„Ø£Ø®ÙŠØ±Ø©...'  
                        }  
                    };  
                }  
                if (lowerText.includes('Ø§Ø¨Ø­Ø« Ø¹Ù†') || lowerText.includes('Ù…Ø§ Ù‡Ùˆ')) { // ğŸ”¥ Ù…Ø­Ø§ÙƒØ§Ø© Ø§Ø³ØªØ¯Ø¹Ø§Ø¡ Ø£Ø¯Ø§Ø© Ø§Ù„Ø¨Ø­Ø« 
                    return { 
                        name: 'search_web', 
                        args: { query: text.replace(/(?:Ø§Ø¨Ø­Ø« Ø¹Ù†|Ù…Ø§ Ù‡Ùˆ)\s+/iu, '').trim() } 
                    }; 
                } 
                if (lowerText.includes('Ø¥Ù†Ø´Ø§Ø¡ ØµÙˆØ±Ø©') || lowerText.includes('ØªÙˆÙ„ÙŠØ¯ ØµÙˆØ±Ø©')) { // ğŸ”¥ Ù…Ø­Ø§ÙƒØ§Ø© Ø§Ø³ØªØ¯Ø¹Ø§Ø¡ Ø£Ø¯Ø§Ø© ØªÙˆÙ„ÙŠØ¯ Ø§Ù„ØµÙˆØ± 
                    return { 
                        name: 'image_generation', 
                        args: { prompt: text.replace(/(?:Ø¥Ù†Ø´Ø§Ø¡ ØµÙˆØ±Ø©|ØªÙˆÙ„ÙŠØ¯ ØµÙˆØ±Ø©)\s+Ù„Ù€\s+/iu, '').trim() } 
                    }; 
                } 
                return null; // Ù„Ø§ ØªÙˆØ¬Ø¯ Ø£Ø¯Ø§Ø©   
            }   
              
            // ğŸ”¥ NEW: Ø¯Ø§Ù„Ø© Ø§Ø³ØªØ®Ù„Ø§Øµ Ø§Ù„Ø³ÙŠØ§Ù‚ (ØªÙ…Ø«Ù„ Context Pruning)   
            getRelevantContext(text) {   
                const recentHistory = this.state.chatHistory.slice(-5).map(msg => msg.parts[0].text).join('\n');   
                return {   
                    recentMessages: recentHistory,   
                    activeTasks: this.state.memoryStats.activeTasks,   
                    activeEntities: Object.values(this.state.contextMemory.entities).slice(0, 3).map(e => e.name),   
                    currentPrompt: text   
                };   
            }   
              
            // ğŸ”¥ NEW: Ø¯Ø§Ù„Ø© Ù…Ø­Ø§ÙƒØ§Ø© Ø§Ù„Ø¨Ø« Ø§Ù„Ø­ÙŠ Ù„Ù„Ø±Ø¯ÙˆØ¯   
            async streamResponse(fullResponse, aiMessageUUID, sender, userMessage = null) {   
                this.hideTypingIndicator();   
                
                // ğŸ† Ø§Ù„Ø¥ØµÙ„Ø§Ø­ 3.3: Ø¥Ø¶Ø§ÙØ© Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø¥Ù„Ù‰ Ø§Ù„Ø°Ø§ÙƒØ±Ø© Ø§Ù„Ø¢Ù† (Ù„Ø¶Ù…Ø§Ù† Ø­ÙØ¸ Ø§Ù„Ø«Ù†Ø§Ø¦ÙŠ)
                if (userMessage) {
                    this.state.chatHistory.push(userMessage);
                }
                
                const messageDiv = this.createMessageStructure(sender, '');   
                messageDiv.dataset.messageUuid = aiMessageUUID; // Ø±Ø¨Ø· Ø§Ù„Ù€ UUID   
                this.elements.chatContainer.appendChild(messageDiv);   
                this.scrollToBottom();   
   
                const bubbleContent = messageDiv.querySelector('.message-bubble > div:first-child');   
                let currentText = '';   
   
                for (let i = 0; i < fullResponse.length; i++) {   
                    currentText += fullResponse[i];   
                    bubbleContent.innerHTML = this.parseMarkdown(currentText);   
                    this.scrollToBottom();   
                    if (i % 20 === 0 && fullResponse[i] !== ' ') { // ØªØ­Ø¯ÙŠØ« Highlight.js Ø¨Ø´ÙƒÙ„ Ø¯ÙˆØ±ÙŠ   
                         const codeBlocks = messageDiv.querySelectorAll('pre code');   
                         codeBlocks.forEach(block => hljs.highlightElement(block));   
                    }   
                    await this.delay(15); // Ø³Ø±Ø¹Ø© Ø§Ù„Ø¨Ø«   
                }   
   
                // Ø­ÙØ¸ Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ø§Ù„ÙƒØ§Ù…Ù„Ø© ÙÙŠ Ø§Ù„Ø³Ø¬Ù„   
                const enrichedMessage = {   
                    role: sender,   
                    parts: [{ text: fullResponse }],   
                    uuid: aiMessageUUID,   
                    timestamp: Date.now(),   
                    knowledgeExtracted: false   
                };   
                this.state.chatHistory.push(enrichedMessage);   
                  
                // Ø¥Ø¹Ø§Ø¯Ø© ØªÙ…ÙŠÙŠØ² Ø§Ù„Ø£ÙƒÙˆØ§Ø¯ Ø¨Ø¹Ø¯ Ø§Ù†ØªÙ‡Ø§Ø¡ Ø§Ù„Ø¨Ø«   
                const codeBlocks = messageDiv.querySelectorAll('pre code');   
                codeBlocks.forEach(block => hljs.highlightElement(block));   
            }   
   
            // ======================================================================   
            // Knowledge Extraction & Memory (ØªÙ… Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØµØ­ØªÙ‡Ø§)   
            // ======================================================================   
   
            // ğŸ”¥ Mock Semantic Parser API Call - Ù…Ø­Ø§ÙƒØ§Ø© API Ù„ÙÙ‡Ù… Ø¯Ù„Ø§Ù„ÙŠ Ø£Ø¹Ù…Ù‚   
            async mockSemanticParsingAPI(text) {   
                await this.delay(300); // Ù…Ø­Ø§ÙƒØ§Ø© Ø§Ø³ØªØ¯Ø¹Ø§Ø¡ API   
                const lowerText = text.toLowerCase();   
                const extracted = {   
                    entities: [],   
                    tasks: [],   
                    concepts: [],   
                    relationships: []   
                };   
   
                // Ù…Ø­Ø§ÙƒØ§Ø© Ø§Ø³ØªØ®Ù„Ø§Øµ Ø§Ù„ÙƒÙŠØ§Ù†Ø§Øª Ø¨ÙÙ‡Ù… Ø³ÙŠØ§Ù‚ÙŠ (Ø£ÙƒØ«Ø± Ø°ÙƒØ§Ø¡Ù‹ Ù…Ù† Regex Ø§Ù„Ø¨Ø³ÙŠØ·)   
                if (lowerText.includes('Ù…Ù†ØªØ¬')) {   
                    const productNameMatch = lowerText.match(/(?:Ù…Ù†ØªØ¬|product)\s+([\p{L}\w\d\s\-_]+)/iu);   
                    if (productNameMatch) extracted.entities.push({ name: productNameMatch[1].trim(), type: 'product', source: text });   
                    else extracted.entities.push({ name: 'Ù…Ù†ØªØ¬ ØºÙŠØ± Ù…Ø­Ø¯Ø¯', type: 'product', source: text });   
                }   
                if (lowerText.includes('Ù…Ø´Ø±ÙˆØ¹')) {   
                    const projectNameMatch = lowerText.match(/(?:Ù…Ø´Ø±ÙˆØ¹|project)\s+([\p{L}\w\d\s\-_]+)/iu);   
                    if (projectNameMatch) extracted.entities.push({ name: projectNameMatch[1].trim(), type: 'project', source: text });   
                    else extracted.entities.push({ name: 'Ù…Ø´Ø±ÙˆØ¹ ØºÙŠØ± Ù…Ø­Ø¯Ø¯', type: 'project', source: text });   
                }   
                if (lowerText.includes('Ø§Ù„Ø¹Ù…ÙŠÙ„')) {   
                    const clientNameMatch = lowerText.match(/(?:Ø§Ù„Ø¹Ù…ÙŠÙ„|client)\s+([\p{L}\w\d\s\-_]+)/iu);   
                    if (clientNameMatch) extracted.entities.push({ name: clientNameMatch[1].trim(), type: 'client', source: text });   
                    else extracted.entities.push({ name: 'Ø¹Ù…ÙŠÙ„ ØºÙŠØ± Ù…Ø­Ø¯Ø¯', type: 'client', source: text });   
                }   
                // Ø§Ø³ØªØ®Ù„Ø§Øµ Ø§Ù„Ù…Ù‡Ø§Ù… Ø¨ÙÙ‡Ù… Ù„Ù„Ù†ÙŠØ©   
                if (lowerText.includes('Ø®Ø·Ø© ØªØ³ÙˆÙŠÙ‚ÙŠØ©') && lowerText.includes('Ø£Ø­ØªØ§Ø¬')) {   
                    extracted.tasks.push({ name: 'Ø¥Ø¹Ø¯Ø§Ø¯ Ø®Ø·Ø© ØªØ³ÙˆÙŠÙ‚ÙŠØ©', status: 'pending', priority: 'high', source: text });   
                } else if (lowerText.includes('Ø§Ø¬ØªÙ…Ø§Ø¹') && lowerText.includes('Ø¬Ø¯ÙˆÙ„')) {   
                    extracted.tasks.push({ name: 'Ø¬Ø¯ÙˆÙ„Ø© Ø§Ø¬ØªÙ…Ø§Ø¹', status: 'pending', priority: 'medium', source: text });   
                }   
                // Ø§Ø³ØªØ®Ù„Ø§Øµ Ø§Ù„Ù…ÙØ§Ù‡ÙŠÙ…   
                if (lowerText.includes('ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø³ÙˆÙ‚')) extracted.concepts.push({ name: 'ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø³ÙˆÙ‚', source: text });   
                if (lowerText.includes('ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„Ø£Ø¯Ø§Ø¡')) extracted.concepts.push({ name: 'ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„Ø£Ø¯Ø§Ø¡', source: text });   
   
                // ğŸ”¥ Ù…Ø­Ø§ÙƒØ§Ø© Ø§Ø³ØªØ®Ù„Ø§Øµ Ø§Ù„Ø¹Ù„Ø§Ù‚Ø§Øª   
                const productEntity = extracted.entities.find(e => e.type === 'product');   
                const marketingConcept = extracted.concepts.find(c => c.name === 'Ø®Ø·Ø© ØªØ³ÙˆÙŠÙ‚ÙŠØ©');   
                if (productEntity && marketingConcept) {   
                    extracted.relationships.push({   
                        from: productEntity.name,   
                        to: marketingConcept.name,   
                        type: 'has_marketing_plan',   
                        source: text   
                    });   
                }   
                  
                return extracted;   
            }   
   
            extractKnowledge(text, messageUUID, sender) {   
                const extractions = [];   
                this.mockSemanticParsingAPI(text).then(extracted => {   
                    extracted.entities.forEach(item => {   
                        const entityKey = `${item.type}_${item.name.replace(/\s+/g, '_').toLowerCase()}`;   
                        if (!this.state.contextMemory.entities[entityKey]) {   
                            this.state.contextMemory.entities[entityKey] = {   
                                uuid: generateUUID(),   
                                key: entityKey,   
                                name: item.name,   
                                type: item.type,   
                                firstMentioned: messageUUID,   
                                references: []   
                            };   
                            extractions.push(`ØªÙ… Ø§ÙƒØªØ´Ø§Ù ÙƒÙŠØ§Ù†: "${item.name}"`);   
                        }   
                        this.state.contextMemory.entities[entityKey].references.push({ messageUUID, text, sender });   
                    });   
   
                    extracted.tasks.forEach(item => {   
                        const taskUUID = generateUUID();   
                        this.state.contextMemory.tasks[taskUUID] = {   
                            uuid: taskUUID,   
                            name: item.name,   
                            status: item.status,   
                            priority: item.priority,   
                            created: messageUUID,   
                            createdBy: sender,   
                            relatedTo: [],   
                            references: [{ messageUUID, text, sender }]   
                        };   
                        extractions.push(`ØªÙ… Ø¥Ø¶Ø§ÙØ© Ù…Ù‡Ù…Ø©: "${item.name}"`);   
                    });   
  
                    extracted.concepts.forEach(item => {   
                        const conceptKey = `concept_${item.name.replace(/\s+/g, '_').toLowerCase()}`;   
                        if (!this.state.contextMemory.concepts[conceptKey]) {   
                            this.state.contextMemory.concepts[conceptKey] = {   
                                uuid: generateUUID(),   
                                key: conceptKey,   
                                name: item.name,   
                                category: 'general',   
                                firstMentioned: messageUUID,   
                                references: []   
                            };   
                            extractions.push(`ØªÙ… Ø§Ø³ØªØ®Ù„Ø§Øµ Ù…ÙÙ‡ÙˆÙ…: "${item.name}"`);   
                        }   
                        this.state.contextMemory.concepts[conceptKey].references.push({ messageUUID, text, sender });   
                    });   
  
                    extracted.relationships.forEach(item => {   
                        this.state.contextMemory.relationships.push({   
                            uuid: generateUUID(),   
                            from: item.from,   
                            to: item.to,   
                            type: item.type,   
                            sourceMessage: messageUUID   
                        });   
                        extractions.push(`ØªÙ… Ø§Ø³ØªØ®Ù„Ø§Øµ Ø¹Ù„Ø§Ù‚Ø©: ${item.from} -> ${item.to}`);   
                    });   
   
                    if (extractions.length > 0) {   
                        setTimeout(() => {   
                            this.showNotification(`ğŸ§  ØªÙ… Ø§Ø³ØªØ®Ù„Ø§Øµ ${extractions.length} Ø¹Ù†ØµØ± Ø¬Ø¯ÙŠØ¯ Ù„Ù„Ø°Ø§ÙƒØ±Ø© Ø§Ù„ØªØ¹Ø§ÙˆÙ†ÙŠØ© (Ù…ØªÙ‚Ø¯Ù…)!`, 'success');   
                        }, 500);   
                    }   
                    this.saveState(); // Ø­ÙØ¸ Ø§Ù„Ø­Ø§Ù„Ø© Ø¨Ø¹Ø¯ Ø§Ø³ØªØ®Ù„Ø§Øµ Ø§Ù„Ù…Ø¹Ø±ÙØ©   
                    this.updateMemoryStats();   
                });   
            }   
  
            updateMemoryStats() {   
                this.state.memoryStats.totalEntities = Object.keys(this.state.contextMemory.entities).length;   
                this.state.memoryStats.totalTasks = Object.keys(this.state.contextMemory.tasks).filter(key =>    
                    this.state.contextMemory.tasks[key].status !== 'completed' &&    
                    this.state.contextMemory.tasks[key].status !== 'failed'   
                ).length;   
                this.state.memoryStats.totalConcepts = Object.keys(this.state.contextMemory.concepts).length;   
                this.state.memoryStats.activeTasks = Object.values(this.state.contextMemory.tasks).filter(task => task.status === 'pending' || task.status === 'in_progress').length;   
   
                this.updateCollaborationBar();   
            }   
  
            updateCollaborationBar() {   
                const bar = this.elements.collaborationBar;   
                let summaryText = ``;   
  
                const { totalEntities, activeTasks, totalConcepts } = this.state.memoryStats;   
   
                if (totalEntities > 0) summaryText += ` (${totalEntities} ÙƒÙŠØ§Ù†)`;   
                if (totalConcepts > 0) summaryText += ` (${totalConcepts} Ù…ÙÙ‡ÙˆÙ…)`;   
                if (activeTasks > 0) summaryText += ` (${activeTasks} Ù…Ù‡Ù…Ø© Ù†Ø´Ø·Ø©)`;   
   
                this.elements.collaborationBarText.innerHTML = `<i class="fas fa-users"></i> Ù…Ø³Ø§Ø­Ø© Ø¹Ù…Ù„ ØªØ¹Ø§ÙˆÙ†ÙŠØ© Ù†Ø´Ø·Ø©. ${summaryText}`;   
   
                if (totalEntities > 0 || totalConcepts > 0 || activeTasks > 0) {   
                    bar.classList.add('active');   
                } else {   
                    bar.classList.remove('active');   
                }   
            }   
  
  
            // ğŸ”¥ NEW: Ø¯Ø§Ù„Ø© Ø¹Ø±Ø¶ Ø§Ù„Ø°Ø§ÙƒØ±Ø© (Memory Dashboard) - ØªÙ… Ù…Ù„Ø¡ Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ù…ÙÙ‚ÙˆØ¯ 
            showMemoryDashboard() { 
                const panel = this.elements.dashboardPanel; 
                // Ù…Ø³Ø­ Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ù‚Ø¯ÙŠÙ… ÙˆØ¥Ø¶Ø§ÙØ© Ø²Ø± Ø§Ù„Ø¥ØºÙ„Ø§Ù‚ Ù„Ø¶Ù…Ø§Ù† ÙˆØ¬ÙˆØ¯Ù‡ 
                panel.innerHTML = '<button class="dashboard-toggle-btn" onclick="aladan.toggleDashboard(false)" title="Ø¥ØºÙ„Ø§Ù‚"><i class="fas fa-times"></i></button>'; 
                 
                const memoryContent = document.createElement('div');  
                memoryContent.className = 'memory-dashboard-content';  
                memoryContent.style.padding = '0 40px 40px 40px';  
                 
                let html = '<h4 style="margin-bottom: 32px; font-size: 28px; background: linear-gradient(135deg, var(--neon-purple), var(--neon-cyan)); -webkit-background-clip: text; -webkit-text-fill-color: transparent;">Ù…Ø­Ø±Ùƒ Ø§Ù„Ø°Ø§ÙƒØ±Ø© Ø§Ù„ØªØ¹Ø§ÙˆÙ†ÙŠØ© (AGNES) ğŸ§ </h4>';  
                  
                // --- 1. Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø¹Ù„ÙˆÙŠØ© ---  
                html += '<div class="memory-stats-bar">';  
                html += `<div class="memory-stat" style="color: var(--neon-cyan);">ÙƒÙŠØ§Ù†Ø§Øª: <strong>${this.state.memoryStats.totalEntities}</strong></div>`;  
                html += `<div class="memory-stat" style="color: var(--neon-green);">Ù…Ù‡Ø§Ù… Ù†Ø´Ø·Ø©: <strong>${this.state.memoryStats.activeTasks}</strong></div>`;  
                html += `<div class="memory-stat" style="color: var(--neon-purple);">Ù…ÙØ§Ù‡ÙŠÙ…: <strong>${this.state.memoryStats.totalConcepts}</strong></div>`;  
                html += '</div><hr style="border-color: rgba(0, 255, 255, 0.1); margin: 20px 0;">';  
  
                // --- 2. Ø¹Ø±Ø¶ Ø§Ù„Ù…Ù‡Ø§Ù… (Tasks) ---  
                html += '<h5 style="font-size: 20px; color: var(--neon-green); margin-bottom: 15px;">Ø§Ù„Ù…Ù‡Ø§Ù… Ø§Ù„Ù†Ø´Ø·Ø© <i class="fas fa-list-check"></i></h5>';  
                const tasks = Object.values(this.state.contextMemory.tasks);  
                if (tasks.length > 0) {  
                    tasks.forEach(task => {  
                        const statusColor = task.status === 'pending' ? 'var(--neon-orange)' : 'var(--neon-green)';  
                        html += `  
                            <div class="memory-item" style="border-right-color: ${statusColor};">  
                                <div>  
                                    ${task.name}  
                                    <span class="memory-badge badge-task">${task.status}</span>  
                                </div>  
                                <div style="font-size: 12px; color: var(--text-secondary); margin-top: 5px;">  
                                    Ø§Ù„Ø£ÙˆÙ„ÙˆÙŠØ©: ${task.priority}  
                                    <button style="margin-right: 10px; background: none; border: 1px solid var(--neon-green); color: var(--neon-green); border-radius: 5px; cursor: pointer; padding: 2px 5px;" onclick="aladan.updateTaskStatus('${task.uuid}', 'completed')">Ø¥ØªÙ…Ø§Ù…</button>  
                                </div>  
                            </div>  
                        `;  
                    });  
                } else {  
                    html += '<p style="color: var(--text-secondary); opacity: 0.7;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù‡Ø§Ù… Ù†Ø´Ø·Ø© Ø­Ø§Ù„ÙŠØ§Ù‹.</p>';  
                }  
  
                // --- 3. Ø¹Ø±Ø¶ Ø§Ù„ÙƒÙŠØ§Ù†Ø§Øª (Entities) ---  
                html += '<h5 style="font-size: 20px; color: var(--neon-cyan); margin-top: 30px; margin-bottom: 15px;">Ø§Ù„ÙƒÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ù„ØµØ© <i class="fas fa-cube"></i></h5>';  
                const entities = Object.values(this.state.contextMemory.entities);  
                if (entities.length > 0) {  
                    entities.forEach(entity => {  
                        html += `  
                            <div class="memory-item" style="border-right-color: var(--neon-cyan);">  
                                <div>  
                                    ${entity.name}  
                                    <span class="memory-badge badge-entity">${entity.type}</span>  
                                </div>  
                                <div style="font-size: 12px; color: var(--text-secondary); margin-top: 5px;">  
                                    Ø§Ù„Ø°ÙƒØ± Ø§Ù„Ø£ÙˆÙ„: ${new Date(this.state.chatHistory.find(m => m.uuid === entity.firstMentioned)?.timestamp || 0).toLocaleDateString()}  
                                </div>  
                            </div>  
                        `;  
                    });  
                } else {  
                    html += '<p style="color: var(--text-secondary); opacity: 0.7;">Ù„Ù… ÙŠØªÙ… Ø§Ø³ØªØ®Ù„Ø§Øµ ÙƒÙŠØ§Ù†Ø§Øª Ø¨Ø¹Ø¯.</p>';  
                }  
  
                panel.appendChild(memoryContent);  
                memoryContent.innerHTML = html;  
                  
                // ØªØ£ÙƒØ¯ Ù…Ù† ÙØªØ­ Ù„ÙˆØ­Ø© Ø§Ù„Ù‚ÙŠØ§Ø¯Ø©  
                this.toggleDashboard(true);  
                this.showNotification('ØªÙ… ÙØªØ­ Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø§Ù„Ø°Ø§ÙƒØ±Ø© Ø§Ù„Ù…ØªÙ‚Ø¯Ù…Ø©. ğŸ§ ', 'info');  
            }  
    
            updateTaskStatus(taskUUID, newStatus) {    
                if (this.state.contextMemory.tasks[taskUUID]) {    
                    this.state.contextMemory.tasks[taskUUID].status = newStatus;    
                    this.saveState();    
                    this.updateMemoryStats();    
                    this.showNotification(`ØªÙ… ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ù‡Ù…Ø© "${this.state.contextMemory.tasks[taskUUID].name}" Ø¥Ù„Ù‰: ${newStatus}`, 'info');    
                    // Ù‡Ø°Ø§ Ø³ÙŠØ¤Ø¯ÙŠ Ø¥Ù„Ù‰ ØªØ­Ø¯ÙŠØ« Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ù…ÙØªÙˆØ­Ø©   
                    if (this.elements.dashboardPanel.classList.contains('active') && this.elements.dashboardPanel.querySelector('.memory-dashboard-content')) { 
                        this.showMemoryDashboard(); 
                    } 
                }    
            }    
     
            addMessage(text, sender, messageUUID) {    
                // Ø¹Ø±Ø¶ Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ø£ÙˆÙ„Ø§Ù‹    
                const messageDiv = this.createMessageStructure(sender, text);    
                this.elements.chatContainer.appendChild(messageDiv);    
                    
                // Ø§Ø³ØªØ®Ù„Ø§Øµ Ø§Ù„Ù…Ø¹Ø±ÙØ© Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ Ø§Ù„Ù…ØªÙ‚Ø¯Ù… (ØºÙŠØ± Ù…ØªØ²Ø§Ù…Ù†)    
                this.extractKnowledge(text, messageUUID, sender);     
                    
                // ğŸ† Ø§Ù„Ø¥ØµÙ„Ø§Ø­ 3: Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¥Ø¶Ø§ÙØ© Ù„Ù€ this.state.chatHistory.push(enrichedMessage);
                //  Ù„Ø£Ù†Ù‡ Ø³ÙŠØªÙ… Ø­ÙØ¸Ù‡Ø§ ÙŠØ¯ÙˆÙŠØ§Ù‹ Ø¯Ø§Ø®Ù„ streamResponse Ù„Ø¶Ù…Ø§Ù† Ø­ÙØ¸ Ø§Ù„Ø«Ù†Ø§Ø¦ÙŠ.
                
                this.scrollToBottom();    
            }    
                 
            sendPredefinedMessage(text) {    
                this.elements.messageInput.value = text;    
                this.sendMessage();    
            }    
     
            createMessageStructure(sender, originalText) {    
                const messageDiv = document.createElement('div');    
                messageDiv.className = `message ${sender}-message`;    
                const uuid = generateUUID(); // ØªÙˆÙ„ÙŠØ¯ UUID Ù‡Ù†Ø§
                messageDiv.dataset.messageUuid = uuid;    
                    
                const time = new Date().toLocaleTimeString('ar-EG', { hour: '2-digit', minute: '2-digit', hour12: false });    
    
                // ğŸ† Ø§Ù„Ø¥ØµÙ„Ø§Ø­ 1.2: Ø¥Ø¶Ø§ÙØ© Ø´Ø±ÙŠØ· Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø§Ù„ÙƒØ§Ù…Ù„ Ù„ØªÙ…ÙƒÙŠÙ† Ø§Ù„Ø°Ø§ÙƒØ±Ø© Ø§Ù„ØªØ¹Ø§ÙˆÙ†ÙŠØ©
                const actionsHtml = `
                    <div class="message-actions">
                        <button class="message-action-btn" onclick="aladan.copyMessage(event)" title="Ù†Ø³Ø® Ø§Ù„Ø±Ø³Ø§Ù„Ø©">
                            <i class="fas fa-copy"></i>
                        </button>
                        <button class="message-action-btn" onclick="aladan.saveAsTask(event)" title="Ø­ÙØ¸ ÙƒÙ…Ù‡Ù…Ø©">
                            <i class="fas fa-list-check"></i>
                        </button>
                        <button class="message-action-btn" onclick="aladan.generateReport(event)" title="Ø¥Ù†Ø´Ø§Ø¡ ØªÙ‚Ø±ÙŠØ±">
                            <i class="fas fa-file-pdf"></i>
                        </button>
                        <button class="message-action-btn" onclick="aladan.createPresentation(event)" title="Ø¹Ø±Ø¶ ØªÙ‚Ø¯ÙŠÙ…ÙŠ">
                            <i class="fas fa-desktop"></i>
                        </button>
                    </div>
                `;

                messageDiv.innerHTML = `    
                    ${actionsHtml}
                    <div class="message-bubble">    
                        <div data-uuid="${uuid}">${this.parseMarkdown(originalText)}</div>    
                        <div class="message-time">${time}</div>    
                    </div>    
                `;    
                return messageDiv;    
            }    
    
            parseMarkdown(text) {    
                // ØªÙ… Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† ØµØ­Ø© Ù‡Ø°Ù‡ Ø§Ù„Ø¯Ø§Ù„Ø©    
                return text    
                    .replace(/```(\w+)?\n?([\s\S]*?)```/g, (match, lang = 'text', code) => {    
                        const languageDisplay = lang === 'text' ? 'Code' : lang.toUpperCase();    
                        const sanitizedCode = code.trim().replace(/"/g, '&quot;');    
                        return `    
                        <div class="code-block-wrapper">    
                            <div class="code-toolbar">    
                                <span class="code-language">${languageDisplay}</span>    
                                <div class="code-actions">    
                                    <button class="code-action-btn" onclick="aladan.copyCode(event)" data-code="${sanitizedCode}" title="Ù†Ø³Ø® Ø§Ù„ÙƒÙˆØ¯">    
                                        <i class="fas fa-copy"></i>    
                                    </button>    
                                    <button class="code-action-btn" onclick="aladan.downloadCode(event)" data-code="${sanitizedCode}" data-lang="${lang}" title="ØªÙ†Ø²ÙŠÙ„ Ø§Ù„Ù…Ù„Ù">    
                                        <i class="fas fa-download"></i>    
                                    </button>    
                                    <button class="code-action-btn run-code-btn" onclick="aladan.runCode(event)" data-code="${sanitizedCode}" data-lang="${lang}" title="ØªØ´ØºÙŠÙ„ Ø§Ù„ÙƒÙˆØ¯">    
                                        <i class="fas fa-play"></i>    
                                    </button>    
                                </div>    
                            </div>    
                            <pre><code class="language-${lang}">${code.trim()}</code></pre>    
                        </div>    
                        `;    
                    })    
                    .replace(/\*\*(.*?)\*\*/g, '<strong style="color: var(--neon-cyan);">$1</strong>')    
                    .replace(/\*(.*?)\*/g, '<em>$1</em>')    
                    .replace(/^>\s?(.*)$/gm, '<blockquote style="border-right: 4px solid var(--neon-green); padding-right: 20px; color: var(--text-secondary); margin: 16px 0;">$1</blockquote>')    
                    .replace(/!\[(.*?)\]\((.*?)\)/g, '<img src="$2" alt="$1" style="max-width:100%; height:auto; border-radius:12px; margin-top:16px;">')    
                    .replace(/\n/g, '<br>')    
                    .replace(/^- (.*)$/gm, '<ul><li>$1</li></ul>')    
                    .replace(/<\/ul>\n<ul>/g, '')    
                    .replace(/<\/ol>\n<ol>/g, '');  
                    // Ø¥ØµÙ„Ø§Ø­ Ù…Ø´ÙƒÙ„Ø© Ø¸Ù‡ÙˆØ± Ø§Ù„Ø¹Ù†Ø§ØµØ± ÙƒÙ€ ul/li Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ù…ÙˆØ¬ÙˆØ¯Ø© (Ù„ÙŠØ³Øª Ø¬Ø²Ø¡Ù‹Ø§ Ù…Ù† Markdown Ø§Ù„Ù‚ÙŠØ§Ø³ÙŠ) 
            }    
     
            copyCode(event) {    
                event.stopPropagation();    
                const button = event.currentTarget;    
                const code = button.dataset.code.replace(/&quot;/g, '"');    
                navigator.clipboard.writeText(code).then(() => {    
                    const originalIcon = button.innerHTML;    
                    button.innerHTML = '<i class="fas fa-check"></i>';    
                    button.classList.add('success');    
                    this.showNotification('ØªÙ… Ù†Ø³Ø® Ø§Ù„ÙƒÙˆØ¯ Ø¨Ù†Ø¬Ø§Ø­! ğŸ“‹', 'success');    
                    setTimeout(() => {    
                        button.innerHTML = originalIcon;    
                        button.classList.remove('success');    
                    }, 2000);    
                }).catch(() => {    
                    this.showNotification('ÙØ´Ù„ ÙÙŠ Ù†Ø³Ø® Ø§Ù„ÙƒÙˆØ¯!', 'error');    
                });    
            }    
               
            downloadCode(event) {    
                event.stopPropagation();    
                const button = event.currentTarget;    
                const code = button.dataset.code.replace(/&quot;/g, '"');    
                const lang = button.dataset.lang || 'txt';    
     
                let extension = '';    
                if (lang === 'python') extension = '.py';    
                else if (lang === 'javascript') extension = '.js';    
                else if (lang === 'css') extension = '.css';    
                else if (lang === 'html') extension = '.html';    
                else extension = `.${lang}`;    
     
                const filename = `aladan_snippet${extension}`;    
     
                const blob = new Blob([code], { type: 'text/plain' });    
                const url = URL.createObjectURL(blob);    
     
                const a = document.createElement('a');    
                a.href = url;    
                a.download = filename;    
                document.body.appendChild(a);    
                a.click();    
     
                document.body.removeChild(a);    
                URL.revokeObjectURL(url);    
     
                this.showNotification(`Ø¬Ø§Ø±ÙŠ ØªÙ†Ø²ÙŠÙ„ Ù…Ù„Ù "${filename}"... ğŸ“¥`, 'info');    
            }    
     
            runCode(event) {    
                event.stopPropagation();    
                const button = event.currentTarget;    
                const code = button.dataset.code.replace(/&quot;/g, '"');    
                const lang = button.dataset.lang;    
                this.showNotification(`â–¶ï¸ Ø¬Ø§Ø±ÙŠ ØªØ´ØºÙŠÙ„ ÙƒÙˆØ¯ ${lang.toUpperCase()} ÙÙŠ Ø¨ÙŠØ¦Ø© Ø¢Ù…Ù†Ø©...`, 'info');    
                console.log(`Running ${lang} code:\n${code}`);    
                setTimeout(() => {    
                    this.addMessage(`**ØªÙ… ØªÙ†ÙÙŠØ° Ø§Ù„ÙƒÙˆØ¯ Ø¨Ù†Ø¬Ø§Ø­!**\n\`\`\`text\n(Ø§Ù„Ù†Ø§ØªØ¬ Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ Ù„ØªØ´ØºÙŠÙ„ Ø§Ù„ÙƒÙˆØ¯)\n\`\`\``, 'ai', generateUUID());    
                }, 1500);    
            }    
               
            copyMessage(event) {    
                 event.stopPropagation();    
                 const button = event.currentTarget;    
                 const messageBubble = button.closest('.message');    
                 const textToCopy = messageBubble.querySelector('.message-bubble > div:first-child').innerText;    
                     
                 navigator.clipboard.writeText(textToCopy).then(() => {    
                     const originalIcon = button.innerHTML;    
                     button.innerHTML = '<i class="fas fa-check"></i>';    
                     button.classList.add('success');    
                     this.showNotification('ØªÙ… Ù†Ø³Ø® Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ø¨Ù†Ø¬Ø§Ø­! ğŸ“‹', 'success');    
                     setTimeout(() => {    
                         button.innerHTML = originalIcon;    
                         button.classList.remove('success');    
                     }, 2000);    
                 }).catch(() => {    
                     this.showNotification('ÙØ´Ù„ ÙÙŠ Ù†Ø³Ø® Ø§Ù„Ø±Ø³Ø§Ù„Ø©!', 'error');    
                 });    
             }    
               
             // ğŸ”¥ NEW: Ø¯Ø§Ù„Ø© Ø­ÙØ¸ Ø§Ù„Ø±Ø³Ø§Ù„Ø© ÙƒÙ…Ù‡Ù…Ø© (Ù…Ø¶Ø§ÙØ©) 
            saveAsTask(event) { 
                const messageBubble = event.currentTarget.closest('.message'); 
                const text = messageBubble.querySelector('.message-bubble > div:first-child').innerText.trim(); 
                const messageUUID = messageBubble.dataset.messageUuid; 
                const taskUUID = generateUUID(); 
                 
                const taskName = text.substring(0, 50) + (text.length > 50 ? '...' : ''); // Ø§Ø³Ù… Ø§Ù„Ù…Ù‡Ù…Ø© Ù‡Ùˆ Ø£ÙˆÙ„ 50 Ø­Ø±Ù 
                 
                this.state.contextMemory.tasks[taskUUID] = { 
                    uuid: taskUUID, 
                    name: taskName, 
                    status: 'pending', 
                    priority: 'high', 
                    created: messageUUID, 
                    createdBy: 'ai', // Ø§Ù„Ù…Ù‡Ù…Ø© Ù…Ø³ØªØ®Ù„ØµØ© Ù…Ù† Ø±Ø¯ Ø§Ù„Ù€ AI 
                    relatedTo: [], 
                    references: [{ messageUUID, text, sender: 'ai' }] 
                }; 
                 
                this.saveState(); 
                this.updateMemoryStats(); 
                this.showNotification(`ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø±Ø³Ø§Ù„Ø© ÙƒÙ…Ù‡Ù…Ø© Ø¬Ø¯ÙŠØ¯Ø©: "${taskName}"`, 'success'); 
            } 
             
            generateReport(event) { 
                this.showNotification('Ø¬Ø§Ø±ÙŠ Ø¥Ù†Ø´Ø§Ø¡ ØªÙ‚Ø±ÙŠØ± Ù…ÙØµÙ„... ğŸ“Š', 'info'); 
            } 
             
            createPresentation(event) { 
                this.showNotification('Ø¬Ø§Ø±ÙŠ ØªØ¬Ù‡ÙŠØ² Ø¹Ø±Ø¶ ØªÙ‚Ø¯ÙŠÙ…ÙŠ Ø§Ø­ØªØ±Ø§ÙÙŠ... ğŸ–¼ï¸', 'info'); 
            } 
   
            showToolStatus(toolName) {   
                this.elements.statusText.innerHTML = toolName;   
                this.elements.toolStatusIndicator.classList.add('active');   
                this.hideTypingIndicator();   
            }   
    
            hideToolStatus() {   
                this.elements.toolStatusIndicator.classList.remove('active');   
            }   
   
            saveState() {   
                const dataToSave = {   
                    chatHistory: this.state.chatHistory,   
                    contextMemory: this.state.contextMemory,   
                    memoryStats: this.state.memoryStats,   
                    currentThemeIndex: this.state.currentThemeIndex   
                };   
                localStorage.setItem('agnesUltra4State', JSON.stringify(dataToSave));   
            }   
    
            loadState() {   
                const savedState = localStorage.getItem('agnesUltra4State');   
                if (savedState) {   
                    try {   
                        const parsedState = JSON.parse(savedState);   
                        this.state.chatHistory = parsedState.chatHistory || [];   
                        this.state.contextMemory = parsedState.contextMemory || { entities: {}, concepts: {}, tasks: {}, decisions: {}, relationships: [] };   
                        this.state.memoryStats = parsedState.memoryStats || { totalEntities: 0, totalTasks: 0, totalConcepts: 0, activeTasks: 0 };   
                        this.state.currentThemeIndex = parsedState.currentThemeIndex !== undefined ? parsedState.currentThemeIndex : 0;   
                    } catch (e) {   
                        console.error("Error loading state:", e);   
                        this.state.chatHistory = [];   
                        this.state.contextMemory = { entities: {}, concepts: {}, tasks: {}, decisions: {}, relationships: [] };   
                        this.state.memoryStats = { totalEntities: 0, totalTasks: 0, totalConcepts: 0, activeTasks: 0 };   
                    }   
                }   
                this.updateMemoryStats();   
                // âœ… ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø«ÙŠÙ… Ø§Ù„Ù…Ø­ÙÙˆØ¸ Ø¹Ù†Ø¯ Ø§Ù„ØªØ­Ù…ÙŠÙ„   
                this.applyTheme(this.state.themes[this.state.currentThemeIndex]);   
            }   
    
            renderInitialChatHistory() {   
                if (this.state.chatHistory.length > 0) {   
                    this.elements.welcomeMessage.style.display = 'none';   
                    this.state.chatHistory.forEach(msg => {   
                        const messageDiv = this.createMessageStructure(msg.role, msg.parts[0].text);   
                        this.elements.chatContainer.appendChild(messageDiv);   
                        const codeBlocks = messageDiv.querySelectorAll('pre code');   
                        codeBlocks.forEach(block => hljs.highlightElement(block));   
                    });   
                    this.elements.collaborationBar.classList.add('active');   
                    this.scrollToBottom();   
                }   
            }   
    
            clearConversation() {   
                if (confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ØŸ Ù‡Ø°Ø§ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ØªØ±Ø§Ø¬Ø¹ Ø¹Ù†Ù‡.')) {   
                    this.elements.chatContainer.innerHTML = '';   
                    this.elements.chatContainer.appendChild(this.elements.welcomeMessage);   
                    this.elements.welcomeMessage.style.display = 'block';   
                    this.state.chatHistory = [];   
                    this.state.contextMemory = { entities: {}, concepts: {}, tasks: {}, decisions: {}, relationships: [] };   
                    this.state.memoryStats = { totalEntities: 0, totalTasks: 0, totalConcepts: 0, activeTasks: 0 };   
                    localStorage.removeItem('agnesUltra4State');   
                    this.elements.collaborationBar.classList.remove('active');   
                    this.showNotification('ØªÙ… Ù…Ø³Ø­ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø© ÙˆØ§Ù„Ø°Ø§ÙƒØ±Ø© Ø¨Ù†Ø¬Ø§Ø­!', 'success');   
                    this.closeAllPanels();   
                    this.updateCollaborationBar();   
                    this.elements.sendBtn.disabled = true; // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹Ø·ÙŠÙ„ Ø²Ø± Ø§Ù„Ø¥Ø±Ø³Ø§Ù„   
                    this.elements.messageInput.value = ''; // Ù…Ø³Ø­ Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„   
                }   
            }   
    
            scrollToBottom() {   
                this.elements.chatContainer.scrollTo({   
                    top: this.elements.chatContainer.scrollHeight,   
                    behavior: 'smooth'   
                });   
            }   
    
            delay(ms) {   
                return new Promise(resolve => setTimeout(resolve, ms));   
            }   
    
            showNotification(text, type = 'info') {   
                this.elements.notification.textContent = text;   
                this.elements.notification.className = `notification ${type} show`;   
                setTimeout(() => {   
                    this.elements.notification.classList.remove('show');   
                }, 3000);   
            }   
  
            toggleSidebar(open) {   
                this.elements.sidebar.classList.toggle('open', open);   
                this.elements.overlay.classList.toggle('active', open);   
            }   
    
            toggleDashboard(openState) {   
                const shouldOpen = typeof openState === 'boolean' ? openState : !this.elements.dashboardPanel.classList.contains('active');   
                this.elements.dashboardPanel.classList.toggle('active', shouldOpen);   
                this.elements.overlay.classList.toggle('active', shouldOpen);   
            }   
    
            closeAllPanels() {   
                this.elements.sidebar.classList.remove('open');   
                this.elements.userPopover.classList.remove('active');   
                this.elements.dashboardPanel.classList.remove('active');   
                this.elements.inputToolsPopover.classList.remove('active');   
                this.elements.overlay.classList.remove('active');   
            }   
    
            handleOutsideClick(event) {   
                const isPopoverOpen = this.elements.inputToolsPopover.classList.contains('active');   
                const isUserPopoverOpen = this.elements.userPopover.classList.contains('active');   
                const isSidebarOpen = this.elements.sidebar.classList.contains('open');   
                const isDashboardOpen = this.elements.dashboardPanel.classList.contains('active');   
   
                if (isPopoverOpen && !this.elements.inputToolsPopover.contains(event.target) && !this.elements.attachBtn.contains(event.target)) {   
                    this.elements.inputToolsPopover.classList.remove('active');   
                }   
                if (isUserPopoverOpen && !this.elements.userPopover.contains(event.target) && !this.elements.userBtn.contains(event.target)) {   
                    this.elements.userPopover.classList.remove('active');   
                }   
                if (isSidebarOpen && !this.elements.sidebar.contains(event.target) && !this.elements.menuBtn.contains(event.target)) {   
                    this.toggleSidebar(false);   
                }   
                // âœ… Ø¥ØµÙ„Ø§Ø­ Ù…Ø´ÙƒÙ„Ø© Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯ Ø¹Ù†Ø¯ Ø§Ù„Ø¶ØºØ· Ø®Ø§Ø±Ø¬ÙŠØ§Ù‹   
                if (isDashboardOpen && !this.elements.dashboardPanel.contains(event.target) && !this.elements.dashboardToggleBtn.contains(event.target) && !this.elements.memoryBtn.contains(event.target)) {   
                    this.toggleDashboard(false);   
                }   
            }   
    
            toggleVoiceRecording() {   
                this.state.isRecording = !this.state.isRecording;   
                this.elements.micBtn.classList.toggle('recording', this.state.isRecording);   
   
                if (this.state.isRecording) {   
                    this.showNotification('Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø§Ø³ØªÙ…Ø§Ø¹...', 'info');   
                    setTimeout(() => {   
                        this.state.isRecording = false;   
                        this.elements.micBtn.classList.remove('recording');   
                        this.elements.messageInput.value += ' (Ù…Ø¯Ø®Ù„ ØµÙˆØªÙŠ)';   
                        this.showNotification('ØªÙ… ØªØ­ÙˆÙŠÙ„ Ø§Ù„ØµÙˆØª Ø¥Ù„Ù‰ Ù†Øµ Ø¨Ù†Ø¬Ø§Ø­! ğŸ¤', 'success');   
                        this.elements.messageInput.focus();   
                        this.elements.sendBtn.disabled = false; // ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ Ø¨Ø¹Ø¯ Ø¥Ø¶Ø§ÙØ© Ù†Øµ   
                    }, 2500);   
                }   
            }   
    
            handleToolAction(type) {   
                const messages = {   
                    image: 'Ø¬Ø§Ù‡Ø² Ù„ØªØ­Ù„ÙŠÙ„ Ø§Ù„ØµÙˆØ±Ø©! (Ù‚Ø±ÙŠØ¨Ø§Ù‹ Ù…Ø¹ Vision API) ğŸ“¸',   
                    file: 'Ø±ÙØ¹ Ø§Ù„Ù…Ø³ØªÙ†Ø¯Ø§Øª Ø¬Ø§Ù‡Ø²! (Ù‚Ø±ÙŠØ¨Ø§Ù‹) ğŸ“„',   
                    create_table: 'ØªÙ… Ø§Ø®ØªÙŠØ§Ø± Ø£Ø¯Ø§Ø© Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø¬Ø¯ÙˆÙ„. Ø§ÙƒØªØ¨ "Ø¥Ù†Ø´Ø§Ø¡ Ø¬Ø¯ÙˆÙ„" Ù„Ø¨Ø¯Ø¡ Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…. ğŸ“Š',   
                    draw: 'ÙØªØ­ Ù„ÙˆØ­Ø© Ø§Ù„Ø±Ø³Ù…! (Ù‚Ø±ÙŠØ¨Ø§Ù‹) âœï¸'   
                };   
                this.showNotification(messages[type] || 'ØªÙ… Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø£Ø¯Ø§Ø©', 'info');   
                this.elements.inputToolsPopover.classList.remove('active');   
            }   
    
            loadPastConversation() {   
                if (this.state.chatHistory.length > 0 &&   
                    this.state.chatHistory[0]?.parts[0]?.text.includes('Ù…Ø­Ø§Ø¯Ø«Ø© Ø³Ø§Ø¨Ù‚Ø©')) {   
                    this.showNotification('ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø© Ø§Ù„Ø³Ø§Ø¨Ù‚Ø© Ù…Ø³Ø¨Ù‚Ø§Ù‹', 'info');   
                    return;   
                }   
    
                this.elements.chatContainer.innerHTML = '';   
                this.elements.welcomeMessage.style.display = 'none';   
    
                const pastChat = [   
                    { role: "user", parts: [{ text: "Ù…Ø­Ø§Ø¯Ø«Ø© Ø³Ø§Ø¨Ù‚Ø© ØªØ¬Ø±ÙŠØ¨ÙŠØ©" }] },   
                    { role: "model", parts: [{ text: "Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ø¹ÙˆØ¯ØªÙƒ! Ù…Ø§Ø°Ø§ Ù†Ù†Ø§Ù‚Ø´ Ø§Ù„ÙŠÙˆÙ… Ø­ÙˆÙ„ Ù…Ø´Ø§Ø±ÙŠØ¹ÙƒØŸ" }] },   
                    { role: "user", parts: [{ text: "Ø£Ø­ØªØ§Ø¬ ØªØ®Ø·ÙŠØ· Ø§Ø³ØªØ±Ø§ØªÙŠØ¬ÙŠØ© Ø§Ù„Ø±Ø¨Ø¹ Ø§Ù„Ø±Ø§Ø¨Ø¹ ÙˆØ£ÙÙƒØ§Ø± Ø­Ù…Ù„Ø§Øª ØªØ³ÙˆÙŠÙ‚ÙŠØ©" }] },   
                    { role: "model", parts: [{ text: "Ù…Ù…ØªØ§Ø²! Ù„Ø§Ø³ØªØ±Ø§ØªÙŠØ¬ÙŠØ© Ø§Ù„Ø±Ø¨Ø¹ Ø§Ù„Ø±Ø§Ø¨Ø¹ØŒ Ù†Ø­Ø¯Ø¯: **ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø³ÙˆÙ‚**ØŒ **ÙˆØ¶Ø¹ Ø§Ù„Ø£Ù‡Ø¯Ø§Ù**ØŒ **ØªØ®ØµÙŠØµ Ø§Ù„Ù…ÙˆØ§Ø±Ø¯**. Ù„Ø­Ù…Ù„Ø§Øª Ø§Ù„ØªØ³ÙˆÙŠÙ‚ØŒ Ø£ÙŠ Ù…Ù†ØªØ¬/Ø®Ø¯Ù…Ø© ØªØ±ÙƒØ² Ø¹Ù„ÙŠÙ‡ØŸ" }] }   
                ];   
   
                this.state.chatHistory = []; // Ù…Ø³Ø­ Ø§Ù„Ø³Ø¬Ù„ Ø§Ù„Ø­Ø§Ù„ÙŠ Ù‚Ø¨Ù„ Ø§Ù„Ø¥Ø¶Ø§ÙØ©   
                pastChat.forEach((msg) => {   
                    this.addMessage(msg.parts[0].text, msg.role, generateUUID());   
                    // ÙŠØ¬Ø¨ Ø£Ù† Ù†Ù…Ù„Ø£ Ø§Ù„Ø³Ø¬Ù„ Ù‡Ù†Ø§ ÙŠØ¯ÙˆÙŠØ§Ù‹ Ù„Ø£Ù†Ù†Ø§ Ø£Ù„ØºÙŠÙ†Ø§ Ø§Ù„Ø­ÙØ¸ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ ÙÙŠ addMessage
                    this.state.chatHistory.push({ 
                         role: msg.role === 'model' ? 'ai' : msg.role,
                         parts: msg.parts,
                         uuid: generateUUID(),
                         timestamp: Date.now(),
                         knowledgeExtracted: true 
                    });
                });   
   
                this.elements.collaborationBar.classList.add('active');   
                this.showNotification('ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø© Ø§Ù„Ø³Ø§Ø¨Ù‚Ø© Ø¨Ù†Ø¬Ø§Ø­! âœ…', 'success');   
                this.closeAllPanels();   
            }  
                
            showTypingIndicator() {  
                if (this.state.isTyping || this.elements.toolStatusIndicator.classList.contains('active')) return;  
                this.state.isTyping = true;  
                const typingIndicator = document.createElement('div');  
                typingIndicator.className = 'typing-indicator';  
                typingIndicator.innerHTML = `  
                    <div class="typing-dots">  
                        <div class="typing-dot"></div>  
                        <div class="typing-dot"></div>  
                        <div class="typing-dot"></div>  
                    </div>  
                    <div>Aladan AI ÙŠÙƒØªØ¨...</div>  
                `;  
                this.elements.chatContainer.appendChild(typingIndicator);  
                this.scrollToBottom();  
                this.typingIndicator = typingIndicator;  
            }  
   
            hideTypingIndicator() {  
                if (this.typingIndicator) {  
                    this.typingIndicator.remove();  
                    this.typingIndicator = null;  
                    this.state.isTyping = false;  
                }  
            }  
   
            startBackgroundAnimations() {  
                let hue = 180;  
                setInterval(() => {  
                    hue = (hue + 1) % 360;  
                    this.elements.logoText.style.filter = `hue-rotate(${hue}deg)`;  
                }, 100);  
   
                // ... (Ø¬Ø²ÙŠØ¦Ø§Øª Ø§Ù„Ø®Ù„ÙÙŠØ© ØªÙ… Ø­Ø°ÙÙ‡Ø§ Ù„ØªØ¬Ù†Ø¨ Ø§Ù„ØªÙƒØ±Ø§Ø± ÙˆÙ‡ÙŠ ØªØ¹Ù…Ù„ Ø¨Ø´ÙƒÙ„ Ø³Ù„ÙŠÙ…)  
            }  
   
            focusInput() {  
                setTimeout(() => this.elements.messageInput.focus(), 100);  
            }  
        }  
   
        // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚  
        const aladan = new AladanAI();  
   
        // Global functions for onclick handlers  
        window.aladan = aladan;  
        window.toggleDashboard = (state) => aladan.toggleDashboard(state);  
  
        document.addEventListener('DOMContentLoaded', () => {  
            hljs.highlightAll();  
        });  
    </script>  
</body>  
</html>
